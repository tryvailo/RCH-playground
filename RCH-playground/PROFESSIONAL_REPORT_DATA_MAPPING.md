# Professional Report - Детальное Сопоставление Данных с ТЗ

**Дата создания:** 2025-01-XX  
**Версия спецификации:** 2.0  
**Цель:** Детальное описание источников данных и методов расчета для каждой секции отчета для повторного анализа и проверки корректности используемых данных

---

## Executive Summary

### Общая структура отчета
Профессиональный отчет состоит из 23 секций (страниц), каждая из которых использует данные из различных источников. Данные загружаются через систему обогащения (enrichment pipeline), которая объединяет информацию из баз данных, внешних API и сервисов анализа.

### Процесс генерации отчета
1. **Загрузка начальных данных:** Система использует `AsyncDataLoader` для загрузки care homes из базы данных с фильтрацией по местоположению, типу ухода и максимальному расстоянию
2. **Мatching алгоритм:** Применяется 156-точечный алгоритм сопоставления с динамическими весами через `ProfessionalMatchingService`
3. **Обогащение данных:** Каждый care home обогащается данными из множества источников (CQC, FSA, Companies House, Google Places, Neighbourhood Analysis, Firecrawl)
4. **Расчеты и анализ:** Применяются специализированные сервисы для расчета финансовой стабильности, стоимости, рисков и стратегий переговоров

---

## Детальное Сопоставление по Секциям

### СЕКЦИЯ 1: Executive Summary (Страница 1)

**Требуемые данные по ТЗ:**
- Имя клиента (`full_name`)
- Дата генерации отчета
- Топ-3 рекомендации с названием, общим счетом, адресом, телефоном
- Статус листа ожидания
- Причина рекомендации

**Источники данных в проекте:**

1. **Имя клиента:**
   - Источник: `questionnaire.section_1_contact_emergency.q1_names`
   - Метод получения: Извлекается напрямую из входного опросника

2. **Дата генерации:**
   - Источник: Системное время (`datetime.now()`)
   - Метод получения: Генерируется при создании отчета

3. **Данные care homes (название, адрес, телефон):**
   - Источник: База данных `care_homes` через `DatabaseService.get_care_homes()`
   - Метод получения: Загружаются через `AsyncDataLoader.load_initial_data()` с фильтрацией по городу, типу ухода и расстоянию
   - Поля: `name`, `address`, `phone`, `latitude`, `longitude`

4. **Общий счет (Overall Score):**
   - Источник: `ProfessionalMatchingService.calculate_156_point_match()`
   - Метод расчета: 
     - Применяется 156-точечный алгоритм сопоставления с динамическими весами
     - Веса адаптируются на основе профиля клиента (риск падений, деменция, множественные условия, срочность)
     - Категории оцениваются: Medical (19%), Safety (16%), Location (10%), Social (10%), Financial (13%), Staff (13%), CQC (13%), Services (7%)
     - Итоговый счет нормализуется до 0-100

5. **Статус листа ожидания:**
   - Источник: База данных `care_homes.beds_available` и `occupancy_rate`
   - Метод расчета:
     - "Available now" если `beds_available > 0`
     - "2-4 weeks" если `beds_available == 0` и `occupancy_rate < 0.95`
     - "3+ months" если `occupancy_rate >= 0.95`

6. **Причина рекомендации (Match Reason):**
   - Источник: Результаты matching алгоритма (`match_result.factor_scores`)
   - Метод генерации: Анализируются топ-3 категории с наивысшими счетами, генерируется краткое описание (1-2 предложения) на основе сильных сторон дома

**Логика получения данных:**

Система начинает с загрузки care homes из базы данных, используя фильтры на основе ответов пользователя в опроснике. Если пользователь указал предпочтительный город, система ищет дома в этом городе. Если указан максимальный радиус (например, 5, 15 или 30 км), система рассчитывает расстояние от координат пользователя (полученных из postcode) до каждого care home и фильтрует только те, что попадают в радиус. Также применяется фильтр по типу ухода (nursing, residential, dementia) на основе выбора пользователя.

После загрузки начального списка домов, к каждому применяется 156-точечный алгоритм сопоставления. Этот алгоритм анализирует соответствие дома потребностям клиента по 8 категориям, но веса категорий не фиксированы - они динамически адаптируются. Например, если в опроснике указан высокий риск падений, вес категории Safety увеличивается с 16% до 25%, а веса других категорий пропорционально уменьшаются. Если указана деменция, вес Medical увеличивается. Это означает, что для клиента с деменцией система будет больше ценить медицинскую специализацию, чем, например, удобства.

Общий счет рассчитывается как взвешенная сумма счетов по всем категориям, где каждая категория оценивается от 0 до 156 баллов, а затем нормализуется до 0-100 для удобства восприятия. Топ-3 дома выбираются по наивысшему общему счету.

Статус листа ожидания определяется логически: если в базе данных указано, что есть свободные кровати (beds_available > 0), статус "Available now". Если кроватей нет, но заполненность дома менее 95%, статус "2-4 weeks" (предполагается, что освободится место в ближайшее время). Если заполненность 95% и выше, статус "3+ months" (долгое ожидание).

Причина рекомендации генерируется автоматически: система анализирует, какие 3 категории получили наивысшие счета для этого дома, и создает краткое текстовое описание, объясняющее, почему этот дом подходит (например, "Отличный выбор благодаря высокому рейтингу безопасности CQC, специализации в уходе за деменцией и близкому расположению к вашему дому").

**Проверка корректности:**
- ✅ Все данные доступны из указанных источников
- ✅ Matching алгоритм использует динамические веса на основе профиля клиента
- ⚠️ Статус листа ожидания рассчитывается на основе доступности кроватей, но может не отражать реальную ситуацию (нужна верификация)

---

### СЕКЦИЯ 2: Table of Contents (Страница 2)

**Требуемые данные по ТЗ:**
- Статический список секций с номерами страниц
- Иконки для групп секций
- Прогресс чтения (опционально)

**Источники данных в проекте:**

1. **Список секций:**
   - Источник: Статические константы
   - Метод получения: Хардкодится в компоненте или конфигурационном файле
   - Структура: 7 групп (Overview, Quality Analysis, Financial & Funding, Action Plan, Lifestyle & Location, Trust & Support, Appendix)

2. **Прогресс чтения:**
   - Источник: Система отслеживания (если реализована)
   - Метод получения: Отслеживание просмотренных страниц пользователем
   - Статус: Опциональная функция, может быть не реализована

**Проверка корректности:**
- ✅ Статический контент не требует проверки данных
- ⚠️ Прогресс чтения - опциональная функция

---

### СЕКЦИЯ 3: Dashboard (Страница 3)

**Требуемые данные по ТЗ:**
- Общий счет топ-выбора (0-100)
- Вердикт (Excellent Match / Good Match / Fair Match)
- Счета по 6 категориям (Safety, Medical Care, Staff Quality, Financial Stability, Comfort, Location)
- Testimonial (цитата семьи)

**Источники данных в проекте:**

1. **Общий счет и категории:**
   - Источник: `ProfessionalMatchingService.calculate_156_point_match()`
   - Метод расчета:
     - Общий счет: `match_result.total_score` (нормализованный до 0-100)
     - Категории: `match_result.factor_scores` содержит счета для каждой категории
     - Категории маппятся: Safety → `factor_scores.safety`, Medical Care → `factor_scores.medical`, Staff Quality → `factor_scores.staff`, Financial Stability → `factor_scores.financial`, Comfort → `factor_scores.social`, Location → `factor_scores.location`

2. **Вердикт:**
   - Источник: Расчет на основе общего счета
   - Метод расчета:
     - "Excellent Match" если `overall_score >= 85`
     - "Good Match" если `overall_score` 70-84
     - "Fair Match" если `overall_score < 70`

3. **Testimonial:**
   - Источник: Таблица `testimonials` (если существует)
   - Метод получения: Запрос к БД с фильтром `is_featured=true`, случайный выбор одного testimonial
   - Статус: ⚠️ Таблица может отсутствовать, требуется создание

**Логика получения данных:**

Общий счет и счета по категориям берутся напрямую из результата matching алгоритма, который был применен на этапе генерации отчета. Система не пересчитывает эти значения для Dashboard - она использует уже рассчитанные значения из секции 1 (Executive Summary). Это гарантирует консистентность данных между секциями.

Вердикт (Excellent/Good/Fair Match) определяется простым правилом на основе числового значения общего счета. Это качественная интерпретация количественного показателя для лучшего понимания пользователем.

Testimonial должен быть реальным отзывом от семьи, которая использовала сервис. Если таблица testimonials существует, система выбирает случайный отзыв из тех, что помечены как "featured" (рекомендуемые для показа). Это важно для социального доказательства - пользователь видит, что другие семьи уже использовали сервис и остались довольны.

**Проверка корректности:**
- ✅ Счета категорий корректно извлекаются из matching результата
- ✅ Вердикт рассчитывается на основе общего счета
- ❌ Testimonials могут отсутствовать - требуется создание таблицы

---

### СЕКЦИЯ 4: Your Priorities Match (Страница 4)

**Требуемые данные по ТЗ:**
- Топ-5 приоритетов клиента
- Таблица соответствия (3 дома × приоритеты)
- Счета соответствия для каждого приоритета

**Источники данных в проекте:**

1. **Приоритеты клиента:**
   - Источник: Извлечение из `questionnaire`
   - Метод извлечения:
     - `care_types` → преобразуется в "Dementia care", "Nursing care" и т.д.
     - `mobility_level` → "Wheelchair accessible" если wheelchair user
     - `dietary_requirements` → названия диет ("Diabetic diet", "Vegetarian" и т.д.)
     - `medical_conditions` → названия условий
     - `preferred_city` → "Close to family (City name)"
   - Приоритеты ранжируются по важности на основе ответов в опроснике

2. **Счета соответствия приоритетам:**
   - Источник: `match_result.factor_scores` и анализ соответствия
   - Метод расчета:
     - Для каждого приоритета анализируется соответствие через `factor_scores`
     - Например, если приоритет "Dementia care", проверяется `factor_scores.medical` и наличие dementia specialization
     - Счет нормализуется до 0-10 или используется бинарный ✓/✗

**Логика получения данных:**

Приоритеты клиента извлекаются из опросника путем анализа ответов на ключевые вопросы. Система не просто берет ответы как есть, а интерпретирует их в понятные приоритеты. Например, если пользователь выбрал "dementia care" в типе ухода, это становится приоритетом "Dementia care". Если указан уровень мобильности "wheelchair user", это становится приоритетом "Wheelchair accessible". Система ранжирует приоритеты по важности - те, что связаны с медицинскими потребностями, обычно выше, чем предпочтения по местоположению.

Для расчета соответствия каждого дома каждому приоритету система использует уже рассчитанные factor_scores из matching алгоритма, но применяет дополнительную логику. Например, для приоритета "Dementia care" система проверяет не только общий medical score, но и конкретно наличие специализации по деменции в списке medical_specialisms дома. Это важно, потому что дом может иметь высокий medical score по другим причинам, но не специализироваться на деменции.

Счет соответствия может быть либо числовым (0-10), либо бинарным (✓/✗). Бинарный используется для простых проверок (например, "Wheelchair accessible" - либо есть, либо нет), а числовой - для более сложных соответствий, где может быть частичное соответствие.

**Проверка корректности:**
- ✅ Приоритеты извлекаются из опросника
- ✅ Счета соответствия рассчитываются на основе factor_scores
- ⚠️ Логика маппинга приоритетов на factor_scores должна быть проверена

---

### СЕКЦИЯ 5: At-a-Glance Comparison (Страница 5)

**Требуемые данные по ТЗ:**
- Таблица сравнения всех 5 домов
- Колонки: Home Name, Overall Score, Safety, Medical Care, Staff Quality, Financial, Comfort, Location
- Визуальные индикаторы (зеленый/желтый/красный)

**Источники данных в проекте:**

1. **Данные домов:**
   - Источник: `scored_homes` (топ-5 из matching результата)
   - Метод получения: После применения `ProfessionalMatchingService.calculate_156_point_match()` к каждому дому, выбираются топ-5 по общему счету

2. **Счета категорий:**
   - Источник: `match_result.factor_scores` для каждого дома
   - Метод получения: Извлекаются напрямую из результата matching для каждого из 5 домов

3. **Визуальные индикаторы:**
   - Источник: Расчет на основе счетов
   - Метод расчета:
     - Зеленый если `score >= 80`
     - Желтый если `score` 60-79
     - Красный если `score < 60`

**Проверка корректности:**
- ✅ Все данные доступны из matching результата
- ✅ Визуальные индикаторы рассчитываются корректно

---

### СЕКЦИЯ 6: Safety Analysis (Страница 6)

**Требуемые данные по ТЗ:**
- Safety score (0-100)
- CQC Safety Rating
- Incident Rate
- Night Staffing Ratio
- Emergency Response Time
- Industry averages для сравнения
- Strengths и Concerns

**Источники данных в проекте:**

1. **Safety Score:**
   - Источник: `match_result.factor_scores.safety`
   - Метод расчета: Рассчитывается в рамках 156-точечного алгоритма на основе CQC safety rating, staffing data, и других факторов безопасности

2. **CQC Safety Rating:**
   - Источник: База данных `care_homes.cqc_rating_safe` или `CQCEnrichmentService`
   - Метод получения: 
     - Из БД: `raw_home.get('cqc_rating_safe')`
     - Из CQC API: через `CQCEnrichmentService.enrich_care_home()` если данных нет в БД
   - Значения: "Outstanding", "Good", "Requires Improvement", "Inadequate"

3. **Incident Rate:**
   - Источник: ❌ Не доступен напрямую
   - Метод получения: Может быть извлечен из CQC inspection reports через анализ текста, но не реализован
   - Fallback: Используется сообщение "Data not available - verify during visit"

4. **Night Staffing Ratio:**
   - Источник: ❌ Не доступен напрямую
   - Метод получения: Может быть извлечен из CQC reports или Firecrawl scraping сайта дома
   - Fallback: Используется сообщение "Data not available - verify during visit"

5. **Emergency Response Time:**
   - Источник: ❌ Не доступен
   - Метод получения: Не реализован
   - Fallback: Используется сообщение "Data not available - verify during visit"

6. **Industry Averages:**
   - Источник: ❌ Не доступен
   - Метод получения: Требуется база данных средних значений по индустрии
   - Fallback: Не используется, или используются статические значения

7. **Strengths и Concerns:**
   - Источник: Генерация на основе CQC ratings и других данных
   - Метод генерации:
     - Анализируются CQC ratings по всем ключевым вопросам
     - Если rating "Outstanding" или "Good" → добавляется в strengths
     - Если rating "Requires Improvement" или "Inadequate" → добавляется в concerns
     - Могут использоваться данные из Firecrawl для safety policies

**Логика получения данных:**

Safety score рассчитывается как часть общего matching алгоритма, но для этой секции важны детальные метрики безопасности. CQC Safety Rating - это официальный рейтинг от регулятора Care Quality Commission, который проверяет все care homes в Англии. Рейтинг берется либо из базы данных (если был загружен ранее), либо запрашивается напрямую из CQC API через специальный сервис обогащения. Это критически важный источник, так как CQC - единственный официальный регулятор, и их рейтинги основаны на реальных инспекциях.

Для детальных метрик (incident rate, night staffing ratio, emergency response time) система пытается извлечь информацию из различных источников. Incident rate теоретически можно найти в CQC inspection reports, но это требует анализа текста отчетов, что не реализовано. Night staffing ratio может быть указан на сайте care home, который можно просканировать через Firecrawl, но это не гарантировано. Emergency response time - это внутренняя процедура дома, которая редко публикуется.

Strengths и Concerns генерируются автоматически на основе анализа всех доступных CQC ratings. Система проверяет не только общий Safety rating, но и ratings по другим ключевым вопросам (Effective, Caring, Responsive, Well-led). Если какой-то аспект получил "Outstanding" или "Good", это становится strength. Если "Requires Improvement" или "Inadequate" - это concern. Это позволяет дать более детальную картину, чем просто общий рейтинг.

**Проверка корректности:**
- ✅ Safety score и CQC rating доступны
- ❌ Детальные метрики (incident rate, night staffing, emergency response) отсутствуют
- ⚠️ Strengths/concerns генерируются на основе доступных данных, но могут быть неполными

---

### СЕКЦИЯ 7: Food Safety & Hygiene (FSA) (Страница 7)

**Требуемые данные по ТЗ:**
- FSA Rating (0-5 звезд)
- FSA sub-scores (Hygienic Food Handling, Cleanliness & Condition, Management of Food Safety)
- Дата последней инспекции
- Тренд (Improving / Stable)
- Dietary specialties (если есть dietary requirements)

**Источники данных в проекте:**

1. **FSA Rating:**
   - Источник: `FSAEnrichmentService` или `FSADetailedService`
   - Метод получения:
     - Через `FSAEnrichmentService.enrich_care_home()` получается `fsa_rating` (0-5)
     - Или через `FSADetailedService.get_detailed_analysis()` для детального анализа
   - Данные из: FSA API (Food Standards Agency)

2. **FSA Sub-scores:**
   - Источник: `FSADetailedService.get_detailed_analysis()`
   - Метод получения:
     - `fsa_hygiene_score` - оценка гигиенической обработки пищи
     - `fsa_cleanliness_score` - оценка чистоты и состояния
     - `fsa_management_score` - оценка управления безопасностью пищи
   - Endpoint: `GET /api/fsa/establishment/{fhrs_id}/premium-data`

3. **Дата инспекции:**
   - Источник: FSA API через `FSADetailedService`
   - Метод получения: `fsa_inspection_date` из детального анализа

4. **Тренд:**
   - Источник: Сравнение текущего и предыдущего рейтинга
   - Метод расчета:
     - Если `previous_rating < current_rating` → "Improving ↑"
     - Иначе → "Stable →"
   - ⚠️ Предыдущий рейтинг может быть недоступен, используется "Stable"

5. **Dietary Specialties:**
   - Источник: `Firecrawl Explorer` через `POST /api/firecrawl/unified-analysis`
   - Метод получения:
     - Извлекается из `structured_data.nutrition.dietary_accommodations[]`
     - Или из `structured_data.nutrition.special_diets[]`
     - Или из `structured_data.nutrition.dining_options[]`
   - Сопоставление: Сравниваются `user.dietary_requirements[]` с `home.dietary_specialties[]`

**Логика получения данных:**

FSA (Food Standards Agency) - это официальный регулятор пищевой безопасности в Великобритании. Каждое заведение, которое готовит и подает еду, должно быть зарегистрировано в FSA и регулярно инспектируется. Система получает FSA rating через официальный API FSA, используя FHRS ID (Food Hygiene Rating Scheme ID) care home. Если FHRS ID неизвестен, система пытается найти его по названию и адресу дома.

FSA rating - это общий показатель от 0 до 5 звезд, но для детального анализа важны sub-scores по трем категориям: гигиеническая обработка пищи, чистота и состояние помещений, и управление безопасностью пищи. Эти детальные оценки доступны через специальный endpoint FSA API, который предоставляет более глубокую информацию, чем просто общий рейтинг.

Тренд (Improving/Stable) определяется путем сравнения текущего рейтинга с предыдущим. Однако для этого нужна история рейтингов, которая может быть недоступна. В таком случае система показывает "Stable", что технически корректно, но не дает полной картины.

Dietary specialties извлекаются путем сканирования сайта care home через Firecrawl. Система ищет информацию о питании в структурированном виде - какие диеты поддерживаются (диабетическая, вегетарианская, безглютеновая и т.д.), какие есть опции питания, какие специальные диетические потребности могут быть удовлетворены. Затем система сравнивает эти возможности с требованиями пользователя из опросника. Если пользователь указал, например, "diabetic diet", система проверяет, есть ли эта диета в списке dietary specialties дома.

**Проверка корректности:**
- ✅ FSA rating и sub-scores доступны через FSA API
- ✅ Dietary specialties могут быть извлечены из Firecrawl
- ⚠️ Тренд может быть неточным если нет истории рейтингов

---

### СЕКЦИЯ 8: Medical Care Analysis (Страница 8)

**Требуемые данные по ТЗ:**
- Medical Care Score (0-100)
- CQC Clinical Rating (Effective rating)
- Nursing Coverage (hours/day)
- GP Visit Frequency
- Hospital Readmission Rate
- Medical Conditions Match
- Strengths и Concerns

**Источники данных в проекте:**

1. **Medical Care Score:**
   - Источник: `match_result.factor_scores.medical`
   - Метод расчета: Рассчитывается в рамках 156-точечного алгоритма на основе медицинских специализаций, CQC ratings, и других факторов

2. **CQC Clinical Rating:**
   - Источник: База данных `care_homes.cqc_rating_effective` или `CQCEnrichmentService`
   - Метод получения: `raw_home.get('cqc_rating_effective')` или через CQC API

3. **Nursing Coverage:**
   - Источник: ❌ Не доступен напрямую
   - Метод получения: Может быть извлечен из Firecrawl scraping или CQC reports
   - Fallback: Используется оценка на основе типа ухода (nursing vs residential)

4. **GP Visit Frequency:**
   - Источник: ❌ Не доступен
   - Метод получения: Может использоваться NHSBSA data для оценки доступности GPs поблизости
   - Fallback: Используется общее описание или "Verify during visit"

5. **Hospital Readmission Rate:**
   - Источник: ❌ Не доступен
   - Метод получения: Не реализован
   - Fallback: Не используется

6. **Medical Conditions Match:**
   - Источник: База данных `care_homes.medical_specialisms` и `care_homes.regulated_activities`
   - Метод получения:
     - Из БД: `raw_home.get('medical_specialisms', [])`
     - Из Firecrawl: `structured_data.care_services.medical_services[]` и `structured_data.care_services.specializations[]`
   - Сопоставление: Сравниваются `user.medical_conditions[]` с `home.specialties[]`
   - Флаги: Если условие не покрыто, показывается предупреждение

7. **Strengths и Concerns:**
   - Источник: Генерация на основе CQC ratings, специализаций и Firecrawl data
   - Метод генерации:
     - Анализируются CQC Effective rating, доступные специализации
     - Если есть соответствие медицинским условиям → strength
     - Если отсутствует специализация → concern

**Логика получения данных:**

Medical Care Score рассчитывается как часть matching алгоритма, но для этой секции важна детальная информация о медицинских возможностях дома. CQC Clinical Rating (Effective rating) - это оценка CQC того, насколько эффективно дом предоставляет медицинскую помощь. Это не то же самое, что Safety rating - Effective rating фокусируется на результатах лечения и поддержки здоровья.

Медицинские специализации дома могут быть указаны в базе данных (medical_specialisms, regulated_activities) или извлечены из сайта дома через Firecrawl. Firecrawl сканирует разделы сайта, связанные с медицинскими услугами, и извлекает структурированную информацию о том, какие условия лечатся, какие специализации есть, какие медицинские услуги предоставляются.

Система сопоставляет медицинские условия пользователя (из опросника) с доступными специализациями дома. Это критически важно - если у пользователя диабет, а дом не специализируется на диабете, это должно быть отмечено как concern. Если есть соответствие, это strength.

Для детальных метрик (nursing hours, GP visit frequency, readmission rate) система использует оценки или fallback, так как эти данные редко публикуются напрямую. Nursing hours могут быть оценены на основе типа ухода (nursing homes обычно имеют больше nursing coverage, чем residential). GP visit frequency может быть оценена на основе доступности GPs поблизости (через NHSBSA data), но это не точная информация о том, как часто конкретный дом организует визиты GP.

**Проверка корректности:**
- ✅ Medical care score и CQC rating доступны
- ✅ Medical conditions match может быть рассчитан
- ❌ Детальные метрики (nursing hours, GP frequency, readmission rate) отсутствуют
- ⚠️ Strengths/concerns генерируются на основе доступных данных

---

### СЕКЦИЯ 9: Staff Quality Analysis (Страница 9)

**Требуемые данные по ТЗ:**
- Staff Quality Score (0-100)
- Staff Retention Rate (%)
- Agency Staff Usage (%)
- Staff-to-Resident Ratio
- Training Level (NVQ)
- Strengths

**Источники данных в проекте:**

1. **Staff Quality Score:**
   - Источник: `match_result.factor_scores.staff`
   - Метод расчета: Рассчитывается в рамках 156-точечного алгоритма на основе данных о персонале

2. **Staff Retention Rate:**
   - Источник: `StaffEnrichmentService` через LinkedIn data
   - Метод получения:
     - Анализируется LinkedIn профиль компании
     - Рассчитывается процент сотрудников, работающих более 2 лет
     - Используется `LinkedInResearchService` для получения данных о сотрудниках

3. **Agency Staff Usage:**
   - Источник: `StaffEnrichmentService` через Job Boards analysis
   - Метод получения:
     - Анализируются объявления о вакансиях на job boards
     - Если много временных/agency позиций → высокий процент использования agency staff
     - Используется `JobBoardsService` для анализа

4. **Staff-to-Resident Ratio:**
   - Источник: База данных `care_homes.beds_total` и расчетное количество персонала
   - Метод расчета:
     - Если есть `staff_count` в БД → `beds_total / staff_count`
     - Иначе используется оценка на основе типа ухода и размера дома

5. **Training Level:**
   - Источник: `StaffEnrichmentService` через LinkedIn certifications
   - Метод получения:
     - Анализируются сертификаты сотрудников на LinkedIn
     - Рассчитывается процент сотрудников с NVQ qualifications
     - Используется `LinkedInResearchService`

6. **Strengths:**
   - Источник: Генерация на основе данных о персонале
   - Метод генерации:
     - Высокий retention rate → strength
     - Низкий agency usage → strength
     - Высокий training level → strength

**Логика получения данных:**

Данные о качестве персонала получаются через комплексный анализ нескольких источников. Staff Retention Rate рассчитывается путем анализа LinkedIn профилей сотрудников care home. Система ищет компанию на LinkedIn, находит сотрудников, которые работают или работали в этом доме, и анализирует длительность их работы. Если много сотрудников работают более 2 лет, это указывает на высокий retention rate. Это важно, потому что высокая текучесть кадров означает, что у жильцов постоянно меняются лица, осуществляющие уход, что плохо для качества ухода.

Agency Staff Usage определяется через анализ объявлений о вакансиях на job boards. Если дом постоянно размещает объявления о временных позициях или agency staff, это указывает на высокую зависимость от временного персонала. Agency staff обычно менее знакомы с конкретными потребностями жильцов и могут обеспечить менее качественный уход.

Staff-to-Resident Ratio - это простая математика: общее количество кроватей делится на количество персонала. Однако количество персонала может быть не указано в базе данных, в таком случае система использует оценку на основе типа ухода и размера дома. Nursing homes обычно имеют более низкое соотношение (больше персонала на жильца), чем residential homes.

Training Level определяется через анализ сертификатов сотрудников на LinkedIn. Система ищет NVQ (National Vocational Qualification) qualifications, которые являются стандартными квалификациями для care workers в Великобритании. Высокий процент сотрудников с NVQ qualifications указывает на профессиональную подготовку персонала.

**Проверка корректности:**
- ✅ Staff quality score доступен
- ✅ Данные о персонале доступны через StaffEnrichmentService
- ⚠️ Некоторые метрики могут быть оценками на основе анализа, а не точными данными

---

### СЕКЦИЯ 10: Community Reputation (Страница 10)

**Требуемые данные по ТЗ:**
- Trust Score (0-100)
- Google Rating (1-5)
- Number of Reviews
- CareHome.co.uk Rating
- Sentiment Analysis (positive/neutral/negative %)
- Management Response Rate
- Sample Reviews

**Источники данных в проекте:**

1. **Trust Score:**
   - Источник: Расчет на основе Google rating, review count и sentiment
   - Метод расчета:
     - Композитный счет на основе Google rating (вес 40%), review count (вес 20%), sentiment (вес 40%)
     - Нормализуется до 0-100

2. **Google Rating:**
   - Источник: `GooglePlacesService` через `GET /api/google-places/details/{place_id}`
   - Метод получения: `google_places_data.get('rating')` (1-5 stars)

3. **Review Count:**
   - Источник: `GooglePlacesService` через `GET /api/google-places/details/{place_id}`
   - Метод получения: `google_places_data.get('user_ratings_total')`

4. **CareHome.co.uk Rating:**
   - Источник: `Firecrawl Explorer` через `POST /api/firecrawl/unified-analysis`
   - Метод получения: `structured_data.reviews.average_rating` и `structured_data.reviews.review_count`

5. **Sentiment Analysis:**
   - Источник: `GooglePlacesEnrichmentService._analyze_sentiment_simple()`
   - Метод получения:
     - Анализируются тексты reviews из Google Places
     - Рассчитывается распределение: `sentiment_distribution.positive`, `sentiment_distribution.negative`, `sentiment_distribution.neutral`
     - Проценты нормализуются

6. **Management Response Rate:**
   - Источник: ❌ Не доступен напрямую
   - Метод получения: Может быть извлечен из анализа Google reviews (наличие ответов management)
   - Fallback: Используется оценка или не показывается

7. **Sample Reviews:**
   - Источник: `GooglePlacesService` через `GET /api/google-places/details/{place_id}`
   - Метод получения: `google_places_data.get('reviews', [])` - массив объектов с `author_name`, `rating`, `text`, `time`
   - Выборка: Выбираются representative positive и critical reviews

**Логика получения данных:**

Trust Score - это композитный показатель, который объединяет несколько источников информации о репутации. Система берет Google rating (который является публичным и доступным), количество отзывов (больше отзывов = более надежная оценка), и sentiment analysis (анализ тональности отзывов). Эти три компонента взвешиваются: rating 40%, количество отзывов 20%, sentiment 40%. Это означает, что даже дом с высоким рейтингом может получить низкий trust score, если отзывы в основном негативные по тональности.

Google Rating и Review Count получаются напрямую из Google Places API. Это публичные данные, которые видны всем пользователям Google Maps. Система использует place_id care home для запроса этих данных. Важно понимать, что Google rating может быть неполным - не все семьи оставляют отзывы, и некоторые дома могут иметь мало отзывов.

CareHome.co.uk Rating - это альтернативный источник отзывов, специфичный для care homes. Система пытается извлечь эту информацию через сканирование сайта carehome.co.uk через Firecrawl, если дом там зарегистрирован. Это может дать дополнительную перспективу, так как carehome.co.uk специализируется именно на care homes.

Sentiment Analysis выполняется путем анализа текстов отзывов из Google Places. Система использует простой алгоритм анализа тональности, который классифицирует каждый отзыв как positive, negative или neutral на основе используемых слов и фраз. Затем рассчитывается процентное распределение. Это важно, потому что дом может иметь рейтинг 4 звезды, но если большинство отзывов нейтральные или слегка негативные, это может указывать на проблемы.

Sample Reviews выбираются так, чтобы дать сбалансированную картину - показываются как положительные, так и критические отзывы. Это важно для честности и прозрачности.

**Проверка корректности:**
- ✅ Google rating и reviews доступны через Google Places API
- ✅ Sentiment analysis реализован
- ✅ CareHome.co.uk rating может быть извлечен из Firecrawl
- ⚠️ Management response rate может быть недоступен

---

### СЕКЦИЯ 11: Family Engagement Insights (Страница 11)

**Требуемые данные по ТЗ:**
- Average Visit Duration (minutes)
- Repeat Visitor Rate (%)
- Monthly Footfall Trend (Growing/Stable/Declining)
- Peak Visiting Hours
- 12-Month Footfall Data

**Источники данных в проекте:**

1. **Average Visit Duration:**
   - Источник: `GooglePlacesEnrichmentService` через `GET /api/google-places/{place_id}/dwell-time`
   - Метод получения: `dwell_time.average_dwell_time_minutes` из Google Places Insights API
   - Статус: ⚠️ Может использовать fallback если данные недоступны

2. **Repeat Visitor Rate:**
   - Источник: `GooglePlacesEnrichmentService` через `GET /api/google-places/{place_id}/repeat-visitors`
   - Метод получения: `repeat_visitor_rate.repeat_visitor_rate_percent` из Google Places Insights API
   - Статус: ⚠️ Может использовать fallback на основе rating если данные недоступны

3. **Monthly Footfall Trend:**
   - Источник: `GooglePlacesEnrichmentService` через `GET /api/google-places/{place_id}/footfall-trends`
   - Метод получения: `footfall_trends.trend_direction` (Growing/Stable/Declining)
   - Статус: ⚠️ Может быть None если данные недоступны

4. **Peak Visiting Hours:**
   - Источник: `GooglePlacesService` через `GET /api/google-places/{place_id}/popular-times`
   - Метод получения: `popular_times` - массив данных по дням и часам, извлекаются часы с максимальной посещаемостью
   - Формат: Массив временных диапазонов (например, ["14:00-16:00", "18:00-20:00"])

5. **12-Month Footfall Data:**
   - Источник: `GooglePlacesEnrichmentService` через `GET /api/google-places/{place_id}/footfall-trends`
   - Метод получения: `footfall_trends.monthly_counts[]` - массив месячных данных за последние 12 месяцев
   - Статус: ⚠️ Может быть недоступен

**Логика получения данных:**

Эта секция использует уникальные данные Google Places Insights API, которые предоставляют поведенческую аналитику на основе реальных посещений. Average Visit Duration показывает, сколько времени в среднем проводят посетители (обычно семьи) в care home. Это важный показатель - если семьи проводят много времени, это может указывать на то, что они чувствуют себя комфортно и довольны атмосферой. Данные получаются через специальный endpoint Google Places Insights API, который анализирует анонимизированные данные о посещениях.

Repeat Visitor Rate показывает процент посетителей, которые возвращаются. Высокий repeat rate означает, что семьи регулярно посещают своих близких, что может указывать на удовлетворенность уходом и комфортную атмосферу. Низкий repeat rate может быть красным флагом. Эти данные также получаются через Google Places Insights API.

Monthly Footfall Trend показывает, растет ли, стабильна или снижается посещаемость за последние месяцы. Растущий тренд может указывать на улучшение репутации или увеличение числа жильцов. Снижающийся тренд может быть ранним предупреждающим знаком о проблемах. Система анализирует месячные данные за последние 12 месяцев и определяет общий тренд.

Peak Visiting Hours получаются из Google Places Popular Times - это данные о том, в какие часы обычно больше всего посетителей. Это полезно для рекомендации, когда лучше планировать визит, чтобы увидеть дом в "живом" состоянии и пообщаться с другими семьями.

Важно отметить, что эти данные могут быть недоступны для всех care homes - Google Places Insights доступны не для всех мест. В таком случае система использует fallback значения на основе общего рейтинга, но это менее точно.

**Проверка корректности:**
- ⚠️ Данные доступны через Google Places Insights API, но могут использовать fallback
- ⚠️ Нужно убедиться, что используется реальный API, а не только fallback значения
- ✅ Popular times доступны через Google Places API

---

### СЕКЦИЯ 12: Financial Stability (Страница 12)

**Требуемые данные по ТЗ:**
- Financial Stability Score (0-100)
- Altman Z-Score
- Years in Operation
- Ownership Type
- Recent Fee Increases
- Bankruptcy Risk Level
- Fee Transparency Rating

**Источники данных в проекте:**

1. **Financial Stability Score:**
   - Источник: `match_result.factor_scores.financial`
   - Метод расчета: Рассчитывается в рамках 156-точечного алгоритма на основе финансовых данных

2. **Altman Z-Score:**
   - Источник: `CompaniesHouseService.get_financial_stability()`
   - Метод получения:
     - Загружаются финансовые данные из Companies House API
     - Рассчитывается Altman Z-Score на основе балансовых отчетов
     - Интерпретация: >2.6 = safe, 1.1-2.6 = grey zone, <1.1 = distress

3. **Years in Operation:**
   - Источник: База данных `care_homes.year_opened` или Companies House filing date
   - Метод расчета: `current_year - year_opened` или из Companies House incorporation date

4. **Ownership Type:**
   - Источник: `CompaniesHouseService` через анализ структуры собственности
   - Метод получения:
     - Анализируется структура компании в Companies House
     - Определяется: "Independent", "Small chain", "Large chain", "Private equity"
     - Используется анализ связанных компаний и структуры группы

5. **Recent Fee Increases:**
   - Источник: Autumna data или расчет на основе pricing history
   - Метод получения:
     - Если доступна история цен из Autumna → извлекаются изменения за последние 3 года
     - Иначе используется оценка на основе текущей цены и региональных трендов

6. **Bankruptcy Risk Level:**
   - Источник: Расчет на основе Altman Z-Score
   - Метод расчета:
     - Low Risk если Z-Score > 2.6
     - Medium Risk если Z-Score 1.1-2.6
     - High Risk если Z-Score < 1.1

7. **Fee Transparency Rating:**
   - Источник: Оценка на основе доступности информации о ценах
   - Метод расчета:
     - Анализируется наличие детальной информации о ценах на сайте или в данных
     - Рейтинг 1-5 на основе прозрачности

**Логика получения данных:**

Финансовая стабильность оценивается через анализ данных Companies House - официального реестра всех компаний в Великобритании. Altman Z-Score - это финансовый индикатор, разработанный для предсказания банкротства. Он рассчитывается на основе балансовых отчетов компании: соотношение оборотного капитала к активам, нераспределенная прибыль к активам, операционная прибыль к активам, рыночная стоимость акций к обязательствам, и выручка к активам. Score выше 2.6 считается безопасным, 1.1-2.6 - серой зоной, ниже 1.1 - зоной риска. Это важно, потому что финансово нестабильный дом может закрыться, что катастрофично для жильцов.

Years in Operation показывает, как долго дом работает. Дома, работающие много лет, обычно более стабильны. Данные берутся либо из базы данных (year_opened), либо из Companies House (дата регистрации компании).

Ownership Type определяется через анализ структуры компании в Companies House. Система проверяет, является ли компания частью группы, сколько у нее связанных компаний, какая структура собственности. Independent homes - это отдельные независимые дома. Small chain - 2-10 домов. Large chain - более 10 домов. Private equity - дома, принадлежащие частным инвестиционным фондам. Это важно, потому что private equity ownership может означать давление на сокращение затрат, что может влиять на качество ухода.

Recent Fee Increases анализируются через историю цен, если она доступна из Autumna или других источников. Система ищет изменения цен за последние 3 года. Частые или значительные повышения цен могут указывать на финансовые проблемы или жадность.

Bankruptcy Risk Level напрямую выводится из Altman Z-Score - это интерпретация числового значения в понятные категории риска.

Fee Transparency Rating оценивается на основе того, насколько легко найти информацию о ценах. Если дом публикует детальные цены на сайте, это высокий рейтинг прозрачности. Если цены скрыты или требуют звонка, это низкий рейтинг.

**Проверка корректности:**
- ✅ Financial stability score доступен
- ✅ Altman Z-Score рассчитывается из Companies House данных
- ✅ Ownership type определяется через анализ Companies House
- ⚠️ Fee increases могут быть оценками если нет истории цен

---

### СЕКЦИЯ 13: Fair Cost Gap Calculator (Страница 13)

**Требуемые данные по ТЗ:**
- Quoted Weekly Fee
- Fair Market Price
- Overcharge Amount и Percent
- Negotiation Potential
- Negotiation Scripts
- ROI Calculation

**Источники данных в проекте:**

1. **Quoted Weekly Fee:**
   - Источник: База данных `care_homes.weekly_price` или `extract_weekly_price()`
   - Метод получения:
     - Из БД: `raw_home.get('weekly_price')`
     - Или извлечение из `raw_home.get('price')` с конвертацией если нужно

2. **Fair Market Price:**
   - Источник: `NegotiationStrategyService.generate_negotiation_strategy()`
   - Метод расчета:
     - Используется алгоритм сравнения с 15,000+ UK care homes
     - Учитываются: CQC ratings, местоположение, тип ухода, размер дома
     - Используются данные MSIF (Market Standard Information Framework) для fair cost benchmarks
     - Endpoint: `GET /api/msif/fair-cost/{local_authority}`

3. **Overcharge Amount и Percent:**
   - Источник: Расчет
   - Метод расчета:
     - `overcharge_amount = quoted_weekly_fee - fair_market_price`
     - `overcharge_percent = (overcharge_amount / fair_market_price) * 100`

4. **Negotiation Potential:**
   - Источник: `NegotiationStrategyService`
   - Метод расчета:
     - Оценивается потенциал для переговоров на основе overcharge amount
     - Учитываются факторы: конкуренция в регионе, occupancy rate, время на рынке

5. **Negotiation Scripts:**
   - Источник: `NegotiationStrategyService.generate_negotiation_strategy()`
   - Метод получения:
     - Генерируются word-for-word скрипты на основе данных о доме и market data
     - 3 типа скриптов: "How to ask for a discount", "Negotiating based on market data", "Requesting fee freeze guarantee"
     - Персонализируются с конкретными данными (название дома, суммы)

6. **ROI Calculation:**
   - Источник: Расчет
   - Метод расчета:
     - `annual_savings = overcharge_amount * 52`
     - `5_year_impact = annual_savings * 5`
     - `ROI = annual_savings / 119` (стоимость отчета)

**Логика получения данных:**

Quoted Weekly Fee - это цена, которую care home указывает для пользователя. Она может быть в базе данных или получена из других источников (например, Autumna). Важно понимать, что это не всегда финальная цена - могут быть дополнительные сборы.

Fair Market Price рассчитывается через сложный алгоритм, который сравнивает дом с базой из 15,000+ UK care homes. Алгоритм учитывает множество факторов: CQC ratings (дома с высокими рейтингами могут стоить дороже), местоположение (дома в дорогих районах стоят дороже), тип ухода (nursing дороже residential), размер дома, и другие факторы. Система также использует данные MSIF (Market Standard Information Framework) - это официальные данные о справедливых ценах по local authorities. MSIF предоставляет benchmarks для fair cost в каждом регионе, основанные на реальных данных о ценах и качестве.

Overcharge Amount и Percent - это простой расчет разницы между quoted fee и fair market price. Если quoted fee выше fair market price, это overcharge. Процент показывает, насколько выше цена, чем должна быть.

Negotiation Potential оценивается на основе нескольких факторов: размер overcharge (больше overcharge = больше потенциал для переговоров), конкуренция в регионе (если много домов поблизости, больше потенциал), occupancy rate дома (если дом не заполнен, больше готовность к переговорам), и время на рынке (новые дома могут быть более гибкими).

Negotiation Scripts генерируются автоматически на основе конкретных данных о доме и ситуации. Система создает word-for-word скрипты, которые пользователь может использовать при звонке или встрече с домом. Скрипты персонализируются с конкретными суммами, названием дома, и market data. Это важно, потому что многие семьи не знают, как вести переговоры о ценах.

ROI Calculation показывает, насколько выгодным было использование отчета. Если отчет стоит £119, а потенциальная экономия £3,000 в год, ROI = 25x. Это помогает пользователю понять ценность отчета.

**Проверка корректности:**
- ✅ Quoted fee доступен из БД
- ✅ Fair market price рассчитывается через NegotiationStrategyService с использованием MSIF data
- ✅ Negotiation scripts генерируются автоматически
- ✅ ROI рассчитывается корректно

---

### СЕКЦИЯ 14: Funding Options (Страница 14)

**Требуемые данные по ТЗ:**
- NHS CHC Eligibility Probability
- CHC Weekly Value
- Local Authority Name
- Local Authority Rules (means test threshold, contact info)
- Council Funding Calculator
- Contact Information для funding routes

**Источники данных в проекте:**

1. **NHS CHC Eligibility Probability:**
   - Источник: Расчет на основе assessment
   - Метод расчета:
     - Анализируются: `medical_conditions[]`, `care_types[]`, `mobility_level`, `medication_management`
     - Логика:
       - High если: dementia/Alzheimer's в conditions ИЛИ palliative в care_types ИЛИ bed-bound ИЛИ full medication administration
       - Medium если: 2+ medical conditions ИЛИ nursing в care_types
       - Low в остальных случаях

2. **CHC Weekly Value:**
   - Источник: Статическое значение
   - Значение: "£500-1,500/week" (не персонализируется)

3. **Local Authority Name:**
   - Источник: `AsyncDataLoader.resolve_postcode()` или `GET /api/neighbourhood/analyze/{postcode}`
   - Метод получения:
     - Из postcode resolution: `local_authority` из OS Places или ONS data
     - Или из Neighbourhood Analysis: `ons.geography.local_authority`

4. **Local Authority Rules:**
   - Источник: ❌ База данных для 152 councils отсутствует
   - Метод получения:
     - Может использоваться MSIF data для fair cost benchmarks по local authority
     - Endpoint: `GET /api/msif/fair-cost/{local_authority}`
   - Fallback: Используются общие UK funding rules

5. **Council Funding Calculator:**
   - Источник: Логика расчета means test
   - Метод расчета:
     - Input: savings, property value (от пользователя)
     - Output: "Likely eligible" если `savings < £23,250`, иначе "Unlikely eligible"
     - Используется стандартный UK means test threshold

6. **Contact Information:**
   - Источник: ❌ База данных с контактами для 152 councils отсутствует
   - Метод получения: Требуется создание базы данных или использование внешнего API
   - Fallback: Используются общие контакты или не показываются

**Логика получения данных:**

NHS CHC (Continuing Healthcare) Eligibility Probability рассчитывается на основе анализа медицинских потребностей пользователя. CHC - это финансирование NHS для людей с серьезными медицинскими потребностями, которое может покрывать £500-1,500 в неделю. Система анализирует ответы в опроснике: наличие деменции/Альцгеймера, потребность в паллиативной помощи, уровень мобильности (bed-bound), потребность в полном управлении медикаментами. Если присутствуют серьезные медицинские потребности, вероятность High. Если есть несколько условий или требуется nursing care, вероятность Medium. Это важно, потому что CHC может значительно снизить финансовую нагрузку на семью.

Local Authority Name определяется через resolution postcode - система берет postcode пользователя и определяет, в каком local authority (совете) он находится. Это делается через OS Places API или ONS data, которые содержат маппинг postcodes к local authorities. В Великобритании 152 local authorities, и у каждого свои правила финансирования.

Local Authority Rules - это специфические правила каждого совета о том, кто имеет право на council funding, какие пороги means test, какие процедуры подачи заявки. К сожалению, эти данные не централизованы и требуют создания базы данных для всех 152 councils. Система может использовать MSIF data для получения fair cost benchmarks по local authority, что дает некоторую информацию о финансировании в регионе.

Council Funding Calculator использует стандартную логику UK means test. Если сбережения пользователя меньше £23,250, он, вероятно, имеет право на council funding. Если больше - вряд ли. Это упрощенная версия, так как полный means test учитывает также доход, стоимость имущества (с исключениями), и другие факторы.

**Проверка корректности:**
- ✅ CHC probability рассчитывается на основе assessment
- ✅ Local authority определяется из postcode
- ⚠️ Local authority rules и контакты могут быть недоступны - требуется база данных
- ✅ Council funding calculator использует стандартную логику means test

---

### СЕКЦИЯ 15: 14-Day Action Plan (Страница 15)

**Требуемые данные по ТЗ:**
- Top Choice name и phone
- Local Authority name и phone
- Peak Visiting Hours
- User full name
- Static task templates

**Источники данных в проекте:**

1. **Top Choice name и phone:**
   - Источник: База данных `care_homes` (топ-выбор из matching)
   - Метод получения: `top_choice.name` и `top_choice.phone` из результата matching

2. **Local Authority name:**
   - Источник: `GET /api/neighbourhood/analyze/{postcode}` или `AsyncDataLoader.resolve_postcode()`
   - Метод получения: `ons.geography.local_authority` из Neighbourhood Analysis

3. **Local Authority phone:**
   - Источник: ❌ База данных с контактами отсутствует
   - Метод получения: Требуется создание базы данных
   - Fallback: Используется placeholder или не показывается

4. **Peak Visiting Hours:**
   - Источник: `GooglePlacesService` через `GET /api/google-places/{place_id}/popular-times`
   - Метод получения: `popular_times` - извлекаются часы с максимальной посещаемостью
   - Формат: Массив временных диапазонов для использования в тексте задач

5. **User full name:**
   - Источник: `questionnaire.section_1_contact_emergency.q1_names`
   - Метод получения: Извлекается из опросника

6. **Task Templates:**
   - Источник: Статические шаблоны
   - Метод генерации:
     - Шаблоны заполняются данными: `[Top Choice Name]`, `[phone]`, `[local_authority_name]`, `[peak_hours]`, `[user_name]`
     - Персонализируются для каждого пользователя

**Проверка корректности:**
- ✅ Все основные данные доступны
- ⚠️ Local authority phone может быть недоступен
- ✅ Peak visiting hours доступны через Google Places API

---

### СЕКЦИЯ 16: Comfort & Lifestyle (Страница 16)

**Требуемые данные по ТЗ:**
- Comfort Score (0-100)
- Private Room Percentage
- En-suite Availability
- Average Room Size
- Wheelchair Accessible
- Weekly Activities Count
- Outdoor Space Description
- Outings per Month
- Meal Choice Availability
- Dining Ambience Rating
- Room Photos

**Источники данных в проекте:**

1. **Comfort Score:**
   - Источник: `match_result.factor_scores.social` (маппится на Comfort)
   - Метод расчета: Рассчитывается в рамках 156-точечного алгоритма на основе facilities, activities, и других факторов комфорта

2. **Private Room Percentage:**
   - Источник: `Firecrawl Explorer` через `POST /api/firecrawl/unified-analysis`
   - Метод получения: `structured_data.facilities.rooms[]` - анализируется процент private rooms
   - Или из БД: `raw_home.get('private_rooms_percentage')`

3. **En-suite Availability:**
   - Источник: `Firecrawl Explorer` через `POST /api/firecrawl/unified-analysis`
   - Метод получения: `structured_data.facilities.rooms[]` - проверяется наличие en-suite
   - Значения: "Yes", "No", "Some"

4. **Average Room Size:**
   - Источник: `Firecrawl Explorer` через `POST /api/firecrawl/unified-analysis`
   - Метод получения: `structured_data.facilities.rooms[]` - рассчитывается средний размер комнат
   - Или из БД: `raw_home.get('avg_room_size_sqm')`

5. **Wheelchair Accessible:**
   - Источник: `Firecrawl Explorer` через `POST /api/firecrawl/unified-analysis`
   - Метод получения: `structured_data.facilities.accessibility[]` - проверяется wheelchair access
   - Или из БД: `raw_home.get('wheelchair_accessible')`

6. **Weekly Activities Count:**
   - Источник: `Firecrawl Explorer` через `POST /api/firecrawl/unified-analysis`
   - Метод получения: `structured_data.activities.daily_activities[]` - подсчитывается количество уникальных активностей в неделю
   - Или из БД: `raw_home.get('activities', [])`

7. **Outdoor Space Description:**
   - Источник: `Firecrawl Explorer` через `POST /api/firecrawl/unified-analysis`
   - Метод получения: `structured_data.facilities.outdoor_spaces[]` - генерируется описание на основе списка outdoor spaces
   - Или из БД: `raw_home.get('outdoor_spaces')`

8. **Outings per Month:**
   - Источник: `Firecrawl Explorer` через `POST /api/firecrawl/unified-analysis`
   - Метод получения: `structured_data.activities.outings[]` - оценивается частота outings
   - Или из БД: `raw_home.get('outings_per_month')`

9. **Meal Choice Availability:**
   - Источник: `Firecrawl Explorer` через `POST /api/firecrawl/unified-analysis`
   - Метод получения: `structured_data.nutrition.dining_options[]` или `structured_data.nutrition.dietary_accommodations[]`
   - Или из БД: `raw_home.get('dietary_options', [])`

10. **Dining Ambience Rating:**
    - Источник: `Firecrawl Explorer` через `POST /api/firecrawl/unified-analysis`
    - Метод получения: `structured_data.nutrition.dining_environment` - анализируется описание dining environment
    - Или оценка на основе других данных

11. **Room Photos:**
    - Источник: `GooglePlacesService` через `GET /api/google-places/details/{place_id}` или `Firecrawl Explorer`
    - Метод получения:
      - Google Places: `google_places_data.get('photos', [])` - массив photo_references
      - Firecrawl: `structured_data.media.photo_gallery[]`
    - URL генерация: `GET /api/google-places/{place_id}/photo/{photo_reference}` для Google Places

**Логика получения данных:**

Comfort Score рассчитывается как часть matching алгоритма, но для этой секции важны детальные данные о комфорте и образе жизни. Большинство данных получаются через сканирование сайта care home через Firecrawl. Firecrawl - это сервис, который сканирует веб-сайты и извлекает структурированную информацию.

Private Room Percentage, En-suite Availability, Average Room Size извлекаются из раздела Facilities на сайте дома. Firecrawl ищет информацию о комнатах: сколько их, какие типы (private, shared), есть ли en-suite, какой размер. Если информация не найдена на сайте, система пытается использовать данные из базы данных, если они там есть.

Wheelchair Accessible определяется через анализ accessibility информации на сайте или в базе данных. Это критически важно для пользователей с ограниченной мобильностью.

Weekly Activities Count подсчитывается из списка daily activities, извлеченного через Firecrawl. Система анализирует раздел Activities на сайте и считает уникальные активности, которые предлагаются в неделю.

Outdoor Space Description генерируется на основе списка outdoor spaces (сады, патио, террасы и т.д.), найденных на сайте. Система создает текстовое описание на основе найденных элементов.

Meal Choice Availability и Dining Ambience Rating извлекаются из раздела Nutrition на сайте. Система ищет информацию о вариантах питания, меню, диетических опциях, и атмосфере столовой.

Room Photos получаются либо из Google Places (если дом зарегистрирован в Google), либо из галереи на сайте через Firecrawl. Google Places обычно имеет фотографии, загруженные пользователями или владельцами, что может дать более реалистичное представление, чем официальные фотографии на сайте.

**Проверка корректности:**
- ✅ Comfort score доступен
- ✅ Большинство данных доступны через Firecrawl Explorer
- ✅ Photos доступны через Google Places API или Firecrawl
- ⚠️ Некоторые данные могут быть оценками если не найдены в Firecrawl

---

### СЕКЦИЯ 17: Lifestyle Deep Dive (Страница 17)

**Требуемые данные по ТЗ:**
- Sample Daily Schedule
- Activity Categories
- Personalization Description
- Visiting Hours
- Overnight Guests Allowed
- Family Involvement Policy
- Pet Policy

**Источники данных в проекте:**

1. **Sample Daily Schedule:**
   - Источник: Генерация на основе `Firecrawl Explorer` данных
   - Метод генерации:
     - Используются `structured_data.activities.daily_activities[]` и `structured_data.nutrition.meal_times`
     - Создается timeline с временными слотами (08:00 Breakfast, 09:00 Activity, и т.д.)
     - Activities маппятся на временные слоты
     - Или из БД: `raw_home.get('daily_schedule')`

2. **Activity Categories:**
   - Источник: `Firecrawl Explorer` через `POST /api/firecrawl/unified-analysis`
   - Метод получения: `structured_data.activities.daily_activities[]` - группировка по категориям (Arts & Crafts, Music, Exercise, Outings)
   - Или из БД: `raw_home.get('activity_categories', [])`

3. **Personalization Description:**
   - Источник: `Firecrawl Explorer` через `POST /api/firecrawl/unified-analysis`
   - Метод получения: `structured_data.care_services.care_plans` или `structured_data.care_services.personalization`
   - Или из БД: `raw_home.get('personalization_description')`
   - Альтернатива: `Perplexity AI` через `POST /api/perplexity/comprehensive-research` для поиска информации о персонализации

4. **Visiting Hours:**
   - Источник: `Firecrawl Explorer` через `POST /api/firecrawl/unified-analysis`
   - Метод получения: `structured_data.contact.visiting_hours` (строка)
   - Или из БД: `raw_home.get('visiting_hours')`

5. **Overnight Guests Allowed:**
   - Источник: `Firecrawl Explorer` или `Perplexity AI`
   - Метод получения:
     - Firecrawl: может быть в `structured_data.care_services` или общем тексте
     - Perplexity: `POST /api/perplexity/comprehensive-research` с запросом о overnight guest policy
   - Или из БД: `raw_home.get('overnight_guests_allowed')`

6. **Family Involvement Policy:**
   - Источник: `Firecrawl Explorer` или `Perplexity AI`
   - Метод получения:
     - Firecrawl: может быть в `structured_data.care_services`
     - Perplexity: `POST /api/perplexity/comprehensive-research` с запросом о family involvement
   - Или из БД: `raw_home.get('family_involvement_policy')`

7. **Pet Policy:**
   - Источник: `Firecrawl Explorer` или `Perplexity AI`
   - Метод получения:
     - Firecrawl: может быть в `structured_data.care_services` или общем тексте
     - Perplexity: `POST /api/perplexity/comprehensive-research` с запросом о pet policy
   - Значения: "Pets welcome", "Visiting pets only", "No pets"
   - Или из БД: `raw_home.get('pet_policy')`

**Логика получения данных:**

Sample Daily Schedule генерируется на основе списка daily activities, извлеченного через Firecrawl. Система создает типичный распорядок дня, распределяя activities по временным слотам. За основу берутся стандартные времена приема пищи (завтрак около 8:00, обед около 12:30, ужин около 18:00), а activities распределяются между ними. Это дает представление о том, как проходит день в доме, хотя это может быть не точное расписание конкретного дома.

Activity Categories группируются из списка daily activities. Система классифицирует активности по типам: Arts & Crafts (рукоделие, рисование), Music (музыкальная терапия, пение), Exercise (физические упражнения, прогулки), Outings (выезды, экскурсии), и т.д. Это помогает понять разнообразие предлагаемых активностей.

Personalization Description извлекается из раздела Care Services на сайте, где обычно описывается, как дом персонализирует уход под индивидуальные потребности. Если эта информация не найдена на сайте, система может использовать Perplexity AI для поиска информации о персонализации в других источниках (новостные статьи, обзоры, официальные документы).

Visiting Hours обычно четко указаны на сайте дома в разделе Contact или Visiting Information. Это важная информация для семей, планирующих визиты.

Policies (overnight guests, family involvement, pets) часто не публикуются явно на сайте, но могут быть упомянуты в общем тексте или FAQ. Firecrawl пытается найти эту информацию, но если не находит, система использует Perplexity AI для поиска в других источниках. Perplexity AI может найти информацию в обзорах, новостных статьях, или других публичных источниках. Однако это менее надежно, чем прямая информация с сайта.

**Проверка корректности:**
- ✅ Activities и visiting hours доступны через Firecrawl
- ✅ Daily schedule генерируется на основе activities
- ⚠️ Policies (overnight, family, pets) могут требовать Perplexity AI если не найдены в Firecrawl
- ⚠️ Personalization может быть неполной если не найдена в Firecrawl

---

### СЕКЦИЯ 18: Location Wellbeing (Страница 18)

**Требуемые данные по ТЗ:**
- Green Space Score (0-10)
- Noise Level (Quiet/Moderate/Busy)
- Air Quality Index
- Walkability Score (0-100)
- Nearest Park Distance
- Local Amenities
- Neighbourhood Crime Rate

**Источники данных в проекте:**

1. **Green Space Score:**
   - Источник: `Neighbourhood Explorer` через `GET /api/neighbourhood/analyze/{postcode}`
   - Метод получения: `osm.amenities.by_category.parks[]` - рассчитывается score на основе количества и близости парков
   - Нормализация: 0-10 на основе density и accessibility парков

2. **Noise Level:**
   - Источник: `Neighbourhood Explorer` через `GET /api/neighbourhood/analyze/{postcode}?include_environmental=true`
   - Метод получения: `environmental.noise_level` из Environmental Analyzer
   - Значения: "Quiet", "Moderate", "Busy"
   - Файл: `api-testing-suite/backend/data_integrations/environmental_analyzer.py`

3. **Air Quality Index:**
   - Источник: ❌ Не доступен напрямую
   - Метод получения: Требуется внешний API (например, UK Air Quality API)
   - Fallback: Не используется или показывается "Data not available"

4. **Walkability Score:**
   - Источник: `Neighbourhood Explorer` через `GET /api/neighbourhood/analyze/{postcode}`
   - Метод получения: `osm.walk_score.score` (0-100) из OSM Loader
   - Файл: `api-testing-suite/backend/data_integrations/osm_loader.py`

5. **Nearest Park Distance:**
   - Источник: `Neighbourhood Explorer` через `GET /api/neighbourhood/analyze/{postcode}`
   - Метод получения: `osm.amenities.by_category.parks[0].distance_m` - расстояние до ближайшего парка в метрах

6. **Local Amenities:**
   - Источник: `Neighbourhood Explorer` через `GET /api/neighbourhood/analyze/{postcode}`
   - Метод получения: `osm.amenities.by_category` - извлекаются grocery, restaurants, shopping, healthcare
   - Формат: Массив объектов с названием и расстоянием

7. **Neighbourhood Crime Rate:**
   - Источник: ❌ Не доступен
   - Метод получения: Требуется внешний API (например, Police UK API)
   - Fallback: Не используется или показывается "Data not available"

**Логика получения данных:**

Location Wellbeing анализирует окружающую среду care home через комплексный анализ neighbourhood данных. Система использует единый endpoint Neighbourhood Analysis, который объединяет данные из нескольких источников: ONS (Office for National Statistics), OSM (OpenStreetMap), NHSBSA, и Environmental Analyzer.

Green Space Score рассчитывается на основе данных OSM о парках и зеленых зонах в радиусе от care home. Система находит все парки в определенном радиусе (например, 800 метров для пешей доступности), анализирует их количество, размер, и расстояние до дома. Score нормализуется до 0-10 на основе density (количество парков на единицу площади) и accessibility (близость к дому). Это важно для качества жизни жильцов и их семей.

Noise Level определяется через Environmental Analyzer, который анализирует окружающую среду на основе различных факторов: близость к дорогам, аэропортам, промышленным зонам, плотность трафика. Система классифицирует уровень шума как Quiet (тихий), Moderate (умеренный), или Busy (шумный). Это важно, потому что высокий уровень шума может влиять на качество жизни, особенно для людей с деменцией.

Walkability Score получается из OSM данных через специальный алгоритм, который анализирует пешеходную инфраструктуру: наличие тротуаров, пешеходных переходов, доступность магазинов и услуг пешком, безопасность маршрутов. Score от 0 до 100, где 100 означает "Walker's Paradise" - все необходимое в пешей доступности. Это важно для семей, которые хотят легко посещать своих близких.

Nearest Park Distance - это просто расстояние до ближайшего парка из списка парков, найденных через OSM. Расстояние рассчитывается по прямой (as the crow flies) или по пешеходным маршрутам.

Local Amenities извлекаются из OSM данных по категориям: grocery stores, restaurants, shopping, healthcare facilities. Система находит все amenities в определенном радиусе и предоставляет их список с расстояниями. Это помогает понять, насколько удобно расположен дом для повседневных нужд.

Air Quality и Crime Rate в настоящее время не доступны, так как требуют интеграции с внешними API (UK Air Quality API, Police UK API). Эти данные были бы полезны для полной картины wellbeing района.

**Проверка корректности:**
- ✅ Green space, noise level, walkability доступны через Neighbourhood Explorer
- ✅ Local amenities доступны через OSM data
- ❌ Air quality и crime rate отсутствуют - требуются внешние API

---

### СЕКЦИЯ 19: Area Map (Страница 19)

**Требуемые данные по ТЗ:**
- Care Home Coordinates (lat, lng)
- Nearest Hospital (name, coordinates, distance)
- Nearby GPs (array with coordinates, distance)
- Nearby Pharmacies (array with coordinates, distance)
- Nearby Parks (array with coordinates, distance)
- Nearby Shops (array with coordinates, distance)
- Nearest Bus Stop (name, distance)
- Nearest Train Station (name, distance)
- User to Home Distance

**Источники данных в проекте:**

1. **Care Home Coordinates:**
   - Источник: База данных `care_homes.latitude`, `care_homes.longitude`
   - Метод получения: `raw_home.get('latitude')`, `raw_home.get('longitude')`

2. **Nearest Hospital:**
   - Источник: `Neighbourhood Explorer` через `GET /api/neighbourhood/analyze/{postcode}`
   - Метод получения: `osm.amenities.by_category.healthcare[]` - фильтр по `type=hospital`, берется ближайший
   - Данные: `name`, `coordinates` (lat, lng), `distance_m`

3. **Nearby GPs:**
   - Источник: `Neighbourhood Explorer` через `GET /api/neighbourhood/analyze/{postcode}` или `POST /api/nhsbsa/nearest-practices`
   - Метод получения:
     - NHSBSA: `nhsbsa.nearest_practices[]` - массив GP practices с координатами и расстоянием
     - Endpoint: `POST /api/nhsbsa/nearest-practices` с `{latitude, longitude, max_distance_km}`
   - Файл: `api-testing-suite/backend/data_integrations/nhsbsa_loader.py`

4. **Nearby Pharmacies:**
   - Источник: `Neighbourhood Explorer` через `GET /api/neighbourhood/analyze/{postcode}`
   - Метод получения: `osm.amenities.by_category.healthcare[]` - фильтр по `type=pharmacy`
   - Данные: Массив с `name`, `coordinates`, `distance_m`

5. **Nearby Parks:**
   - Источник: `Neighbourhood Explorer` через `GET /api/neighbourhood/analyze/{postcode}`
   - Метод получения: `osm.amenities.by_category.parks[]`
   - Данные: Массив с `name`, `coordinates`, `distance_m`

6. **Nearby Shops:**
   - Источник: `Neighbourhood Explorer` через `GET /api/neighbourhood/analyze/{postcode}`
   - Метод получения: `osm.amenities.by_category.shopping[]`
   - Данные: Массив с `name`, `coordinates`, `distance_m`

7. **Nearest Bus Stop:**
   - Источник: `Neighbourhood Explorer` через `GET /api/neighbourhood/analyze/{postcode}`
   - Метод получения: `osm.infrastructure.public_transport.bus_stops_800m[]` - берется ближайший
   - Данные: `name`, `distance_m`

8. **Nearest Train Station:**
   - Источник: `Neighbourhood Explorer` через `GET /api/neighbourhood/analyze/{postcode}`
   - Метод получения: `osm.infrastructure.public_transport.rail_stations_1600m[]` - берется ближайший
   - Данные: `name`, `distance_m`

9. **User to Home Distance:**
   - Источник: Расчет на основе координат
   - Метод расчета:
     - User coordinates: из `AsyncDataLoader.resolve_postcode()` или из questionnaire
     - Home coordinates: из БД
     - Distance: `calculate_distance_km(user_lat, user_lon, home_lat, home_lon)`
     - Driving time: оценка на основе distance и средних скоростей

**Логика получения данных:**

Area Map показывает все точки интереса (POI - Points of Interest) вокруг care home. Система использует координаты care home из базы данных и запрашивает Neighbourhood Analysis, который возвращает все nearby amenities через OSM и NHSBSA данные.

Nearest Hospital находится через OSM данные - система ищет все healthcare facilities типа "hospital" в определенном радиусе и выбирает ближайший. Это важно для экстренных ситуаций и регулярных медицинских визитов.

Nearby GPs получаются через NHSBSA API, который содержит официальную базу данных всех GP practices в Великобритании. Система запрашивает practices в радиусе от координат care home. NHSBSA данные более точны для GPs, чем OSM, так как это официальный реестр NHS. Система предоставляет название practice, координаты, и расстояние.

Nearby Pharmacies, Parks, Shops получаются через OSM данные. OSM содержит обширную базу данных о всех типах amenities с их координатами. Система фильтрует по категориям и предоставляет список с расстояниями. Расстояния рассчитываются по прямой или по пешеходным/автомобильным маршрутам.

Nearest Bus Stop и Train Station находятся через OSM infrastructure data. Система ищет public transport stops в определенных радиусах (800m для bus stops, 1600m для train stations, так как train stations обычно дальше) и выбирает ближайшие. Это важно для семей, которые полагаются на общественный транспорт для визитов.

User to Home Distance рассчитывается на основе координат пользователя (из postcode resolution) и координат care home. Система использует формулу Haversine для расчета расстояния по прямой между двумя точками на сфере (Земле). Driving time оценивается на основе расстояния и средних скоростей для разных типов дорог (городские, загородные, автомагистрали).

**Проверка корректности:**
- ✅ Все POI данные доступны через Neighbourhood Explorer
- ✅ GPs доступны через NHSBSA API
- ✅ Расстояния рассчитываются корректно
- ✅ User to home distance рассчитывается на основе координат

---

### СЕКЦИЯ 20: What Families Say (Страница 20)

**Требуемые данные по ТЗ:**
- Testimonial quotes (3 cards)
- Author name, location, context
- Time saved
- Platform total families helped
- Platform average time saved
- Platform average satisfaction rating

**Источники данных в проекте:**

1. **Testimonials:**
   - Источник: ❌ Таблица `testimonials` отсутствует
   - Метод получения: Требуется создание таблицы с полями: `id`, `quote`, `author_name`, `author_location`, `context`, `time_saved`, `rating`, `is_featured`, `author_photo_url`
   - Endpoint: `GET /api/testimonials?limit=3&is_featured=true`

2. **Platform Statistics:**
   - Источник: Расчет или статические значения
   - Метод получения:
     - Total families helped: подсчет из таблицы `questionnaires` (если существует)
     - Average time saved: статическое значение или расчет из testimonials
     - Average satisfaction: статическое значение или расчет из testimonials/feedback

**Логика получения данных:**

Testimonials должны быть реальными отзывами от семей, которые использовали сервис RightCareHome для поиска care home. Это критически важно для социального доказательства и доверия. Система должна иметь таблицу testimonials с полями: quote (текст отзыва), author_name (имя автора, может быть анонимным), author_location (город/регион), context (контекст - например, "нашел дом для матери с деменцией"), time_saved (сколько времени сэкономил сервис), rating (оценка 1-5), is_featured (рекомендуется ли для показа), и опционально author_photo_url.

Для Dashboard выбирается один случайный featured testimonial, чтобы показать социальное доказательство. Для секции 20 выбираются 3 testimonials для более полной картины.

Platform Statistics показывают общую эффективность сервиса. Total families helped - это количество уникальных пользователей, которые сгенерировали отчеты. Это можно подсчитать из таблицы questionnaires, если она существует. Average time saved и average satisfaction могут быть либо статическими значениями (если нет данных для расчета), либо рассчитываться из testimonials или feedback системы. Эти метрики важны для демонстрации ценности сервиса.

**Проверка корректности:**
- ❌ Testimonials отсутствуют - требуется создание таблицы
- ⚠️ Platform statistics могут быть статическими значениями

---

### СЕКЦИЯ 21: Your Journey Matters (Страница 21)

**Требуемые данные по ТЗ:**
- User full name
- Static empathy text

**Источники данных в проекте:**

1. **User full name:**
   - Источник: `questionnaire.section_1_contact_emergency.q1_names`
   - Метод получения: Извлекается из опросника

2. **Empathy text:**
   - Источник: Статические константы
   - Метод получения: Хардкодится в компоненте или конфигурационном файле

**Проверка корректности:**
- ✅ Все данные доступны
- ✅ Статический контент не требует проверки

---

### СЕКЦИЯ 22: Share with Family (Страница 22)

**Требуемые данные по ТЗ:**
- Report ID
- Email sending functionality
- Shared with emails list
- Share expiry date (30 days)
- PDF generation

**Источники данных в проекте:**

1. **Report ID:**
   - Источник: Генерация при создании отчета
   - Метод получения: UUID генерируется при создании отчета

2. **Email Sending:**
   - Источник: ❌ Email service отсутствует
   - Метод получения: Требуется создание email service (SMTP или email API, например SendGrid, Mailgun)

3. **Share Storage:**
   - Источник: ❌ Таблица `shared_reports` отсутствует
   - Метод получения: Требуется создание таблицы:
     - `id`, `report_id`, `recipient_email`, `share_token`, `shared_at`, `expires_at`, `accessed_at`, `access_count`

4. **PDF Generation:**
   - Источник: `api-testing-suite/backend/services/pdf_generator.py`
   - Метод получения: Используется существующий PDF generator для создания PDF версии отчета
   - Статус: ⚠️ Нужно проверить функциональность

5. **Share Access:**
   - Источник: Endpoint для доступа к shared report
   - Метод получения: `GET /api/shared-report/{share_token}` - требуется создание

**Логика получения данных:**

Share with Family - это функциональность, которая позволяет пользователю отправить отчет членам семьи по email. Это важно, потому что решения о care home обычно принимаются совместно несколькими членами семьи.

Report ID генерируется при создании отчета как уникальный идентификатор (UUID). Это позволяет отслеживать и ссылаться на конкретный отчет.

Email Sending требует интеграции с email service (SMTP сервер или email API, например SendGrid, Mailgun). Система должна иметь возможность отправлять персонализированные email с ссылкой на отчет. Email должен содержать персонализированное сообщение, объясняющее, что это за отчет и как его использовать.

Share Storage требует создания таблицы shared_reports, которая хранит информацию о том, кому был отправлен отчет. Каждая запись содержит: report_id (ссылка на отчет), recipient_email (email получателя), share_token (уникальный токен для доступа), shared_at (когда был отправлен), expires_at (когда истекает доступ, обычно 30 дней), accessed_at (когда был последний раз открыт), access_count (сколько раз был открыт). Share token используется для безопасного доступа к отчету без необходимости авторизации.

PDF Generation использует существующий PDF generator для создания PDF версии отчета, которую можно скачать или отправить по email. PDF должен содержать все секции отчета в формате, пригодном для печати.

Share Access endpoint позволяет получателю открыть отчет по share token. Система проверяет, не истек ли срок действия токена, и предоставляет read-only доступ к отчету. Это важно для безопасности - только люди с валидным токеном могут видеть отчет.

**Проверка корректности:**
- ❌ Email sending отсутствует - требуется создание service
- ❌ Share storage отсутствует - требуется создание таблицы
- ⚠️ PDF generator существует, но нужно проверить функциональность

---

### СЕКЦИЯ 23: Appendix - Data & Methodology (Страница 23)

**Требуемые данные по ТЗ:**
- Data Sources Table (name, description, update frequency, last update)
- Scoring Methodology explanations
- Verification Guide (links)
- Contact Information
- Disclaimer
- Report ID

**Источники данных в проекте:**

1. **Data Sources Metadata:**
   - Источник: Статические константы + `CacheManager.get_stats()`
   - Метод получения:
     - Статические данные: список всех источников (CQC, FSA, Companies House, Google Places, ONS, NHSBSA, OSM, Firecrawl, Perplexity) с описаниями
     - Last update dates: `GET /api/cache/stats` → `by_source.{source}.last_update`
     - Endpoint: `GET /api/cache/stats`
     - Файл: `api-testing-suite/backend/data_integrations/cache_manager.py`

2. **Scoring Methodology:**
   - Источник: Статические объяснения
   - Метод получения: Хардкодится описание методологии для каждой категории (high-level, не техническое)

3. **Verification Guide:**
   - Источник: Статические ссылки
   - Метод получения: Хардкодятся ссылки на официальные источники для верификации данных

4. **Contact Information:**
   - Источник: Статические константы
   - Метод получения: Хардкодятся support email, phone, hours

5. **Report ID:**
   - Источник: Метаданные отчета
   - Метод получения: `report_id` из сгенерированного отчета

**Логика получения данных:**

Appendix предоставляет полную прозрачность о том, откуда берутся данные и как рассчитываются оценки. Это критически важно для доверия и позволяет пользователям верифицировать информацию самостоятельно.

Data Sources Table содержит список всех источников данных, используемых в отчете: CQC (официальный регулятор), FSA (пищевая безопасность), Companies House (финансовые данные), Google Places (отзывы, рейтинги, insights), ONS (демографические и экономические данные), NHSBSA (данные о GP practices), OSM (инфраструктура и amenities), Firecrawl (сканирование сайтов), Perplexity AI (дополнительные исследования). Для каждого источника указывается: название, описание, типы данных, частота обновления, официальный URL.

Last Update Dates получаются через CacheManager, который отслеживает, когда последний раз обновлялись данные из каждого источника. Это важно для понимания актуальности данных. Система запрашивает cache statistics через специальный endpoint, который возвращает информацию о последних обновлениях для каждого источника.

Scoring Methodology объясняет высокоуровневую логику расчета оценок по категориям. Это не техническое описание алгоритма, а понятное объяснение для пользователя о том, какие факторы учитываются и как они взвешиваются. Например, для Safety score объясняется, что учитываются CQC safety rating, staffing data, и другие факторы безопасности.

Verification Guide предоставляет ссылки на официальные источники, где пользователь может самостоятельно проверить данные. Например, ссылка на CQC website для проверки рейтингов, ссылка на FSA website для проверки food hygiene ratings, ссылка на Companies House для проверки финансовых данных.

Contact Information и Disclaimer - это стандартная информация о сервисе, поддержке, и юридических аспектах использования отчета.

Report ID отображается для справки, чтобы пользователь мог ссылаться на конкретный отчет при обращении в поддержку или обсуждении с семьей.

**Проверка корректности:**
- ✅ Data sources metadata доступны (статический список + cache stats)
- ✅ Cache stats могут быть получены через endpoint
- ✅ Остальной контент статический

---

## Сводная Таблица: Источники Данных по Секциям

| Секция | Название | Основные Источники Данных | Статус Данных |
|--------|----------|---------------------------|---------------|
| 1 | Executive Summary | Assessment, Database, Matching Service | ✅ Готово |
| 2 | Table of Contents | Static content | ✅ Готово |
| 3 | Dashboard | Matching Service, Testimonials DB | ⚠️ Testimonials отсутствуют |
| 4 | Priorities Match | Assessment, Matching Service | ✅ Готово |
| 5 | At-a-Glance | Matching Service | ✅ Готово |
| 6 | Safety Analysis | CQC, Firecrawl (частично) | ⚠️ Детальные метрики отсутствуют |
| 7 | FSA Food Safety | FSA API, Firecrawl | ✅ Готово |
| 8 | Medical Care | CQC, Database, Firecrawl | ⚠️ Детальные метрики отсутствуют |
| 9 | Staff Quality | StaffEnrichmentService | ✅ Готово |
| 10 | Community Reputation | Google Places API, Firecrawl | ✅ Готово |
| 11 | Family Engagement | Google Places Insights API | ⚠️ Может использовать fallback |
| 12 | Financial Stability | Companies House Service | ✅ Готово |
| 13 | Fair Cost Calculator | NegotiationStrategyService, MSIF | ✅ Готово |
| 14 | Funding Options | MSIF, Neighbourhood Explorer, Assessment | ⚠️ Council contacts отсутствуют |
| 15 | Action Plan | Database, Google Places, Neighbourhood Explorer | ⚠️ Council phone отсутствует |
| 16 | Comfort & Lifestyle | Firecrawl Explorer, Google Places | ✅ Готово |
| 17 | Lifestyle Deep Dive | Firecrawl Explorer, Perplexity AI | ✅ Готово |
| 18 | Location Wellbeing | Neighbourhood Explorer (ONS, OSM, Environmental) | ⚠️ Air quality, crime rate отсутствуют |
| 19 | Area Map | Neighbourhood Explorer (OSM, NHSBSA) | ✅ Готово |
| 20 | What Families Say | Testimonials DB | ❌ Testimonials отсутствуют |
| 21 | Your Journey Matters | Assessment, Static content | ✅ Готово |
| 22 | Share with Family | Email service, Share DB | ❌ Система отсутствует |
| 23 | Appendix | CacheManager, Static content | ✅ Готово |

---

## Критические Пробелы и Рекомендации

### Критические Пробелы (Блокируют полноценную работу):

1. **Testimonials Database (Секции 3, 20)**
   - Проблема: Отсутствует таблица testimonials
   - Решение: Создать таблицу и endpoint для получения testimonials
   - Приоритет: Высокий

2. **Share with Family System (Секция 22)**
   - Проблема: Отсутствует система отправки отчетов
   - Решение: Создать таблицу shared_reports, email service, endpoint для shared access
   - Приоритет: Высокий

### Важные Пробелы (Ухудшают качество):

3. **Детальные Safety/Medical метрики (Секции 6, 8)**
   - Проблема: Incident rate, night staffing, GP frequency, readmission rate отсутствуют
   - Решение: Использовать Firecrawl для извлечения или добавить fallback сообщения
   - Приоритет: Средний

4. **Local Authority Contacts (Секции 14, 15)**
   - Проблема: Отсутствует база данных с контактами для 152 councils
   - Решение: Создать базу данных или использовать внешний API
   - Приоритет: Средний

5. **Google Places Insights Fallback (Секция 11)**
   - Проблема: Может использовать fallback вместо реальных данных
   - Решение: Убедиться, что используется реальный Google Places Insights API
   - Приоритет: Средний

### Опциональные Улучшения:

6. **Air Quality и Crime Rate (Секция 18)**
   - Проблема: Отсутствуют данные
   - Решение: Интегрировать внешние API (UK Air Quality API, Police UK API)
   - Приоритет: Низкий

---

## Заключение

Большинство секций отчета имеют доступные источники данных и корректные методы расчета. Основные проблемы:

1. **Отсутствующие системы:** Testimonials DB и Share with Family требуют создания
2. **Детальные метрики:** Некоторые специфические метрики (incident rate, night staffing) могут быть недоступны и требуют fallback стратегий
3. **Интеграция данных:** Некоторые данные доступны через вкладки проекта (Neighbourhood Explorer, Firecrawl Explorer), но могут не быть полностью интегрированы в отчет

Рекомендуется:
- Приоритизировать создание Testimonials DB и Share system
- Убедиться, что все доступные данные из вкладок проекта интегрированы в отчет
- Добавить fallback стратегии для missing data с информативными сообщениями

---

**Конец отчета**

