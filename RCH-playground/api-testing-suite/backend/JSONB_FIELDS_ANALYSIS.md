# üîç –ê–Ω–∞–ª–∏–∑ JSONB –ø–æ–ª–µ–π (Facilities –∏ Funding) –≤ CQC –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**–î–∞—Ç–∞:** 2025-12-20  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ê–ù–ê–õ–ò–ó –ó–ê–í–ï–†–®–ï–ù

---

## üìä –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** CQC CSV (`cqc_carehomes_master_full_data_rows.csv`)  
**–í—Å–µ–≥–æ –¥–æ–º–æ–≤:** 14,599  
**–í—Å–µ–≥–æ –∫–æ–ª–æ–Ω–æ–∫:** 128

---

## üîç –ê–Ω–∞–ª–∏–∑ Facilities (–£–¥–æ–±—Å—Ç–≤–∞)

### **–ü–æ–ª—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è –º–∞—Ç—á–∏–Ω–≥–∞:**

| –ü–æ–ª–µ | –°—Ç–∞—Ç—É—Å –≤ CSV | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ |
|------|--------------|--------------|
| `parking_onsite` | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω–æ –≤ JSONB `facilities` |
| `wheelchair_access` | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω–æ –≤ JSONB `facilities` |
| `ensuite_rooms` | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω–æ –≤ JSONB `facilities` |
| `secure_garden` | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω–æ –≤ JSONB `facilities` |
| `wifi_available` | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω–æ –≤ JSONB `facilities` |

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ CSV:**

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ùå –ü–æ–ª—è `facilities`, `amenities`, `features` **–ù–ï –ù–ê–ô–î–ï–ù–´** –≤ CSV

**–í—ã–≤–æ–¥:** JSONB —Å—Ç—Ä—É–∫—Ç—É—Ä—ã **–ù–ï –≠–ö–°–ü–û–†–¢–ò–†–û–í–ê–ù–´** –≤ CSV —Ñ–∞–π–ª. –û–Ω–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –Ω–æ –Ω–µ –≤–∫–ª—é—á–µ–Ω—ã –≤ —ç–∫—Å–ø–æ—Ä—Ç.

---

### **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –∫–æ–¥–µ:**

**–§—É–Ω–∫—Ü–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è:** `get_amenity_value(home, key)` –∏–∑ `db_field_extractor.py`

**–õ–æ–≥–∏–∫–∞:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–ª–æ—Å–∫–æ–µ –ø–æ–ª–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `parking_onsite`)
2. –ï—Å–ª–∏ `NULL`, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç JSONB `facilities` ‚Üí `key`
3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `True`/`False`/`None`

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```python
from services.db_field_extractor import get_amenity_value

parking = get_amenity_value(home, 'parking_onsite')
wheelchair = get_amenity_value(home, 'wheelchair_access')
secure_garden = get_amenity_value(home, 'secure_garden')
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ `simple_matching_service.py`

---

## üîç –ê–Ω–∞–ª–∏–∑ Funding (–§–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ)

### **–ü–æ–ª—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è –º–∞—Ç—á–∏–Ω–≥–∞:**

| –ü–æ–ª–µ | –°—Ç–∞—Ç—É—Å –≤ CSV | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ |
|------|--------------|--------------|
| `accepts_local_authority_funding` | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω–æ –≤ JSONB `funding` |
| `accepts_private_funding` | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω–æ –≤ JSONB `funding` |
| `accepts_nhs_funding` | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω–æ –≤ JSONB `funding` |
| `accepts_self_funding` | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω–æ –≤ JSONB `funding` |

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ CSV:**

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ùå –ü–æ–ª—è `funding`, `funding_acceptance` **–ù–ï –ù–ê–ô–î–ï–ù–´** –≤ CSV

**–í—ã–≤–æ–¥:** JSONB —Å—Ç—Ä—É–∫—Ç—É—Ä—ã **–ù–ï –≠–ö–°–ü–û–†–¢–ò–†–û–í–ê–ù–´** –≤ CSV —Ñ–∞–π–ª. –û–Ω–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –Ω–æ –Ω–µ –≤–∫–ª—é—á–µ–Ω—ã –≤ —ç–∫—Å–ø–æ—Ä—Ç.

---

### **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –∫–æ–¥–µ:**

**–§—É–Ω–∫—Ü–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è:** `get_funding_acceptance(home, funding_type)` –∏–∑ `db_field_extractor.py`

**–õ–æ–≥–∏–∫–∞:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–ª–æ—Å–∫–∏–µ –ø–æ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `accepts_local_authority_funding`)
2. –ï—Å–ª–∏ `NULL`, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç JSONB `funding_acceptance` ‚Üí `funding_type`
3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `True`/`False`/`None`

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```python
from services.db_field_extractor import get_funding_acceptance

la_funding = get_funding_acceptance(home, 'local_authority')
private_funding = get_funding_acceptance(home, 'private')
nhs_funding = get_funding_acceptance(home, 'nhs')
self_funding = get_funding_acceptance(home, 'self_funding')
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ `simple_matching_service.py`

---

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ JSONB –ø–æ–ª–µ–π (–∏–∑ –∫–æ–¥–∞)

### **Facilities JSONB:**

**–ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```json
{
  "facilities": {
    "parking": true,
    "wheelchair_access": true,
    "ensuite_rooms": false,
    "secure_garden": true,
    "wifi": true,
    "lift": true,
    "dining_room": true,
    "lounge": true,
    "library": false,
    "hairdressing": true
  }
}
```

**–ò–ª–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```json
{
  "amenities": [
    "parking",
    "wheelchair_access",
    "secure_garden",
    "wifi"
  ]
}
```

---

### **Funding JSONB:**

**–ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```json
{
  "funding_acceptance": {
    "local_authority": true,
    "private": true,
    "nhs": false,
    "self_funding": true
  }
}
```

**–ò–ª–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```json
{
  "funding": {
    "accepts_local_authority": true,
    "accepts_private": true,
    "accepts_nhs": false,
    "accepts_self_funding": true
  }
}
```

---

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞

### **JSONB —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ù–ï –≠–ö–°–ü–û–†–¢–ò–†–û–í–ê–ù–´ –≤ CSV**

**–ü—Ä–∏—á–∏–Ω–∞:**
- CSV —ç–∫—Å–ø–æ—Ä—Ç –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç JSONB –ø–æ–ª—è
- JSONB –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑ CSV —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è—é—Ç—Å—è

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –§—É–Ω–∫—Ü–∏–∏ `get_amenity_value()` –∏ `get_funding_acceptance()` –Ω–µ –º–æ–≥—É—Ç –∏–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –∏–∑ JSONB
- –û–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ —Å –ø–ª–æ—Å–∫–∏–º–∏ –ø–æ–ª—è–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ CSV

---

## ‚úÖ –†–µ—à–µ–Ω–∏—è

### **–†–µ—à–µ–Ω–∏–µ 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –Ω–∞–ø—Ä—è–º—É—é** ‚úÖ

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–ü–æ–¥—Ö–æ–¥:**
- –ó–∞–≥—Ä—É–∂–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–Ω–µ –∏–∑ CSV)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `AsyncDataLoader` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ –ë–î
- JSONB –ø–æ–ª—è –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ `db_field_extractor.py`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
from services.data_loader import AsyncDataLoader

loader = AsyncDataLoader()
homes = await loader.load_initial_data(...)  # –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑ –ë–î —Å JSONB
```

---

### **–†–µ—à–µ–Ω–∏–µ 2: –û–±–æ–≥–∞—Ç–∏—Ç—å CSV —á–µ—Ä–µ–∑ API** ‚ö†Ô∏è

**–ü–æ–¥—Ö–æ–¥:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–µ API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ facilities
- –ù–∞–ø—Ä–∏–º–µ—Ä, Google Places API –º–æ–∂–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ parking, wheelchair access
- –û–±–Ω–æ–≤–∏—Ç—å CSV —Å —ç—Ç–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

### **–†–µ—à–µ–Ω–∏–µ 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Staging –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö** ‚úÖ

**–ü–æ–¥—Ö–æ–¥:**
- Staging –±–∞–∑–∞ (`carehome_staging_export.csv`) –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å facilities –¥–∞–Ω–Ω—ã–µ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥: CQC + Staging
- –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `hybrid_data_merger.py`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –≥–∏–±—Ä–∏–¥–Ω–æ–º –ø–æ–¥—Ö–æ–¥–µ

---

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### **–í CSV:**

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –°—Ç–∞—Ç—É—Å |
|-----------|--------|
| **Facilities** | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç |
| **Funding** | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç |
| **JSONB —Å—Ç—Ä—É–∫—Ç—É—Ä—ã** | ‚ùå –ù–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã |

### **–í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ):**

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –°—Ç–∞—Ç—É—Å |
|-----------|--------|
| **Facilities JSONB** | ‚ö†Ô∏è –í–µ—Ä–æ—è—Ç–Ω–æ –µ—Å—Ç—å |
| **Funding JSONB** | ‚ö†Ô∏è –í–µ—Ä–æ—è—Ç–Ω–æ –µ—Å—Ç—å |
| **–î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ –ë–î** | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ |

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –Ω–∞–ø—Ä—è–º—É—é** ‚úÖ

**–î–µ–π—Å—Ç–≤–∏–µ:**
- –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `AsyncDataLoader` –≤–º–µ—Å—Ç–æ CSV
- –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏—Ç –¥–æ—Å—Ç—É–ø –∫ JSONB –ø–æ–ª—è–º

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ `report_routes.py` (fallback –Ω–∞ `AsyncDataLoader`)

---

### **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Staging –±–∞–∑—É** ‚ö†Ô∏è

**–î–µ–π—Å—Ç–≤–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ `carehome_staging_export.csv` facilities –∏ funding –¥–∞–Ω–Ω—ã–µ
- –ï—Å–ª–∏ –¥–∞, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

---

### **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –û–±–æ–≥–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑ API** ‚ö†Ô∏è

**–î–µ–π—Å—Ç–≤–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Google Places API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è facilities –¥–∞–Ω–Ω—ã—Ö
- –û–±–Ω–æ–≤–∏—Ç—å CSV —Å —ç—Ç–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

## ‚úÖ –í—ã–≤–æ–¥—ã

### **–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**

1. ‚ùå **JSONB —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ù–ï —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ CSV**
2. ‚úÖ **–§—É–Ω–∫—Ü–∏–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã** (`get_amenity_value`, `get_funding_acceptance`)
3. ‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ –ë–î —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞** (`AsyncDataLoader`)
4. ‚ö†Ô∏è **–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑ CSV JSONB –¥–∞–Ω–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã**

### **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**

‚úÖ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –Ω–∞–ø—Ä—è–º—É—é** –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ JSONB –ø–æ–ª—è–º, –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (CQC + Staging) –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è facilities –∏ funding –¥–∞–Ω–Ω—ã—Ö.

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-12-20

