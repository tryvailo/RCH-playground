# –ê–Ω–∞–ª–∏–∑ scoring-differentiation-fix.py –∏ –ø–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

**–î–∞—Ç–∞:** 2025-12-18  
**–ò—Å—Ç–æ—á–Ω–∏–∫:** `documents/report-algorithms/scoring-differentiation-fix.py`

---

## üìã –ü—Ä–æ–±–ª–µ–º–∞

**–í—Å–µ –¥–æ–º–∞ –ø–æ–ª—É—á–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Å–∫–æ—Ä—ã**

**–ü—Ä–∏—á–∏–Ω—ã:**
- NULL –¥–∞–Ω–Ω—ã–µ (–Ω–µ—Ç —Ä–∞–∑–ª–∏—á–∏–π –º–µ–∂–¥—É –¥–æ–º–∞–º–∏)
- –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ CQC —Ä–µ–π—Ç–∏–Ω–≥–∏ (overall = "Good" —É –≤—Å–µ—Ö)
- –ü–ª–æ—Å–∫–∏–µ —Ñ–æ—Ä–º—É–ª—ã (–±—Ä–µ–∫–µ—Ç—ã –≤–º–µ—Å—Ç–æ –ª–∏–Ω–µ–π–Ω–æ–π –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏)

---

## ‚úÖ –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –†–ï–®–ï–ù–ò–ï 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SUB-RATINGS –¥–ª—è –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `overall_rating`, –¥–∞–∂–µ –µ—Å–ª–∏ —É –≤—Å–µ—Ö "Good"

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –í–°–ï 5 CQC sub-ratings —Å –≤–µ—Å–∞–º–∏:
- Overall: 25%
- Safe: 25% (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
- Caring: 20% (–≤–∞–∂–Ω–æ –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–∞ –∂–∏–∑–Ω–∏)
- Effective: 15% (—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ª–µ—á–µ–Ω–∏—è)
- Well-Led: 15% (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Overall (40 points)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Caring (30 points)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Effective (30 points)
- ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Safe (—É–∂–µ –≤ Medical & Safety)
- ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Well-Led

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å Well-Led –≤ Quality & Care scoring

---

### –†–ï–®–ï–ù–ò–ï 2: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã –¥–ª—è –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏–∏

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–æ:**
1. **Inspection Freshness (15 –±–∞–ª–ª–æ–≤)**
   - < 6 –º–µ—Å—è—Ü–µ–≤: 15 points
   - < 1 –≥–æ–¥–∞: 12 points
   - < 2 –ª–µ—Ç: 8 points
   - –°—Ç–∞—Ä–∞—è: 4 points

2. **Size Factor (10 –±–∞–ª–ª–æ–≤)**
   - 30-60 –∫–æ–µ–∫: 10 points (–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä)
   - 20-30 –∏–ª–∏ 60-80: 8 points
   - 10-20 –∏–ª–∏ 80-100: 6 points
   - –î—Ä—É–≥–æ–µ: 4 points

3. **No Enforcement Actions (15 –±–∞–ª–ª–æ–≤)**
   - –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º: 15 points
   - 1 –ø—Ä–æ–±–ª–µ–º–∞: 8 points
   - –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ: 0 points

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è inspection_date
- ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è beds_total –¥–ª—è —Ä–∞–∑–º–µ—Ä–∞
- ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è enforcement_actions

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ —Ç—Ä–∏ —Ñ–∞–∫—Ç–æ—Ä–∞ –≤ Quality & Care scoring

---

### –†–ï–®–ï–ù–ò–ï 3: –ë–æ–ª–µ–µ –≥—Ä–∞–Ω—É–ª—è—Ä–Ω—ã–π LOCATION scoring

**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ –¥–æ–º–∞ –≤ 10-20–∫–º –ø–æ–ª—É—á–∞—é—Ç –ø–æ—á—Ç–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Å–∫–æ—Ä

**–†–µ—à–µ–Ω–∏–µ:** –õ–∏–Ω–µ–π–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è –≤–º–µ—Å—Ç–æ –±—Ä–µ–∫–µ—Ç–æ–≤

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
# –¢–µ–∫—É—â–∞—è (–±—Ä–µ–∫–µ—Ç—ã):
if distance_km <= 5:
    distance_score = 80
elif distance_km <= 10:
    distance_score = 70
elif distance_km <= 15:
    distance_score = 60
# ...
```

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–æ:**
```python
# –õ–∏–Ω–µ–π–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è:
if distance_km <= preferred_radius:
    proximity_ratio = 1 - (distance_km / preferred_radius)
    score += 50 + (proximity_ratio * 20)  # 50-70 –±–∞–ª–ª–æ–≤
else:
    overage = distance_km - preferred_radius
    penalty = min(overage * 2, 40)  # -2 –±–∞–ª–ª–∞ –∑–∞ –∫–º
    score += max(50 - penalty, 10)  # 10-50 –±–∞–ª–ª–æ–≤
```

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –±—Ä–µ–∫–µ—Ç—ã (–ø–ª–æ—Å–∫–∞—è –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏—è)
- ‚úÖ –ï—Å—Ç—å bonus –∑–∞ preferred radius (20 points)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ó–∞–º–µ–Ω–∏—Ç—å –±—Ä–µ–∫–µ—Ç—ã –Ω–∞ –ª–∏–Ω–µ–π–Ω—É—é –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—é

---

### –†–ï–®–ï–ù–ò–ï 4: PENALTY —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è NULL –¥–∞–Ω–Ω—ã—Ö

**–ò–¥–µ—è:** –î–æ–º–∞ —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—É—á–∞—é—Ç –±–æ–Ω—É—Å, —Å –ø—É—Å—Ç—ã–º–∏ - —à—Ç—Ä–∞—Ñ

**–§–∞–∫—Ç–æ—Ä –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö:**
- 100% –¥–∞–Ω–Ω—ã—Ö = 1.2 (–±–æ–Ω—É—Å 20%)
- 50% –¥–∞–Ω–Ω—ã—Ö = 1.0 (–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ)
- 0% –¥–∞–Ω–Ω—ã—Ö = 0.8 (—à—Ç—Ä–∞—Ñ 20%)

**–ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ –ø–æ–ª—è:**
- CQC: overall, safe, caring, effective, well_led, inspection_date
- Financial: altman_z_score, revenue_trend
- DB: fee, beds_total, wheelchair_access, secure_garden

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∞–∫—Ç–æ—Ä –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –∫–∞–∫ –º—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º—É —Å–∫–æ—Ä—É

---

### –†–ï–®–ï–ù–ò–ï 5: RANKING BONUS (–ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–π –±–æ–Ω—É—Å)

**–ò–¥–µ—è:** –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–æ–º–æ–≤ –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Å–∫–æ—Ä, –ø—Ä–∏–º–µ–Ω—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏

**–ü–æ—Ä—è–¥–æ–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞:**
1. CQC Safe rating (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ –≤—Å–µ–≥–æ)
2. Distance (–±–ª–∏–∂–µ = –ª—É—á—à–µ)
3. Inspection freshness (—Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ = –Ω–∞–¥—ë–∂–Ω–µ–µ)
4. Beds available (–Ω–∞–ª–∏—á–∏–µ –º–µ—Å—Ç)

**–ü–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–π –±–æ–Ω—É—Å:** 0.1 –±–∞–ª–ª–∞ –∑–∞ –ø–æ–∑–∏—Ü–∏—é (–¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è ties)

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- ‚ö†Ô∏è –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ç–æ–ª—å–∫–æ –ø–æ total score
- ‚ùå –ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –¥–ª—è ties

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –≤ `select_top_5_with_category_winners`

---

### –†–ï–®–ï–ù–ò–ï 6: –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è

**–ò–¥–µ—è:** –ê–Ω–∞–ª–∏–∑ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–∫–æ—Ä–æ–≤ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- Score range (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å > 5 points)
- Unique scores (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å > 50% —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö)
- Category ranges (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å > 10 points –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- ‚ùå –ù–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

| –†–µ—à–µ–Ω–∏–µ | –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è | –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–æ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|---------|-------------------|------------|-----------|
| **1. Sub-ratings** | ‚úÖ Overall, Caring, Effective | ‚úÖ + Well-Led | üü° –°—Ä–µ–¥–Ω–∏–π |
| **2. –î–æ–ø. —Ñ–∞–∫—Ç–æ—Ä—ã** | ‚ùå –ù–µ—Ç | ‚úÖ Inspection, Size, Enforcement | üî¥ –í—ã—Å–æ–∫–∏–π |
| **3. Location –≥—Ä–∞–Ω—É–ª—è—Ä–Ω–æ—Å—Ç—å** | ‚ö†Ô∏è –ë—Ä–µ–∫–µ—Ç—ã | ‚úÖ –õ–∏–Ω–µ–π–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è | üî¥ –í—ã—Å–æ–∫–∏–π |
| **4. NULL penalty** | ‚ùå –ù–µ—Ç | ‚úÖ –§–∞–∫—Ç–æ—Ä –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö | üü° –°—Ä–µ–¥–Ω–∏–π |
| **5. Ranking bonus** | ‚ö†Ô∏è –¢–æ–ª—å–∫–æ score | ‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ | üü¢ –ù–∏–∑–∫–∏–π |
| **6. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** | ‚ùå –ù–µ—Ç | ‚úÖ –§—É–Ω–∫—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ | üü¢ –ù–∏–∑–∫–∏–π |

---

## üéØ –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –≠—Ç–∞–ø 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (–≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

#### 1.1. –ì—Ä–∞–Ω—É–ª—è—Ä–Ω—ã–π Location Scoring
**–§–∞–π–ª:** `services/simple_matching_service.py` ‚Üí `_calculate_location()`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ó–∞–º–µ–Ω–∏—Ç—å –±—Ä–µ–∫–µ—Ç—ã –Ω–∞ –ª–∏–Ω–µ–π–Ω—É—é –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—é
- –£–ª—É—á—à–∏—Ç—å —Ä–∞—Å—á–µ—Ç proximity ratio
- –î–æ–±–∞–≤–∏—Ç—å —à—Ç—Ä–∞—Ñ –∑–∞ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ preferred radius

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** +10-20 points –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏–∏ –¥–ª—è Location

---

#### 1.2. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã –≤ Quality & Care
**–§–∞–π–ª:** `services/simple_matching_service.py` ‚Üí `_calculate_quality_care()`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å Inspection Freshness (15 points)
- –î–æ–±–∞–≤–∏—Ç—å Size Factor (10 points)
- –î–æ–±–∞–≤–∏—Ç—å Enforcement Actions penalty (15 points)
- –î–æ–±–∞–≤–∏—Ç—å Well-Led rating (–≤–º–µ—Å—Ç–æ —á–∞—Å—Ç–∏ Effective)

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** +20-30 points –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏–∏ –¥–ª—è Quality & Care

---

### –≠—Ç–∞–ø 2: –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

#### 2.1. –§–∞–∫—Ç–æ—Ä –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö
**–§–∞–π–ª:** `services/simple_matching_service.py` ‚Üí –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –°–æ–∑–¥–∞—Ç—å `_calculate_data_quality_factor()`
- –ü—Ä–∏–º–µ–Ω—è—Ç—å –∫–∞–∫ –º—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º—É —Å–∫–æ—Ä—É
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–ª–Ω–æ—Ç—É CQC, Financial, DB –¥–∞–Ω–Ω—ã—Ö

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** +5-10 points –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏–∏

---

#### 2.2. Well-Led –≤ Quality & Care
**–§–∞–π–ª:** `services/simple_matching_service.py` ‚Üí `_calculate_quality_care()`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å Well-Led rating (15 points)
- –ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–µ—Å–∞: Overall (25), Caring (20), Effective (15), Well-Led (15)

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** +5-10 points –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏–∏

---

### –≠—Ç–∞–ø 3: –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

#### 3.1. Ranking Bonus
**–§–∞–π–ª:** `services/simple_matching_service.py` ‚Üí `select_top_5_with_category_winners()`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –¥–ª—è ties
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–π –±–æ–Ω—É—Å (0.1 points –∑–∞ –ø–æ–∑–∏—Ü–∏—é)

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ ties

---

#### 3.2. –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è
**–§–∞–π–ª:** `services/simple_matching_service.py` ‚Üí –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –°–æ–∑–¥–∞—Ç—å `diagnose_scoring_distribution()`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** –ü–æ–º–æ—â—å –≤ –≤—ã—è–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º

---

## üìà –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ —É–ª—É—á—à–µ–Ω–∏–π:
- Score range: ~5-10 points
- –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–∫–æ—Ä–æ–≤: ~30-40%
- –î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏—è: –ù–∏–∑–∫–∞—è

### –ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏–π:
- Score range: ~20-30 points
- –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–∫–æ—Ä–æ–≤: ~70-80%
- –î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏—è: –í—ã—Å–æ–∫–∞—è

### –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
- **Location:** +10-20 points –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏–∏ (–ª–∏–Ω–µ–π–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è)
- **Quality & Care:** +20-30 points –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏–∏ (inspection, size, enforcement)
- **Data Quality:** +5-10 points –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏–∏ (NULL penalty)
- **–ò—Ç–æ–≥–æ:** +35-60 points –æ–±—â–µ–π –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏–∏

---

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ù–∞—á–∞—Ç—å —Å –≠—Ç–∞–ø–∞ 1** (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è)
   - –ì—Ä–∞–Ω—É–ª—è—Ä–Ω—ã–π Location Scoring
   - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã –≤ Quality & Care

2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å score range –¥–æ –∏ –ø–æ—Å–ª–µ
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–µ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤

3. **–î–æ–±–∞–≤–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–∫–æ—Ä–∏–Ω–≥–∞
   - –í—ã—è–≤–ª—è—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

4. **–ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ —É–ª—É—á—à–∞—Ç—å**
   - –ù–∞—á–∞—Ç—å —Å –≤—ã—Å–æ–∫–æ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
   - –î–æ–±–∞–≤–ª—è—Ç—å —Å—Ä–µ–¥–Ω–∏–π –∏ –Ω–∏–∑–∫–∏–π –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

---

## üîç –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### Location Scoring (–ª–∏–Ω–µ–π–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è)

```python
def _calculate_location_v2(self, home, user_profile):
    distance_km = home.get('distance_km', 999)
    preferred_radius = self._parse_preferred_radius(user_profile)
    
    score = 0.0
    
    # 1. DISTANCE SCORE (70 points) - –õ–ò–ù–ï–ô–ù–ê–Ø –ò–ù–¢–ï–†–ü–û–õ–Ø–¶–ò–Ø
    if distance_km <= preferred_radius:
        if preferred_radius > 0:
            proximity_ratio = 1 - (distance_km / preferred_radius)
            score += 50 + (proximity_ratio * 20)  # 50-70 –±–∞–ª–ª–æ–≤
        else:
            score += 70
    else:
        overage = distance_km - preferred_radius
        penalty = min(overage * 2, 40)  # -2 –±–∞–ª–ª–∞ –∑–∞ –∫–º, –º–∞–∫—Å -40
        score += max(50 - penalty, 10)  # 10-50 –±–∞–ª–ª–æ–≤
    
    # 2. PREFERRED RADIUS BONUS (20 points)
    if distance_km <= preferred_radius:
        score += 20
    
    # 3. ACCESSIBILITY BONUS (10 points)
    if home.get('parking_onsite'):
        score += 5
    if home.get('wheelchair_access'):
        score += 5
    
    return min(score, 100.0)
```

### Quality & Care (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã)

```python
def _calculate_quality_care_v2(self, home, enriched_data):
    score = 0.0
    cqc_data = enriched_data.get('cqc_detailed', {})
    
    # 1. CQC RATINGS (60 –±–∞–ª–ª–æ–≤) - —Å Well-Led
    # Overall: 25, Caring: 20, Effective: 15, Well-Led: 15
    
    # 2. INSPECTION FRESHNESS (15 –±–∞–ª–ª–æ–≤)
    inspection_date = cqc_data.get('inspection_date')
    if inspection_date:
        days_ago = (datetime.now() - parse_date(inspection_date)).days
        if days_ago <= 180:
            score += 15
        elif days_ago <= 365:
            score += 12
        elif days_ago <= 730:
            score += 8
        else:
            score += 4
    else:
        score += 7
    
    # 3. SIZE FACTOR (10 –±–∞–ª–ª–æ–≤)
    beds = home.get('beds_total')
    if beds:
        if 30 <= beds <= 60:
            score += 10
        elif 20 <= beds < 30 or 60 < beds <= 80:
            score += 8
        # ...
    
    # 4. NO ENFORCEMENT ACTIONS (15 –±–∞–ª–ª–æ–≤)
    enforcement = cqc_data.get('enforcement_actions', [])
    if not enforcement:
        score += 15
    elif len(enforcement) == 1:
        score += 8
    
    return min(score, 100.0)
```

---

**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π (–≠—Ç–∞–ø 1) ‚Üí –°—Ä–µ–¥–Ω–∏–π (–≠—Ç–∞–ø 2) ‚Üí –ù–∏–∑–∫–∏–π (–≠—Ç–∞–ø 3)

