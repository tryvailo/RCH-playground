# –ü–ª–∞–Ω –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –º–∞—Ç—á–∏–Ω–≥–∞ –¥–ª—è –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ (CQC + Staging)

**–î–∞—Ç–∞:** 2025-01-XX  
**–°—Ç–∞—Ç—É—Å:** üìã –ü–õ–ê–ù –ì–û–¢–û–í  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π

---

## üìä –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –¢–µ–∫—É—â–∏–µ –º–æ–¥—É–ª–∏:

1. **`services/csv_care_homes_service.py`**
   - –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ `merged_care_homes_west_midlands.csv`
   - –§—É–Ω–∫—Ü–∏—è: `get_care_homes()`

2. **`services/simple_matching_service.py`**
   - –ê–ª–≥–æ—Ä–∏—Ç–º –º–∞—Ç—á–∏–Ω–≥–∞ (100-point)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ `csv_care_homes_service`

3. **`services/db_field_extractor.py`**
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø–ª–æ—Å–∫–∏—Ö –∏ JSONB –ø–æ–ª–µ–π
   - –§—É–Ω–∫—Ü–∏–∏: `get_service_user_band()`, `get_cqc_rating()`, –∏ —Ç.–¥.

4. **`services/matching_fallback.py`**
   - Fallback –ª–æ–≥–∏–∫–∞ –¥–ª—è NULL –∑–Ω–∞—á–µ–Ω–∏–π
   - –§—É–Ω–∫—Ü–∏–∏: `check_field_with_fallback()`, `evaluate_home_match_v2()`

---

## üéØ –¶–µ–ª—å –∞–¥–∞–ø—Ç–∞—Ü–∏–∏

**–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥:**
- **–û—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞:** `cqc_carehomes_master_full_data_rows.csv` (CQC)
- **–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è –±–∞–∑–∞:** `carehome_staging_export.csv` (Staging)
- **–°–≤—è–∑—å:** `location_id` (CQC) ‚Üî `cqc_location_id` (Staging)

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- ‚úÖ –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–∫–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –º–æ–¥—É–ª–µ)
- ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç–µ–∫—É—â–∏—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–∞—Ö
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ fallback –ª–æ–≥–∏–∫–∏

---

## üìã –ü–ª–∞–Ω –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ (–ø–æ —ç—Ç–∞–ø–∞–º)

### **–≠–¢–ê–ü 1: –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö** ‚è±Ô∏è 2-3 —á–∞—Å–∞

#### 1.1. –°–æ–∑–¥–∞—Ç—å `services/cqc_data_loader.py`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ `cqc_carehomes_master_full_data_rows.csv`
- –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π CQC ‚Üí –ë–î —Ñ–æ—Ä–º–∞—Ç
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (boolean, float, dates)

**–§—É–Ω–∫—Ü–∏–∏:**
```python
def load_cqc_homes(csv_path: str) -> List[Dict[str, Any]]:
    """
    –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–º–∞ –∏–∑ CQC CSV.
    
    Returns:
        List[Dict]: –°–ø–∏—Å–æ–∫ –¥–æ–º–æ–≤ —Å –ø–æ–ª—è–º–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ë–î
    """
    pass

def map_cqc_to_db_format(cqc_row: Dict) -> Dict[str, Any]:
    """
    –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π CQC CSV ‚Üí —Ñ–æ—Ä–º–∞—Ç –ë–î.
    
    –ú–∞–ø–ø–∏–Ω–≥:
    - service_user_band_* ‚Üí serves_*
    - location_latest_overall_rating ‚Üí cqc_rating_overall
    - location_latitude ‚Üí latitude
    - –∏ —Ç.–¥.
    """
    pass

def normalize_cqc_boolean(value: str) -> Optional[bool]:
    """–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å 'TRUE'/'FALSE' ‚Üí True/False"""
    pass

def normalize_cqc_rating(value: str) -> Optional[str]:
    """–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å CQC —Ä–µ–π—Ç–∏–Ω–≥"""
    pass
```

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- `csv` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞)
- `typing` (List, Dict, Any, Optional)

---

#### 1.2. –°–æ–∑–¥–∞—Ç—å `services/staging_data_loader.py`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ `carehome_staging_export.csv`
- –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ –ø–æ `cqc_location_id`
- –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π Staging ‚Üí –ë–î —Ñ–æ—Ä–º–∞—Ç

**–§—É–Ω–∫—Ü–∏–∏:**
```python
def load_staging_data(csv_path: str) -> Dict[str, Dict[str, Any]]:
    """
    –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ Staging CSV –∏ —Å–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å –ø–æ location_id.
    
    Returns:
        Dict[str, Dict]: {location_id: {field: value, ...}, ...}
    """
    pass

def map_staging_to_db_format(staging_row: Dict) -> Dict[str, Any]:
    """
    –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π Staging CSV ‚Üí —Ñ–æ—Ä–º–∞—Ç –ë–î.
    
    –ú–∞–ø–ø–∏–Ω–≥:
    - parsed_fee_residential_from ‚Üí fee_residential_from
    - parsed_review_average_score ‚Üí review_average_score
    - parsed_wheelchair_access ‚Üí wheelchair_access
    - –∏ —Ç.–¥.
    """
    pass
```

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- `csv` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞)
- `typing` (Dict, Any)

---

#### 1.3. –°–æ–∑–¥–∞—Ç—å `services/hybrid_data_merger.py`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ CQC –∏ Staging
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞—Ö (CQC ‚Üí Staging)
- Fallback –ª–æ–≥–∏–∫–∞

**–§—É–Ω–∫—Ü–∏–∏:**
```python
def merge_cqc_and_staging(
    cqc_homes: List[Dict[str, Any]],
    staging_index: Dict[str, Dict[str, Any]]
) -> List[Dict[str, Any]]:
    """
    –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ CQC –∏ Staging.
    
    –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:
    1. CQC –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª–µ–π (Service User Bands, Ratings, Location)
    2. Staging –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π (Pricing, Reviews, Amenities)
    3. Fallback: –µ—Å–ª–∏ –Ω–µ—Ç –≤ CQC ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Staging
    
    Returns:
        List[Dict]: –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    """
    pass

def merge_single_home(
    cqc_home: Dict[str, Any],
    staging_data: Optional[Dict[str, Any]]
) -> Dict[str, Any]:
    """
    –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–¥–Ω–æ–≥–æ –¥–æ–º–∞.
    """
    pass
```

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- `services/cqc_data_loader` (–¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞)
- `services/staging_data_loader` (–¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞)
- `typing` (List, Dict, Any, Optional)

---

### **–≠–¢–ê–ü 2: –ê–¥–∞–ø—Ç–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥—É–ª–µ–π** ‚è±Ô∏è 1-2 —á–∞—Å–∞

#### 2.1. –û–±–Ω–æ–≤–∏—Ç—å `services/csv_care_homes_service.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å (fallback –Ω–∞ —Å—Ç–∞—Ä—ã–π CSV)

**–ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
```python
def get_care_homes_hybrid(
    user_lat: Optional[float] = None,
    user_lon: Optional[float] = None,
    max_distance_km: Optional[float] = None,
    limit: Optional[int] = None
) -> List[Dict[str, Any]]:
    """
    –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–º–∞ –∏—Å–ø–æ–ª—å–∑—É—è –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (CQC + Staging).
    
    Returns:
        List[Dict]: –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ CQC –∏ Staging
    """
    from .cqc_data_loader import load_cqc_homes
    from .staging_data_loader import load_staging_data
    from .hybrid_data_merger import merge_cqc_and_staging
    
    # 1. –ó–∞–≥—Ä—É–∑–∏—Ç—å CQC
    cqc_homes = load_cqc_homes(CQC_CSV_PATH)
    
    # 2. –ó–∞–≥—Ä—É–∑–∏—Ç—å Staging
    staging_index = load_staging_data(STAGING_CSV_PATH)
    
    # 3. –û–±—ä–µ–¥–∏–Ω–∏—Ç—å
    merged_homes = merge_cqc_and_staging(cqc_homes, staging_index)
    
    # 4. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
    if user_lat and user_lon:
        merged_homes = filter_by_distance(merged_homes, user_lat, user_lon, max_distance_km)
    
    # 5. –õ–∏–º–∏—Ç
    if limit:
        merged_homes = merged_homes[:limit]
    
    return merged_homes
```

**–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
```python
def get_care_homes(...) -> List[Dict[str, Any]]:
    """
    –°—Ç–∞—Ä–∞—è —Ñ—É–Ω–∫—Ü–∏—è (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏).
    –ü—Ä–æ–±—É–µ—Ç –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥, fallback –Ω–∞ —Å—Ç–∞—Ä—ã–π CSV.
    """
    try:
        return get_care_homes_hybrid(...)
    except Exception:
        # Fallback –Ω–∞ —Å—Ç–∞—Ä—ã–π CSV
        return get_care_homes_legacy(...)
```

---

#### 2.2. –û–±–Ω–æ–≤–∏—Ç—å `services/db_field_extractor.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –ø–æ–ª–µ–π –∏–∑ Staging
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
```python
def get_pricing_from_staging(home: Dict[str, Any]) -> Optional[float]:
    """–ü–æ–ª—É—á–∏—Ç—å —Ü–µ–Ω—É –∏–∑ Staging –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –µ—Å—Ç—å)"""
    pass

def get_review_from_staging(home: Dict[str, Any]) -> Optional[Dict[str, Any]]:
    """–ü–æ–ª—É—á–∏—Ç—å –æ—Ç–∑—ã–≤—ã –∏–∑ Staging –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –µ—Å—Ç—å)"""
    pass
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (`get_service_user_band()`, `get_cqc_rating()`, –∏ —Ç.–¥.) –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

---

### **–≠–¢–ê–ü 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –º–∞—Ç—á–∏–Ω–≥–∞** ‚è±Ô∏è 1 —á–∞—Å

#### 3.1. –û–±–Ω–æ–≤–∏—Ç—å `services/simple_matching_service.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–∞–ª–≥–æ—Ä–∏—Ç–º –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–µ–º –∂–µ)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ `get_care_homes_hybrid()`

**–ß—Ç–æ –ù–ï –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å:**
- ‚úÖ –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Å–∫–æ—Ä–æ–≤ (–æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–µ–∂–Ω–µ–π)
- ‚úÖ –§—É–Ω–∫—Ü–∏–∏ `_calculate_medical_safety()`, `_calculate_quality_care()`, –∏ —Ç.–¥.
- ‚úÖ Fallback –ª–æ–≥–∏–∫–∞ (—É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏)

**–ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª–∏ –ø–æ–ª—è –∏–∑ Staging (Pricing, Reviews, Amenities)?
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç fallback –¥–ª—è –ø–æ–ª–µ–π –∏–∑ Staging?

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```python
# –í _calculate_financial()
def _calculate_financial(self, home: Dict, user_profile: Dict, enriched_data: Dict) -> float:
    # ...
    
    # Budget Match (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç fee_residential_from –∏–∑ Staging)
    budget_score = self._calculate_budget_match(home, user_profile)
    # home['fee_residential_from'] —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑ Staging
    
    # ...
```

---

### **–≠–¢–ê–ü 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–æ—É—Ç–æ–≤** ‚è±Ô∏è 30 –º–∏–Ω—É—Ç

#### 4.1. –û–±–Ω–æ–≤–∏—Ç—å `routers/report_routes.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `get_care_homes_hybrid()` –≤–º–µ—Å—Ç–æ `get_care_homes()`
- –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

**–ü—Ä–∏–º–µ—Ä:**
```python
# –°—Ç–∞—Ä—ã–π –∫–æ–¥:
# care_homes = await asyncio.to_thread(
#     get_csv_care_homes,
#     user_lat, user_lon, initial_max_distance_km, initial_limit
# )

# –ù–æ–≤—ã–π –∫–æ–¥:
from services.csv_care_homes_service import get_care_homes_hybrid

care_homes = await asyncio.to_thread(
    get_care_homes_hybrid,
    user_lat, user_lon, initial_max_distance_km, initial_limit
)

logger.info(f"Loaded {len(care_homes)} homes using hybrid approach (CQC + Staging)")
```

---

### **–≠–¢–ê–ü 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚è±Ô∏è 2-3 —á–∞—Å–∞

#### 5.1. Unit —Ç–µ—Å—Ç—ã

**–°–æ–∑–¥–∞—Ç—å `tests/test_cqc_data_loader.py`:**
```python
def test_load_cqc_homes():
    """–¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ CQC –¥–∞–Ω–Ω—ã—Ö"""
    pass

def test_map_cqc_to_db_format():
    """–¢–µ—Å—Ç –º–∞–ø–ø–∏–Ω–≥–∞ CQC ‚Üí –ë–î"""
    pass

def test_normalize_cqc_boolean():
    """–¢–µ—Å—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ boolean"""
    pass
```

**–°–æ–∑–¥–∞—Ç—å `tests/test_staging_data_loader.py`:**
```python
def test_load_staging_data():
    """–¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ Staging –¥–∞–Ω–Ω—ã—Ö"""
    pass

def test_map_staging_to_db_format():
    """–¢–µ—Å—Ç –º–∞–ø–ø–∏–Ω–≥–∞ Staging ‚Üí –ë–î"""
    pass
```

**–°–æ–∑–¥–∞—Ç—å `tests/test_hybrid_data_merger.py`:**
```python
def test_merge_cqc_and_staging():
    """–¢–µ—Å—Ç –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö"""
    pass

def test_merge_priorities():
    """–¢–µ—Å—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ (CQC ‚Üí Staging)"""
    pass

def test_merge_fallback():
    """–¢–µ—Å—Ç fallback –ª–æ–≥–∏–∫–∏"""
    pass
```

---

#### 5.2. Integration —Ç–µ—Å—Ç—ã

**–°–æ–∑–¥–∞—Ç—å `tests/test_hybrid_matching_integration.py`:**
```python
def test_matching_with_hybrid_data():
    """–¢–µ—Å—Ç –º–∞—Ç—á–∏–Ω–≥–∞ —Å –≥–∏–±—Ä–∏–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏"""
    # 1. –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
    # 2. –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∞—Ç—á–∏–Ω–≥
    # 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    pass

def test_matching_fallback_to_legacy():
    """–¢–µ—Å—Ç fallback –Ω–∞ —Å—Ç–∞—Ä—ã–π CSV"""
    pass
```

---

#### 5.3. End-to-end —Ç–µ—Å—Ç—ã

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ —Å –≥–∏–±—Ä–∏–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ–ª–µ–π –∏–∑ CQC –∏ Staging
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∑–∞–º–µ–¥–ª–µ–Ω–∏—è)

---

### **–≠–¢–ê–ü 6: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** ‚è±Ô∏è 1 —á–∞—Å

#### 6.1. –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

**–§–∞–π–ª—ã:**
- `HYBRID_DATABASE_MATCHING_ANALYSIS.md` (—É–∂–µ —Å–æ–∑–¥–∞–Ω)
- `HYBRID_DATABASE_FIELD_MAPPING.md` (—É–∂–µ —Å–æ–∑–¥–∞–Ω)
- `README.md` (–¥–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª –ø—Ä–æ –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥)

**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:**
- –û–ø–∏—Å–∞–Ω–∏–µ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞
- –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- Troubleshooting

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π

```
backend/
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ cqc_data_loader.py          # –ù–û–í–´–ô: –ó–∞–≥—Ä—É–∑–∫–∞ CQC –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ staging_data_loader.py      # –ù–û–í–´–ô: –ó–∞–≥—Ä—É–∑–∫–∞ Staging –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ hybrid_data_merger.py       # –ù–û–í–´–ô: –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ csv_care_homes_service.py   # –û–ë–ù–û–í–õ–ï–ù: –î–æ–±–∞–≤–ª–µ–Ω –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ db_field_extractor.py       # –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô (—Ä–∞–±–æ—Ç–∞–µ—Ç —Å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏)
‚îÇ   ‚îú‚îÄ‚îÄ simple_matching_service.py  # –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô (—Ä–∞–±–æ—Ç–∞–µ—Ç —Å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏)
‚îÇ   ‚îî‚îÄ‚îÄ matching_fallback.py        # –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô (—Ä–∞–±–æ—Ç–∞–µ—Ç —Å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏)
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ test_cqc_data_loader.py     # –ù–û–í–´–ô
‚îÇ   ‚îú‚îÄ‚îÄ test_staging_data_loader.py # –ù–û–í–´–ô
‚îÇ   ‚îú‚îÄ‚îÄ test_hybrid_data_merger.py  # –ù–û–í–´–ô
‚îÇ   ‚îî‚îÄ‚îÄ test_hybrid_matching_integration.py  # –ù–û–í–´–ô
‚îî‚îÄ‚îÄ routers/
    ‚îî‚îÄ‚îÄ report_routes.py             # –û–ë–ù–û–í–õ–ï–ù: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥
```

---

## üîÑ –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –î–µ–Ω—å 1: –ú–æ–¥—É–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö

1. ‚úÖ –°–æ–∑–¥–∞—Ç—å `services/cqc_data_loader.py`
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å `services/staging_data_loader.py`
3. ‚úÖ –°–æ–∑–¥–∞—Ç—å `services/hybrid_data_merger.py`
4. ‚úÖ Unit —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π

### –î–µ–Ω—å 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

1. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å `services/csv_care_homes_service.py`
2. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å `routers/report_routes.py`
3. ‚úÖ Integration —Ç–µ—Å—Ç—ã

### –î–µ–Ω—å 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

1. ‚úÖ End-to-end —Ç–µ—Å—Ç—ã
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
3. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### 1. –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- ‚úÖ –°—Ç–∞—Ä—ã–π CSV (`merged_care_homes_west_midlands.csv`) –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ fallback
- ‚úÖ –ï—Å–ª–∏ –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ —Å—Ç–∞—Ä—ã–π CSV

### 2. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- ‚úÖ –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ Staging –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –¥–ª—è –Ω—É–∂–Ω—ã—Ö –¥–æ–º–æ–≤)
- ‚úÖ –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø–æ `location_id` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- ‚úÖ –ï—Å–ª–∏ CQC CSV –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí fallback –Ω–∞ —Å—Ç–∞—Ä—ã–π CSV
- ‚úÖ –ï—Å–ª–∏ Staging CSV –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ CQC
- ‚úÖ –ï—Å–ª–∏ `location_id` –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç ‚Üí –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å Staging –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç—Ç–æ–≥–æ –¥–æ–º–∞

### 4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö –¥–æ–º–æ–≤
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ/–æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–∏

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

1. ‚úÖ –í—Å–µ –º–æ–¥—É–ª–∏ —Å–æ–∑–¥–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
2. ‚úÖ –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
4. ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ —É—Ö—É–¥—à–∏–ª–∞—Å—å
5. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### –î–æ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏:
- –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ? —Å–µ–∫—É–Ω–¥
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª–µ–π –¥–ª—è –º–∞—Ç—á–∏–Ω–≥–∞: ? –ø–æ–ª–µ–π
- –ó–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª–µ–π: ?%

### –ü–æ—Å–ª–µ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏:
- –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: < ? —Å–µ–∫—É–Ω–¥ (–Ω–µ –¥–æ–ª–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å—Å—è > 20%)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª–µ–π –¥–ª—è –º–∞—Ç—á–∏–Ω–≥–∞: 43 –ø–æ–ª—è (31 –∏–∑ CQC + 12 –∏–∑ Staging)
- –ó–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª–µ–π: > 80% (–¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ø–æ–ª–µ–π)

---

**–°—Ç–∞—Ç—É—Å:** üìã –ü–õ–ê–ù –ì–û–¢–û–í –ö –í–´–ü–û–õ–ù–ï–ù–ò–Æ

