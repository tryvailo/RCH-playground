# –≠—Ç–∞–ø 6: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å Fallback –ª–æ–≥–∏–∫–æ–π - –ó–ê–í–ï–†–®–ï–ù–û ‚úÖ

**–î–∞—Ç–∞:** 2025-01-XX  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ COMPLETED

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å fallback –ª–æ–≥–∏–∫–æ–π –≤ `report_routes.py`

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–º–æ–≤ (STEP 3), –ø–µ—Ä–µ–¥ scoring (STEP 4)

**–ù–æ–≤—ã–π —à–∞–≥:** STEP 3.5: Pre-filtering with Fallback Logic

---

## üìä –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `evaluate_home_match_v2()`

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–æ–º–∞:**
- Care Types (—á–µ—Ä–µ–∑ `check_care_types_v2`)
- Medical Conditions (—á–µ—Ä–µ–∑ Service User Bands)
- Mobility Requirements (—á–µ—Ä–µ–∑ `MOBILITY_TO_FIELDS`)
- Behavioral Concerns (—á–µ—Ä–µ–∑ Service User Bands)

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- `disqualified` - –¥–æ–º —è–≤–Ω–æ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç (explicit FALSE –¥–ª—è critical requirements)
- `match` - –¥–æ–º –ø–æ–¥—Ö–æ–¥–∏—Ç (direct TRUE –∏–ª–∏ proxy match)
- `partial` - —á–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (proxy matches)
- `uncertain` - –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö (–º–Ω–æ–≥–æ NULL)

### 2. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è

**–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ:**
- –î–æ–º–∞ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `disqualified` (explicit FALSE)

**–û—Å—Ç–∞—é—Ç—Å—è –¥–ª—è scoring:**
- –î–æ–º–∞ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `match`, `partial`, `uncertain`

**–ü—Ä–∏—á–∏–Ω–∞:** NULL ‚â† FALSE. –î–æ–º–∞ —Å NULL –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –æ—Ü–µ–Ω–µ–Ω—ã –¥–∞–ª—å—à–µ —á–µ—Ä–µ–∑ scoring, –≥–¥–µ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è proxy matches –∏ confidence levels.

### 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∫–∞–∂–¥—ã–π –¥–æ–º:**
```python
home['_prefilter_match_result'] = {
    'status': 'match' | 'partial' | 'uncertain' | 'disqualified',
    'score': 0-100,
    'matched': [...],
    'partial': [...],
    'missing': [...],
    'unknown': [...],
    'warnings': [...],
    'data_completeness': 0-100
}
```

–≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –≤ scoring –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

---

## üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: Disqualified Home ‚úÖ
```python
home = {
    'care_dementia': False,  # Explicit FALSE
    'care_residential': False,
    'care_nursing': False
}
required_care = ['specialised_dementia']
# Status: disqualified
# Reason: "Home does not provide: ['specialised_dementia']"
```

### –¢–µ—Å—Ç 2: Match (Direct TRUE) ‚úÖ
```python
home = {
    'care_dementia': True,  # Direct match
    'serves_dementia_band': True
}
required_care = ['specialised_dementia']
conditions = ['dementia_alzheimers']
# Status: match
# Score: 100.0/100
```

### –¢–µ—Å—Ç 3: Partial Match (Proxy) ‚úÖ
```python
home = {
    'care_dementia': True,  # Proxy for serves_dementia_band
    'serves_dementia_band': None  # NULL
}
required_care = ['specialised_dementia']
conditions = ['dementia_alzheimers']
# Status: match (with partial matches)
# Partial matches: 1
```

---

## üîß –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–æ–º–æ–≤:**
- –ï—Å–ª–∏ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –æ—Å—Ç–∞–ª–æ—Å—å < 5 –¥–æ–º–æ–≤ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫
- –õ–æ–≥–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –Ω–æ –Ω–µ —Ç–µ—Ä—è–µ–º –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –¥–æ–º–∞

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**Try-except –±–ª–æ–∫:**
- –ï—Å–ª–∏ –∏–º–ø–æ—Ä—Ç `evaluate_home_match_v2` –Ω–µ —É–¥–∞–ª—Å—è ‚Üí –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é
- –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –≤–æ –≤—Ä–µ–º—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ ‚Üí –ø—Ä–æ–ø—É—Å–∫–∞–µ–º, –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å–µ –¥–æ–º–∞
- –õ–æ–≥–∏—Ä—É–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è, –Ω–æ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å

### 3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–æ–º–æ–≤
- –ü—Ä–∏—á–∏–Ω—ã –¥–∏—Å–∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–ø–µ—Ä–≤—ã–µ 5)
- –°—Ç–∞—Ç—É—Å –∫–∞–∂–¥–æ–≥–æ –¥–æ–º–∞ (match/partial/uncertain/disqualified)

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### 1. –†–∞–Ω–Ω–µ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –¥–æ–º–æ–≤

**–î–æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:**
- –í—Å–µ –¥–æ–º–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ scoring (–¥–∞–∂–µ —è–≤–Ω–æ –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏–µ)
- –¢—Ä–∞—Ç–∏—Ç—Å—è –≤—Ä–µ–º—è –Ω–∞ –æ—Ü–µ–Ω–∫—É –¥–æ–º–æ–≤ —Å explicit FALSE

**–ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:**
- –î–æ–º–∞ —Å explicit FALSE –∏—Å–∫–ª—é—á–∞—é—Ç—Å—è —Å—Ä–∞–∑—É
- Scoring —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–∏–º–∏ –¥–æ–º–∞–º–∏
- –≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∏ —Ä–µ—Å—É—Ä—Å–æ–≤

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Service User Bands

**–¢–µ–ø–µ—Ä—å —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è:**
- `serves_dementia_band` –¥–ª—è dementia
- `serves_mental_health` –¥–ª—è anxiety/depression
- `serves_physical_disabilities` –¥–ª—è mobility
- `serves_sensory_impairments` –¥–ª—è visual/hearing

**–í–º–µ—Å—Ç–æ —Ç–æ–ª—å–∫–æ:**
- `care_dementia`, `care_nursing`, `care_residential`

### 3. Fallback Logic

**–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç NULL –∑–Ω–∞—á–µ–Ω–∏—è:**
- NULL ‚â† FALSE (unknown, not confirmed negative)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç proxy fields –¥–ª—è inference
- –ù–µ –∏—Å–∫–ª—é—á–∞–µ—Ç –¥–æ–º–∞ —Å NULL, –µ—Å–ª–∏ –µ—Å—Ç—å proxy match

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã:
- ‚úÖ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `evaluate_home_match_v2()`
- ‚úÖ –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ `disqualified` –¥–æ–º–∞
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ `_prefilter_match_result`
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–æ–º–æ–≤
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–µ
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞

---

## üéØ –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

**–≠—Ç–∞–ø 7:** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ unit –∏ integration —Ç–µ—Å—Ç–æ–≤
- Unit —Ç–µ—Å—Ç—ã –¥–ª—è `check_field_with_fallback()`
- Unit —Ç–µ—Å—Ç—ã –¥–ª—è `evaluate_home_match_v2()`
- Integration —Ç–µ—Å—Ç—ã –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ pipeline (–∑–∞–≥—Ä—É–∑–∫–∞ ‚Üí —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è ‚Üí scoring)
- –¢–µ—Å—Ç—ã edge cases (NULL values, proxy matches, explicit FALSE)

---

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~1.5 —á–∞—Å–∞  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ COMPLETED

