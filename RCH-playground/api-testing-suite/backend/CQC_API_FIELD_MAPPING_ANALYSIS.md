# –ê–Ω–∞–ª–∏–∑ –º–∞–ø–ø–∏–Ω–≥–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª–µ–π CQC: CSV ‚Üí API

**–î–∞—Ç–∞:** 2025-01-XX  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ê–ù–ê–õ–ò–ó –ó–ê–í–ï–†–®–ï–ù

---

## üìä –†–µ–∑—é–º–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è –≤ CQC CSV –∏–º–µ—é—Ç –Ω–∏–∑–∫—É—é –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å (0-2%).  
**–¶–µ–ª—å:** –ù–∞–π—Ç–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è –≤ CQC API –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö –¥–∞–Ω–Ω—ã—Ö.

---

## ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –≤ CSV

### 1. Regulated Activities (0-2% –∑–∞–ø–æ–ª–Ω–µ–Ω–æ)

| –ü–æ–ª–µ –≤ CSV | –ó–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å | –ü—Ä–æ–±–ª–µ–º–∞ |
|------------|---------------|----------|
| `regulated_activity_nursing_care` | **0.0%** | –í—Å–µ–≥–¥–∞ –ø—É—Å—Ç–æ–µ |
| `regulated_activity_personal_care` | **2.0%** | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∞—è |
| `regulated_activity_surgical` | **0.0%** | –í—Å–µ–≥–¥–∞ –ø—É—Å—Ç–æ–µ |
| `regulated_activity_diagnostic` | **1.7%** | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∞—è |

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –º–∞—Ç—á–∏–Ω–≥:**
- ‚ö†Ô∏è `has_nursing_care_license` –º–∞–ø–ø–∏—Ç—Å—è –∏–∑ `service_type_care_home_nursing` (30% –∑–∞–ø–æ–ª–Ω–µ–Ω–æ)
- ‚ö†Ô∏è `has_personal_care_license` –º–∞–ø–ø–∏—Ç—Å—è –∏–∑ `service_type_care_home_without_nursing` (71% –∑–∞–ø–æ–ª–Ω–µ–Ω–æ)
- ‚ùå –ù–æ `regulated_activity_*` –ø–æ–ª—è –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è (–≤—Å–µ –ø—É—Å—Ç—ã–µ)

---

### 2. Service User Bands (0.1-2.1% –∑–∞–ø–æ–ª–Ω–µ–Ω–æ)

| –ü–æ–ª–µ –≤ CSV | –ó–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å | –ü—Ä–æ–±–ª–µ–º–∞ |
|------------|---------------|----------|
| `service_user_band_whole_population` | **0.1%** | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∞—è |
| `service_user_band_children` | **2.1%** | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∞—è |
| `service_user_band_detained_mental_health` | **0.8%** | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∞—è |
| `service_user_band_drugs_alcohol` | **1.9%** | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∞—è |
| `service_user_band_eating_disorder` | **1.4%** | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∞—è |

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –º–∞—Ç—á–∏–Ω–≥:**
- ‚ö†Ô∏è –≠—Ç–∏ –ø–æ–ª—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –º–∞—Ç—á–∏–Ω–≥–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö —É—Å–ª–æ–≤–∏–π
- ‚ö†Ô∏è –ù–∏–∑–∫–∞—è –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å ‚Üí fallback –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–∞—Å—Ç–æ
- ‚ö†Ô∏è –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ—Ç–æ—á–Ω–æ–º—É –º–∞—Ç—á–∏–Ω–≥—É

---

## üîç –ê–Ω–∞–ª–∏–∑ CQC API —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ CQC API (–Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–¥–∞)

CQC API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ (–Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ `cqc_client.py` –∏ `cqc_deep_dive_service.py`):

```json
{
  "locationId": "1-10000302982",
  "name": "Care Home Name",
  "currentRatings": {
    "overall": {
      "rating": "Good",
      "keyQuestionRatings": [
        {"name": "Safe", "rating": "Good"},
        {"name": "Effective", "rating": "Good"},
        {"name": "Caring", "rating": "Good"},
        {"name": "Responsive", "rating": "Good"},
        {"name": "Well-led", "rating": "Good"}
      ],
      "reportDate": "2024-01-15",
      "reportLinkId": "12345"
    }
  },
  "locationTypes": [
    {
      "id": 1,
      "name": "Care home service with nursing"
    }
  ],
  "regulatedActivities": [
    {
      "id": 1,
      "name": "Nursing care"
    },
    {
      "id": 2,
      "name": "Personal care"
    }
  ],
  "gacServiceTypes": [
    {
      "id": 1,
      "name": "Older people"
    },
    {
      "id": 2,
      "name": "Dementia"
    }
  ],
  "specialisms": [
    {
      "id": 1,
      "name": "Learning disabilities"
    }
  ]
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –¢–æ—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç API –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.

---

## üìã –ú–∞–ø–ø–∏–Ω–≥: CSV ‚Üí API

### 1. Regulated Activities

#### –ü—Ä–æ–±–ª–µ–º–∞: `regulated_activity_nursing_care` = 0.0%

**CSV –ø–æ–ª–µ:** `regulated_activity_nursing_care`  
**API –ø–æ–ª–µ:** `regulatedActivities[]` (–º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤)  
**API –ø—É—Ç—å:** `response.regulatedActivities` –∏–ª–∏ `response.get('regulatedActivities', [])`

**–ú–∞–ø–ø–∏–Ω–≥:**
```python
# CQC API
regulated_activities = api_response.get('regulatedActivities', [])
has_nursing_care = any(
    'nursing care' in activity.get('name', '').lower() or
    'nursing' in activity.get('name', '').lower()
    for activity in regulated_activities
)

# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ ID (–µ—Å–ª–∏ –∏–∑–≤–µ—Å—Ç–µ–Ω)
# Nursing care –º–æ–∂–µ—Ç –∏–º–µ—Ç—å ID –∏–ª–∏ code
has_nursing_care = any(
    activity.get('id') == 'nursing_care' or
    activity.get('code') == 'RA1' or  # –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞
    'nursing' in str(activity.get('id', '')).lower()
    for activity in regulated_activities
)
```

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `regulatedActivities[]` –∏–∑ API
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è—Ç—å `name` —Å–æ–¥–µ—Ä–∂–∏—Ç "nursing care" –∏–ª–∏ "nursing"
- ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å ETL –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞ –∏–∑ API
- ‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ù–û:** –í CSV —ç—Ç–æ –ø–æ–ª–µ –≤—Å–µ–≥–¥–∞ –ø—É—Å—Ç–æ–µ (0.0%), –Ω–æ –≤ API –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–æ

---

#### –ü—Ä–æ–±–ª–µ–º–∞: `regulated_activity_personal_care` = 2.0%

**CSV –ø–æ–ª–µ:** `regulated_activity_personal_care`  
**API –ø–æ–ª–µ:** `regulatedActivities[]` (–º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤)  
**API –ø—É—Ç—å:** `response.regulatedActivities`

**–ú–∞–ø–ø–∏–Ω–≥:**
```python
# CQC API
regulated_activities = api_response.get('regulatedActivities', [])
has_personal_care = any(
    'personal care' in activity.get('name', '').lower() or
    'personal' in activity.get('name', '').lower()
    for activity in regulated_activities
)
```

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `regulatedActivities[]` –∏–∑ API
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è—Ç—å `name` —Å–æ–¥–µ—Ä–∂–∏—Ç "personal care" –∏–ª–∏ "personal"
- ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å ETL –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞ –∏–∑ API
- ‚ö†Ô∏è –í CSV –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å —Ç–æ–ª—å–∫–æ 2.0%, –Ω–æ –≤ API –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–æ–ª—å—à–µ

---

### 2. Service User Bands

#### –ü—Ä–æ–±–ª–µ–º–∞: `service_user_band_whole_population` = 0.1%

**CSV –ø–æ–ª–µ:** `service_user_band_whole_population`  
**API –ø–æ–ª–µ:** `gacServiceTypes[]` (–º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤)  
**API –ø—É—Ç—å:** `response.gacServiceTypes` –∏–ª–∏ `response.get('gacServiceTypes', [])`

**–ú–∞–ø–ø–∏–Ω–≥:**
```python
# CQC API
gac_service_types = api_response.get('gacServiceTypes', [])
specialisms = api_response.get('specialisms', [])
all_service_types = gac_service_types + specialisms

# –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä—è–º–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
has_whole_population = any(
    'whole population' in st.get('name', '').lower() or
    'all ages' in st.get('name', '').lower()
    for st in all_service_types
)

# –í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∏–ø–æ–≤
has_older_people = any('older people' in st.get('name', '').lower() for st in all_service_types)
has_younger_adults = any('younger adults' in st.get('name', '').lower() for st in all_service_types)
has_children = any('children' in st.get('name', '').lower() or '0-18' in st.get('name', '') for st in all_service_types)
has_whole_population = has_older_people and (has_younger_adults or has_children)
```

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `gacServiceTypes[]` –∏ `specialisms[]` –∏–∑ API
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è "whole population"
- ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å ETL –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞ –∏–∑ API

---

#### –ü—Ä–æ–±–ª–µ–º–∞: `service_user_band_children` = 2.1%

**CSV –ø–æ–ª–µ:** `service_user_band_children`  
**API –ø–æ–ª–µ:** `gacServiceTypes[]` –∏–ª–∏ `specialisms[]`  
**API –ø—É—Ç—å:** `response.gacServiceTypes` –∏–ª–∏ `response.specialisms`

**–ú–∞–ø–ø–∏–Ω–≥:**
```python
# CQC API
gac_service_types = api_response.get('gacServiceTypes', [])
specialisms = api_response.get('specialisms', [])
all_service_types = gac_service_types + specialisms

has_children = any(
    'children' in st.get('name', '').lower() or
    '0-18' in st.get('name', '') or
    'young people' in st.get('name', '').lower() or
    'under 18' in st.get('name', '').lower()
    for st in all_service_types
)
```

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `gacServiceTypes[]` –∏ `specialisms[]` –∏–∑ API
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è—Ç—å `name` —Å–æ–¥–µ—Ä–∂–∏—Ç "children", "0-18", "young people"
- ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å ETL –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞ –∏–∑ API

---

#### –ü—Ä–æ–±–ª–µ–º–∞: `service_user_band_detained_mental_health` = 0.8%

**CSV –ø–æ–ª–µ:** `service_user_band_detained_mental_health`  
**API –ø–æ–ª–µ:** `gacServiceTypes[]` –∏–ª–∏ `specialisms[]`  
**API –ø—É—Ç—å:** `response.gacServiceTypes` –∏–ª–∏ `response.specialisms`

**–ú–∞–ø–ø–∏–Ω–≥:**
```python
# CQC API
gac_service_types = api_response.get('gacServiceTypes', [])
specialisms = api_response.get('specialisms', [])
all_service_types = gac_service_types + specialisms

has_detained_mha = any(
    'detained' in st.get('name', '').lower() or
    'mental health act' in st.get('name', '').lower() or
    'mha' in st.get('name', '').lower() or
    'detained under' in st.get('name', '').lower()
    for st in all_service_types
)
```

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `gacServiceTypes[]` –∏ `specialisms[]` –∏–∑ API
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è—Ç—å `name` —Å–æ–¥–µ—Ä–∂–∏—Ç "detained", "mental health act", "mha"
- ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å ETL –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞ –∏–∑ API

---

#### –ü—Ä–æ–±–ª–µ–º–∞: `service_user_band_drugs_alcohol` = 1.9%

**CSV –ø–æ–ª–µ:** `service_user_band_drugs_alcohol`  
**API –ø–æ–ª–µ:** `gacServiceTypes[]` –∏–ª–∏ `specialisms[]`  
**API –ø—É—Ç—å:** `response.gacServiceTypes` –∏–ª–∏ `response.specialisms`

**–ú–∞–ø–ø–∏–Ω–≥:**
```python
# CQC API
gac_service_types = api_response.get('gacServiceTypes', [])
specialisms = api_response.get('specialisms', [])
all_service_types = gac_service_types + specialisms

has_substance_misuse = any(
    'substance misuse' in st.get('name', '').lower() or
    'drugs and alcohol' in st.get('name', '').lower() or
    'alcohol' in st.get('name', '').lower() or
    'drugs' in st.get('name', '').lower() or
    'substance' in st.get('name', '').lower()
    for st in all_service_types
)
```

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `gacServiceTypes[]` –∏ `specialisms[]` –∏–∑ API
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è—Ç—å `name` —Å–æ–¥–µ—Ä–∂–∏—Ç "substance", "drugs", "alcohol"
- ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å ETL –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞ –∏–∑ API

---

#### –ü—Ä–æ–±–ª–µ–º–∞: `service_user_band_eating_disorder` = 1.4%

**CSV –ø–æ–ª–µ:** `service_user_band_eating_disorder`  
**API –ø–æ–ª–µ:** `gacServiceTypes[]` –∏–ª–∏ `specialisms[]`  
**API –ø—É—Ç—å:** `response.gacServiceTypes` –∏–ª–∏ `response.specialisms`

**–ú–∞–ø–ø–∏–Ω–≥:**
```python
# CQC API
gac_service_types = api_response.get('gacServiceTypes', [])
specialisms = api_response.get('specialisms', [])
all_service_types = gac_service_types + specialisms

has_eating_disorder = any(
    'eating disorder' in st.get('name', '').lower() or
    'eating disorders' in st.get('name', '').lower() or
    'anorexia' in st.get('name', '').lower() or
    'bulimia' in st.get('name', '').lower()
    for st in all_service_types
)
```

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `gacServiceTypes[]` –∏ `specialisms[]` –∏–∑ API
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è—Ç—å `name` —Å–æ–¥–µ—Ä–∂–∏—Ç "eating disorder", "anorexia", "bulimia"
- ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å ETL –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞ –∏–∑ API

---

### 3. Service Types

#### –ü—Ä–æ–±–ª–µ–º–∞: `service_type_care_home_nursing` = 30.0%

**CSV –ø–æ–ª–µ:** `service_type_care_home_nursing`  
**API –ø–æ–ª–µ:** `locationTypes[]` (–º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤)  
**API –ø—É—Ç—å:** `response.locationTypes` –∏–ª–∏ `response.get('locationTypes', [])`

**–ú–∞–ø–ø–∏–Ω–≥:**
```python
# CQC API
location_types = api_response.get('locationTypes', [])
has_nursing = any(
    'nursing' in lt.get('name', '').lower() or
    'care home service with nursing' in lt.get('name', '').lower()
    for lt in location_types
)
```

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `locationTypes[]` –∏–∑ API
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è—Ç—å `name` —Å–æ–¥–µ—Ä–∂–∏—Ç "nursing"
- ‚úÖ –≠—Ç–æ —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞ `has_nursing_care_license` (–Ω–æ —á–µ—Ä–µ–∑ `service_type_care_home_nursing`)
- ‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å –≤ CSV —Ç–æ–ª—å–∫–æ 30% - –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ API

---

## üîÑ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –º–∞–ø–ø–∏–Ω–≥ –¥–ª—è ETL

### –¢–∞–±–ª–∏—Ü–∞ –º–∞–ø–ø–∏–Ω–≥–∞: CQC API ‚Üí CSV –ø–æ–ª—è

| CSV –ø–æ–ª–µ | –ó–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å CSV | API –ø–æ–ª–µ | API –ø—É—Ç—å | –õ–æ–≥–∏–∫–∞ –º–∞–ø–ø–∏–Ω–≥–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|----------|-------------------|----------|----------|-----------------|-----------|
| `regulated_activity_nursing_care` | **0.0%** | `regulatedActivities[]` | `response.regulatedActivities` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `name` —Å–æ–¥–µ—Ä–∂–∏—Ç "nursing care" | **–í–´–°–û–ö–ò–ô** |
| `regulated_activity_personal_care` | **2.0%** | `regulatedActivities[]` | `response.regulatedActivities` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `name` —Å–æ–¥–µ—Ä–∂–∏—Ç "personal care" | **–í–´–°–û–ö–ò–ô** |
| `regulated_activity_surgical` | **0.0%** | `regulatedActivities[]` | `response.regulatedActivities` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `name` —Å–æ–¥–µ—Ä–∂–∏—Ç "surgical" | –°–†–ï–î–ù–ò–ô |
| `regulated_activity_diagnostic` | **1.7%** | `regulatedActivities[]` | `response.regulatedActivities` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `name` —Å–æ–¥–µ—Ä–∂–∏—Ç "diagnostic" | –°–†–ï–î–ù–ò–ô |
| `service_user_band_whole_population` | **0.1%** | `gacServiceTypes[]` + `specialisms[]` | `response.gacServiceTypes` / `response.specialisms` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∏–ø–æ–≤ | **–í–´–°–û–ö–ò–ô** |
| `service_user_band_children` | **2.1%** | `gacServiceTypes[]` –∏–ª–∏ `specialisms[]` | `response.gacServiceTypes` / `response.specialisms` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `name` —Å–æ–¥–µ—Ä–∂–∏—Ç "children" –∏–ª–∏ "0-18" | –°–†–ï–î–ù–ò–ô |
| `service_user_band_detained_mental_health` | **0.8%** | `gacServiceTypes[]` –∏–ª–∏ `specialisms[]` | `response.gacServiceTypes` / `response.specialisms` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `name` —Å–æ–¥–µ—Ä–∂–∏—Ç "detained" –∏–ª–∏ "mha" | –°–†–ï–î–ù–ò–ô |
| `service_user_band_drugs_alcohol` | **1.9%** | `gacServiceTypes[]` –∏–ª–∏ `specialisms[]` | `response.gacServiceTypes` / `response.specialisms` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `name` —Å–æ–¥–µ—Ä–∂–∏—Ç "substance" –∏–ª–∏ "drugs" | –°–†–ï–î–ù–ò–ô |
| `service_user_band_eating_disorder` | **1.4%** | `gacServiceTypes[]` –∏–ª–∏ `specialisms[]` | `response.gacServiceTypes` / `response.specialisms` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `name` —Å–æ–¥–µ—Ä–∂–∏—Ç "eating disorder" | –ù–ò–ó–ö–ò–ô |
| `service_type_care_home_nursing` | **30.0%** | `locationTypes[]` | `response.locationTypes` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `name` —Å–æ–¥–µ—Ä–∂–∏—Ç "nursing" | **–í–´–°–û–ö–ò–ô** |

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –û–±–Ω–æ–≤–∏—Ç—å ETL –ø—Ä–æ—Ü–µ—Å—Å

**–î–æ–±–∞–≤–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ –∏–∑ CQC API:**

```python
def map_cqc_api_to_csv_fields(api_response: dict) -> dict:
    """
    –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π –∏–∑ CQC API –≤ —Ñ–æ—Ä–º–∞—Ç CSV.
    
    Args:
        api_response: –û—Ç–≤–µ—Ç –æ—Ç CQC API (get_location)
        
    Returns:
        Dict —Å –º–∞–ø–ø–∏–Ω–≥–æ–º –ø–æ–ª–µ–π CSV
    """
    result = {}
    
    # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    # REGULATED ACTIVITIES
    # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    regulated_activities = api_response.get('regulatedActivities', [])
    if not regulated_activities:
        # –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø—É—Ç–∏
        regulated_activities = api_response.get('regulated_activities', [])
    
    result['regulated_activity_nursing_care'] = any(
        'nursing care' in str(activity.get('name', '')).lower() or
        'nursing' in str(activity.get('name', '')).lower()
        for activity in regulated_activities
    )
    result['regulated_activity_personal_care'] = any(
        'personal care' in str(activity.get('name', '')).lower() or
        'personal' in str(activity.get('name', '')).lower()
        for activity in regulated_activities
    )
    result['regulated_activity_surgical'] = any(
        'surgical' in str(activity.get('name', '')).lower()
        for activity in regulated_activities
    )
    result['regulated_activity_diagnostic'] = any(
        'diagnostic' in str(activity.get('name', '')).lower()
        for activity in regulated_activities
    )
    result['regulated_activity_treatment'] = any(
        'treatment' in str(activity.get('name', '')).lower()
        for activity in regulated_activities
    )
    
    # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    # SERVICE USER BANDS
    # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    gac_service_types = api_response.get('gacServiceTypes', [])
    if not gac_service_types:
        gac_service_types = api_response.get('gac_service_types', [])
    
    specialisms = api_response.get('specialisms', [])
    all_service_types = gac_service_types + specialisms
    
    # Whole population
    result['service_user_band_whole_population'] = _check_whole_population(all_service_types)
    
    # Children
    result['service_user_band_children'] = any(
        'children' in str(st.get('name', '')).lower() or
        '0-18' in str(st.get('name', '')) or
        'young people' in str(st.get('name', '')).lower() or
        'under 18' in str(st.get('name', '')).lower()
        for st in all_service_types
    )
    
    # Detained mental health
    result['service_user_band_detained_mental_health'] = any(
        'detained' in str(st.get('name', '')).lower() or
        'mental health act' in str(st.get('name', '')).lower() or
        'mha' in str(st.get('name', '')).lower()
        for st in all_service_types
    )
    
    # Drugs/alcohol
    result['service_user_band_drugs_alcohol'] = any(
        'substance misuse' in str(st.get('name', '')).lower() or
        'drugs and alcohol' in str(st.get('name', '')).lower() or
        'alcohol' in str(st.get('name', '')).lower() or
        'drugs' in str(st.get('name', '')).lower() or
        'substance' in str(st.get('name', '')).lower()
        for st in all_service_types
    )
    
    # Eating disorder
    result['service_user_band_eating_disorder'] = any(
        'eating disorder' in str(st.get('name', '')).lower() or
        'eating disorders' in str(st.get('name', '')).lower() or
        'anorexia' in str(st.get('name', '')).lower() or
        'bulimia' in str(st.get('name', '')).lower()
        for st in all_service_types
    )
    
    # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    # SERVICE TYPES
    # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    location_types = api_response.get('locationTypes', [])
    if not location_types:
        location_types = api_response.get('location_types', [])
    
    result['service_type_care_home_nursing'] = any(
        'nursing' in str(lt.get('name', '')).lower() or
        'care home service with nursing' in str(lt.get('name', '')).lower()
        for lt in location_types
    )
    result['service_type_care_home_without_nursing'] = any(
        'care home service without nursing' in str(lt.get('name', '')).lower() or
        ('care home' in str(lt.get('name', '')).lower() and 'nursing' not in str(lt.get('name', '')).lower())
        for lt in location_types
    )
    
    return result

def _check_whole_population(service_types: list) -> bool:
    """
    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç –ª–∏ –¥–æ–º –≤—Å–µ –Ω–∞—Å–µ–ª–µ–Ω–∏–µ.
    
    –õ–æ–≥–∏–∫–∞:
    1. –ü—Ä—è–º–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: "whole population" –∏–ª–∏ "all ages"
    2. –ö–æ—Å–≤–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∏–ø–æ–≤ (older people + younger adults/children)
    """
    if not service_types:
        return False
    
    names = [str(st.get('name', '')).lower() for st in service_types]
    
    # –ü—Ä—è–º–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
    has_whole = any('whole population' in name or 'all ages' in name for name in names)
    if has_whole:
        return True
    
    # –ö–æ—Å–≤–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∏–ø–æ–≤
    has_older = any('older people' in name for name in names)
    has_younger = any('younger adults' in name for name in names)
    has_children = any('children' in name or '0-18' in name for name in names)
    
    return has_older and (has_younger or has_children)
```

---

### 2. –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –æ–±–æ–≥–∞—â–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

**–í `services/cqc_enrichment_service.py`:**

```python
def enrich_with_cqc_api_data(home: dict, api_response: dict) -> dict:
    """
    –û–±–æ–≥–∞—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–æ–º–∞ –∏–∑ CQC API.
    """
    # –ú–∞–ø–ø–∏–Ω–≥ Regulated Activities
    regulated_activities = api_response.get('regulatedActivities', [])
    if regulated_activities:
        home['regulated_activity_nursing_care'] = any(
            'nursing care' in a.get('name', '').lower() 
            for a in regulated_activities
        )
        home['regulated_activity_personal_care'] = any(
            'personal care' in a.get('name', '').lower() 
            for a in regulated_activities
        )
        # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ
    
    # –ú–∞–ø–ø–∏–Ω–≥ Service User Bands
    gac_service_types = api_response.get('gacServiceTypes', [])
    specialisms = api_response.get('specialisms', [])
    # ... –º–∞–ø–ø–∏–Ω–≥
    
    return home
```

---

### 3. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
1. ‚úÖ `regulated_activity_nursing_care` (0.0% ‚Üí –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å > 30%)
2. ‚úÖ `regulated_activity_personal_care` (2.0% ‚Üí –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å > 50%)
3. ‚úÖ `service_user_band_whole_population` (0.1% ‚Üí –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å > 5%)

**–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
4. ‚ö†Ô∏è `service_user_band_children` (2.1% ‚Üí –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å > 5%)
5. ‚ö†Ô∏è `service_user_band_detained_mental_health` (0.8% ‚Üí –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å > 2%)
6. ‚ö†Ô∏è `service_user_band_drugs_alcohol` (1.9% ‚Üí –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å > 3%)

**–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
7. ‚ö†Ô∏è `service_user_band_eating_disorder` (1.4% ‚Üí –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å > 2%)
8. ‚ö†Ô∏è `regulated_activity_surgical` (0.0% ‚Üí –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å > 1%)
9. ‚ö†Ô∏è `regulated_activity_diagnostic` (1.7% ‚Üí –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å > 3%)

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–µ –≤—ã–≤–æ–¥—ã

### 1. –ü—Ä–æ–±–ª–µ–º–∞ –≤ ETL –ø—Ä–æ—Ü–µ—Å—Å–µ

**–ü—Ä–∏—á–∏–Ω–∞:** –î–∞–Ω–Ω—ã–µ –∏–∑ CQC API –Ω–µ –º–∞–ø–ø—è—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤ CSV –ø–æ–ª—è.

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å ETL —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –º–∞–ø–ø–∏–Ω–≥–∞ –∏–∑ API
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `regulatedActivities[]` –≤–º–µ—Å—Ç–æ –ø—É—Å—Ç—ã—Ö –ø–æ–ª–µ–π
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `gacServiceTypes[]` –∏ `specialisms[]` –¥–ª—è Service User Bands

### 2. –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –≤ API

**–í—ã–≤–æ–¥:** ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è **–ï–°–¢–¨** –≤ CQC API:
- `regulatedActivities[]` ‚Üí –¥–ª—è Regulated Activities
- `gacServiceTypes[]` ‚Üí –¥–ª—è Service User Bands
- `specialisms[]` ‚Üí –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö Service User Bands
- `locationTypes[]` ‚Üí –¥–ª—è Service Types

### 3. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å ETL –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ API
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –æ–±–æ–≥–∞—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ API –≤ runtime (–µ—Å–ª–∏ ETL –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω)
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –≤ API (–≤–æ–∑–º–æ–∂–Ω–æ, –¥–∞–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç)

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ê–ù–ê–õ–ò–ó –ó–ê–í–ï–†–®–ï–ù, –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ì–û–¢–û–í–´

