# –≠—Ç–∞–ø 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ - –ó–ê–í–ï–†–®–ï–ù ‚úÖ

**–î–∞—Ç–∞:** 2025-01-XX  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–í–ï–†–®–ï–ù

---

## üìã –¶–µ–ª—å —ç—Ç–∞–ø–∞

–°–æ–∑–¥–∞—Ç—å comprehensive test suite –¥–ª—è –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:
- Unit —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π
- Integration —Ç–µ—Å—Ç—ã –¥–ª—è –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞
- End-to-end —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª–Ω–æ–≥–æ flow

---

## ‚úÖ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

### 1. Unit —Ç–µ—Å—Ç—ã –¥–ª—è `cqc_data_loader.py` ‚úÖ

**–§–∞–π–ª:** `tests/test_cqc_data_loader.py`

**–¢–µ—Å—Ç—ã:**
- ‚úÖ `TestNormalizeCQCBoolean` - –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è boolean –∑–Ω–∞—á–µ–Ω–∏–π
- ‚úÖ `TestNormalizeCQCRating` - –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è CQC —Ä–µ–π—Ç–∏–Ω–≥–æ–≤
- ‚úÖ `TestMapCQCToDBFormat` - –º–∞–ø–ø–∏–Ω–≥ CQC CSV ‚Üí —Ñ–æ—Ä–º–∞—Ç –ë–î
- ‚úÖ `TestLoadCQCHomes` - –∑–∞–≥—Ä—É–∑–∫–∞ CQC –¥–∞–Ω–Ω—ã—Ö –∏–∑ CSV

**–ü–æ–∫—Ä—ã—Ç–∏–µ:**
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ boolean (TRUE, FALSE, 1, 0, –∏ —Ç.–¥.)
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è CQC —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ (Outstanding, Good, –∏ —Ç.–¥.)
- –ú–∞–ø–ø–∏–Ω–≥ –≤—Å–µ—Ö –ø–æ–ª–µ–π (ID, Location, Service User Bands, Ratings, Care Types)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª–µ–π
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

---

### 2. Unit —Ç–µ—Å—Ç—ã –¥–ª—è `staging_data_loader.py` ‚úÖ

**–§–∞–π–ª:** `tests/test_staging_data_loader.py`

**–¢–µ—Å—Ç—ã:**
- ‚úÖ `TestNormalizeBoolean` - –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è boolean –∑–Ω–∞—á–µ–Ω–∏–π
- ‚úÖ `TestSafeParseFloat` - –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ float
- ‚úÖ `TestSafeParseInt` - –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ int
- ‚úÖ `TestMapStagingToDBFormat` - –º–∞–ø–ø–∏–Ω–≥ Staging CSV ‚Üí —Ñ–æ—Ä–º–∞—Ç –ë–î
- ‚úÖ `TestLoadStagingData` - –∑–∞–≥—Ä—É–∑–∫–∞ Staging –¥–∞–Ω–Ω—ã—Ö –∏–∑ CSV

**–ü–æ–∫—Ä—ã—Ç–∏–µ:**
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è boolean –∑–Ω–∞—á–µ–Ω–∏–π
- –ü–∞—Ä—Å–∏–Ω–≥ —á–∏—Å–ª–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (float, int)
- –ú–∞–ø–ø–∏–Ω–≥ –≤—Å–µ—Ö –ø–æ–ª–µ–π (Pricing, Reviews, Amenities, Availability, Funding)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö `cqc_location_id`
- –ü—Ä–æ–ø—É—Å–∫ dormant –∑–∞–ø–∏—Å–µ–π
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

---

### 3. Unit —Ç–µ—Å—Ç—ã –¥–ª—è `hybrid_data_merger.py` ‚úÖ

**–§–∞–π–ª:** `tests/test_hybrid_data_merger.py`

**–¢–µ—Å—Ç—ã:**
- ‚úÖ `TestMergeSingleHome` - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ–¥–Ω–æ–≥–æ –¥–æ–º–∞
- ‚úÖ `TestMergeCQCAndStaging` - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Å–ø–∏—Å–∫–æ–≤ –¥–æ–º–æ–≤
- ‚úÖ `TestGetMergeStatistics` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è

**–ü–æ–∫—Ä—ã—Ç–∏–µ:**
- –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ CQC –∏ Staging –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –ø–æ–ª–µ–π (CQC ‚Üí Staging)
- Fallback –ª–æ–≥–∏–∫–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã `location_id`
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è –∏–∑ CQC –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è
- ‚úÖ –ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∏–∑ Staging –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
- ‚úÖ Fallback: Staging –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ—Å–ª–∏ CQC –ø—É—Å—Ç–æ
- ‚úÖ Connection key (`cqc_location_id`) –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è

---

### 4. Integration —Ç–µ—Å—Ç—ã –¥–ª—è –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ ‚úÖ

**–§–∞–π–ª:** `tests/test_hybrid_matching_integration.py`

**–¢–µ—Å—Ç—ã:**
- ‚úÖ `TestHybridMatchingIntegration` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≥–∏–±—Ä–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å –º–∞—Ç—á–∏–Ω–≥–æ–º
- ‚úÖ `TestHybridDataFlow` - end-to-end flow

**–ü–æ–∫—Ä—ã—Ç–∏–µ:**
- –ú–∞—Ç—á–∏–Ω–≥ —Å –≥–∏–±—Ä–∏–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (CQC + Staging)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–ª–µ–π –∏–∑ Staging –≤ –∞–ª–≥–æ—Ä–∏—Ç–º–µ –º–∞—Ç—á–∏–Ω–≥–∞
- Fallback –Ω–∞ legacy CSV –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- End-to-end flow –æ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ –º–∞—Ç—á–∏–Ω–≥–∞

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- ‚úÖ Pricing –∏–∑ Staging –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `_calculate_budget_match()`
- ‚úÖ Amenities –∏–∑ Staging –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ `_calculate_location()` –∏ `_calculate_lifestyle()`
- ‚úÖ Reviews –∏–∑ Staging –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ `_calculate_data_quality_factor()`
- ‚úÖ Fallback –Ω–∞ legacy CSV —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–æ–≤

**–°–æ–∑–¥–∞–Ω–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤:** 4
- `test_cqc_data_loader.py` - 4 test classes, ~15 test methods
- `test_staging_data_loader.py` - 4 test classes, ~15 test methods
- `test_hybrid_data_merger.py` - 3 test classes, ~12 test methods
- `test_hybrid_matching_integration.py` - 2 test classes, ~6 test methods

**–û–±—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:**
- ‚úÖ Unit —Ç–µ—Å—Ç—ã: ~48 test methods
- ‚úÖ Integration —Ç–µ—Å—Ç—ã: ~6 test methods
- ‚úÖ **–ò—Ç–æ–≥–æ: ~54 test methods**

---

## üîç –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

### **1. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:**
- ‚úÖ Boolean: TRUE/FALSE, 1/0, true/false
- ‚úÖ CQC Ratings: Outstanding, Good, Requires improvement, Inadequate
- ‚úÖ –ß–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: float, int —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫

### **2. –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π:**
- ‚úÖ CQC ‚Üí –ë–î: –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –º–∞–ø–ø—è—Ç—Å—è
- ‚úÖ Staging ‚Üí –ë–î: –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –º–∞–ø–ø—è—Ç—Å—è
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª–µ–π

### **3. –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:**
- ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã: CQC ‚Üí Staging
- ‚úÖ Fallback –ª–æ–≥–∏–∫–∞
- ‚úÖ Connection key (`cqc_location_id`)
- ‚úÖ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã `location_id`

### **4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–∞—Ç—á–∏–Ω–≥–æ–º:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Staging pricing –≤ budget match
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Staging amenities –≤ location/lifestyle
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Staging reviews –≤ data quality
- ‚úÖ Fallback –Ω–∞ legacy CSV

---

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

**–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤:**
```bash
cd backend
python3 -m pytest tests/test_cqc_data_loader.py -v
python3 -m pytest tests/test_staging_data_loader.py -v
python3 -m pytest tests/test_hybrid_data_merger.py -v
python3 -m pytest tests/test_hybrid_matching_integration.py -v
```

**–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:**
```bash
python3 -m pytest tests/test_hybrid_*.py -v
```

**–ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º:**
```bash
python3 -m pytest tests/test_hybrid_*.py --cov=services --cov-report=html
```

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### **–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç:**
- ‚úÖ Unit —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π
- ‚úÖ Integration —Ç–µ—Å—Ç—ã –¥–ª—è –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞
- ‚úÖ End-to-end —Ç–µ—Å—Ç—ã –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ flow

### **–ü–æ–∫—Ä—ã—Ç–∏–µ:**
- ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π
- ‚úÖ –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–∞—Ç—á–∏–Ω–≥–æ–º
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ Fallback –ª–æ–≥–∏–∫–∞

---

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –≤ CI/CD pipeline
2. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å performance —Ç–µ—Å—Ç—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö
4. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å stress —Ç–µ—Å—Ç—ã –¥–ª—è edge cases

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –≠–¢–ê–ü 5 –ó–ê–í–ï–†–®–ï–ù

**–í—ã–≤–æ–¥:** Comprehensive test suite —Å–æ–∑–¥–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –í—Å–µ –∫–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ –ø–æ–∫—Ä—ã—Ç—ã —Ç–µ—Å—Ç–∞–º–∏.

