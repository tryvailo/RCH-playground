# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è CQC –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–î–∞—Ç–∞:** 2025-12-20  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

---

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

**–ò—Å—Ö–æ–¥–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
1. –°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–≤–∞–ª –Ω–æ–≤—ã–π —Ñ–∞–π–ª `_UPDATED.csv` –≤–º–µ—Å—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ
2. –°–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–æ–º–∞, –∞ –Ω–µ –≤—Å–µ –¥–æ–º–∞ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
3. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –±–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ (–í–∞—Ä–∏–∞–Ω—Ç 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞)

### **–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `update_cqc_database()`:**

1. **–ó–∞–≥—Ä—É–∑–∫–∞ –í–°–ï–• –¥–æ–º–æ–≤:**
   - –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤—Å–µ –¥–æ–º–∞ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ CSV —Ñ–∞–π–ª–∞
   - –°–æ–∑–¥–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ `all_homes` —Å–æ –≤—Å–µ–º–∏ –¥–æ–º–∞–º–∏

2. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–æ–º–æ–≤ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
   - –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω `--limit`, –≤—ã–±–∏—Ä–∞—é—Ç—Å—è –¥–æ–º–∞ —Å –ø—É—Å—Ç—ã–º–∏ –ø–æ–ª—è–º–∏ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
   - –°–æ–∑–¥–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ `homes_to_update` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ API
   - –û—Å—Ç–∞–ª—å–Ω—ã–µ –¥–æ–º–∞ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ API:**
   - –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–æ–º–∞ –∏–∑ `homes_to_update`
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫ –æ–±—ä–µ–∫—Ç–∞–º –≤ `all_homes` (in-place)

4. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –í–°–ï–• –¥–æ–º–æ–≤:**
   - –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤—Å–µ –¥–æ–º–∞ –∏–∑ `all_homes` (–Ω–µ —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ)
   - –ï—Å–ª–∏ `output_path` –Ω–µ —É–∫–∞–∑–∞–Ω, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª
   - –°–æ–∑–¥–∞–µ—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º

---

## üìã –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### **1. –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–æ–º–æ–≤:**

```python
# Load ALL CQC homes from original CSV
all_homes = load_cqc_homes(str(csv_path))
logger.info(f"Loaded {len(all_homes)} total homes from CSV")
```

---

### **2. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–æ–º–æ–≤ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**

```python
# Determine which homes to update via API
homes_to_update = all_homes.copy()  # Start with all homes

if limit:
    # Prioritize homes with empty fields
    empty_homes = []
    filled_homes = []
    # ... separation logic ...
    homes_to_update = (empty_homes + filled_homes)[:limit]
```

---

### **3. –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏:**

```python
# Create backup before updating
if output_file == csv_path:
    from datetime import datetime
    import shutil
    
    timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
    backup_file = csv_dir / f"{csv_stem}_BACKUP_{timestamp}{csv_suffix}"
    
    shutil.copy2(csv_path, backup_file)
    logger.info(f"‚úÖ Backup created: {backup_file}")
```

---

### **4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞:**

```python
# Determine output path
if output_path:
    output_file = Path(output_path)
else:
    # Update original file in place
    output_file = csv_path

# Save ALL homes to CSV (not just updated ones)
save_homes_to_csv(all_homes, output_file, csv_path)
```

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

- ‚ùå –°–æ–∑–¥–∞–≤–∞–ª—Å—è –Ω–æ–≤—ã–π —Ñ–∞–π–ª `_UPDATED.csv`
- ‚ùå –°–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–æ–º–∞ (20 –¥–æ–º–æ–≤)
- ‚ùå –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª—Å—è
- ‚ùå –°–∏—Å—Ç–µ–º–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

---

### **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

- ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª `cqc_carehomes_master_full_data_rows.csv`
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤—Å–µ –¥–æ–º–∞ (14,599 –¥–æ–º–æ–≤)
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

---

## üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### **–û–±–Ω–æ–≤–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**

```bash
python3 scripts/update_cqc_database.py \
  --fields regulated_activity_nursing_care,regulated_activity_personal_care \
  --batch-size 20 \
  --delay 2.0
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°–æ–∑–¥–∞–µ—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è: `cqc_carehomes_master_full_data_rows_BACKUP_YYYYMMDD_HHMMSS.csv`
- –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª: `cqc_carehomes_master_full_data_rows.csv`
- –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤—Å–µ 14,599 –¥–æ–º–æ–≤

---

### **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–º –Ω–∞–±–æ—Ä–µ:**

```bash
python3 scripts/update_cqc_database.py \
  --fields regulated_activity_nursing_care,regulated_activity_personal_care \
  --limit 20 \
  --batch-size 5 \
  --delay 1.0
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ 20 –¥–æ–º–æ–≤ —á–µ—Ä–µ–∑ API
- –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤—Å–µ 14,599 –¥–æ–º–æ–≤ (20 –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö + –æ—Å—Ç–∞–ª—å–Ω—ã–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
- –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

---

### **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –¥—Ä—É–≥–æ–π —Ñ–∞–π–ª:**

```bash
python3 scripts/update_cqc_database.py \
  --fields regulated_activity_nursing_care,regulated_activity_personal_care \
  --output custom_output.csv
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª —á–µ—Ä–µ–∑ API
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π —Ñ–∞–π–ª `custom_output.csv`
- –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:**
   - –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª–µ–Ω
   - –ù–µ—Ç –ø—É—Ç–∞–Ω–∏—Ü—ã —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏

2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
   - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

3. **–ü–æ–ª–Ω–æ—Ç–∞ –¥–∞–Ω–Ω—ã—Ö:**
   - –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤—Å–µ –¥–æ–º–∞, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ
   - –ù–µ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö

4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
   - –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
   - –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–µ–Ω—è—Ç—å –∫–æ–¥ –∑–∞–≥—Ä—É–∑–∫–∏

---

## üìã –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç –≤—ã–≤–æ–¥–∏—Ç:

```
UPDATE STATISTICS
================================================================================
Total homes in CSV: 14599
Homes updated via API: 14599 (–∏–ª–∏ –º–µ–Ω—å—à–µ, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω --limit)
Processed: 14599
Updated: 14599
API success: 14599
API errors: 0

Fields updated:
  regulated_activity_nursing_care: 4377
  regulated_activity_personal_care: 10200

‚úÖ Update complete!
All 14599 homes saved to CSV
================================================================================
```

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-12-20

