# üöÄ README: –ü–∞—Ä—Å–∏–Ω–≥ –∏ –ú–∞–ø–ø–∏–Ω–≥ Autumna ‚Üí care_homes v2.4
## –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—é –¥–∞–Ω–Ω—ã—Ö –∏–∑ Autumna –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—é –≤ care_homes

**–î–∞—Ç–∞:** 3 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** v2.4 FINAL  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready  
**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** Autumna.co.uk (HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã)

---

## üéØ –ß–¢–û –≠–¢–û?

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML —Å—Ç—Ä–∞–Ω–∏—Ü Autumna —Å –ø–æ–º–æ—â—å—é OpenAI LLM –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö `care_homes` v2.4.

**–ò—Å—Ç–æ—á–Ω–∏–∫:** HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã Autumna (–Ω–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)  
**–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç:** JSON Schema v2.4 (188 –ø–æ–ª–µ–π)  
**–¶–µ–ª—å:** care_homes —Ç–∞–±–ª–∏—Ü–∞ (95 –ø–æ–ª–µ–π: 78 –ø–ª–æ—Å–∫–∏—Ö + 17 JSONB)

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ–¥—Ö–æ–¥:** Staging (–ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ) –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Å—Ä–µ–¥—Å—Ç–≤ –ø—Ä–∏ –∏—Ç–µ—Ä–∞—Ü–∏—è—Ö.

---

## üìã –°–û–î–ï–†–ñ–ê–ù–ò–ï

1. [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Ä–µ—à–µ–Ω–∏—è)
3. [–§–∞–∑–∞ 1: –ó–∞–≥—Ä—É–∑–∫–∞ HTML](#—Ñ–∞–∑–∞-1-–∑–∞–≥—Ä—É–∑–∫–∞-html)
4. [–§–∞–∑–∞ 2: –ü–∞—Ä—Å–∏–Ω–≥ —á–µ—Ä–µ–∑ LLM](#—Ñ–∞–∑–∞-2-–ø–∞—Ä—Å–∏–Ω–≥-—á–µ—Ä–µ–∑-llm)
5. [–§–∞–∑–∞ 3: –ú–∞–ø–ø–∏–Ω–≥ –≤ care_homes](#—Ñ–∞–∑–∞-3-–º–∞–ø–ø–∏–Ω–≥-–≤-care_homes)
6. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞)
7. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

---

## üöÄ –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
pip install psycopg2-binary python-dotenv openai requests
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env —Ñ–∞–π–ª

–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
# PostgreSQL
DB_HOST=localhost
DB_PORT=5432
DB_NAME=care_homes
DB_USER=postgres
DB_PASSWORD=your_password

# OpenAI
OPENAI_API_KEY=sk-...

# Firecrawl (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
FIRECRAWL_API_KEY=fc-...
```

### –®–∞–≥ 3: –°–æ–∑–¥–∞—Ç—å staging —Ç–∞–±–ª–∏—Ü—É

```bash
psql -U postgres -d care_homes -f input/autumna/staging/01_create_staging_table.sql
```

### –®–∞–≥ 4: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å SQL —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏

```bash
psql -U postgres -d care_homes -f input/autumna/staging/02_sql_helper_functions.sql
```

### –®–∞–≥ 5: –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å

```bash
# 1. –ó–∞–≥—Ä—É–∑–∏—Ç—å HTML (–æ–¥–∏–Ω —Ä–∞–∑)
python input/autumna/staging/phase1_load_html.py \
    --urls urls.txt \
    --api-key $FIRECRAWL_API_KEY

# 2. –ü–∞—Ä—Å–∏–Ω–≥ LLM (–º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä—è—Ç—å)
python input/autumna/staging/phase2_parse_llm.py \
    --prompt-version v2.4 \
    --batch-size 25

# 3. –ú–∞–ø–ø–∏–Ω–≥ –≤ care_homes
python input/autumna/staging/phase3_map_to_care_homes.py \
    --min-quality 60 \
    --batch-size 100
```

---

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –†–ï–®–ï–ù–ò–Ø

### Staging –ø–æ–¥—Ö–æ–¥ (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Firecrawl API  ‚îÇ ($15 –æ–¥–∏–Ω —Ä–∞–∑)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ HTML
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  autumna_staging    ‚îÇ (–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)
‚îÇ  - html_content     ‚îÇ ‚Üê –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑
‚îÇ  - parsed_json      ‚îÇ ‚Üê –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ
‚îÇ  - quality_score    ‚îÇ
‚îÇ  - llm_prompt_ver   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îú‚îÄ‚Üí phase2_parse_llm.py ($1.62 –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ)
         ‚îÇ   ‚Üì parsed_json (JSON Schema v2.4, 188 –ø–æ–ª–µ–π)
         ‚îÇ
         ‚îî‚îÄ‚Üí phase3_map_to_care_homes.py ($0)
              ‚Üì
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ  care_homes     ‚îÇ (–§–∏–Ω–∞–ª—å–Ω–∞—è –ë–î, 95 –ø–æ–ª–µ–π)
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ staging –ø–æ–¥—Ö–æ–¥–∞:

- üí∞ **–≠–∫–æ–Ω–æ–º–∏—è:** –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ —Å—Ç–æ–∏—Ç $1.62 –≤–º–µ—Å—Ç–æ $16.62
- üîÑ **–ì–∏–±–∫–æ—Å—Ç—å:** –ú–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–æ–º–ø—Ç–æ–≤ –Ω–∞ –æ–¥–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- üìä **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:** –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
- üõ°Ô∏è **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ—à–∏–±–æ–∫ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ HTML

---

## üì• –§–ê–ó–ê 1: –ó–ê–ì–†–£–ó–ö–ê HTML

**–¶–µ–ª—å:** –°–æ—Ö—Ä–∞–Ω–∏—Ç—å HTML –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü Autumna –≤ staging —Ç–∞–±–ª–∏—Ü—É –æ–¥–∏–Ω —Ä–∞–∑

**–°–∫—Ä–∏–ø—Ç:** `input/autumna/staging/phase1_load_html.py`

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```bash
# –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ URL (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–æ–∫—É)
echo "https://www.autumna.co.uk/care-homes/birmingham/home1/1-1234567890" > urls.txt
echo "https://www.autumna.co.uk/care-homes/birmingham/home2/1-2345678901" >> urls.txt

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Å Firecrawl API v2.5 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
python input/autumna/staging/phase1_load_html.py \
    --urls urls.txt \
    --api-key YOUR_FIRECRAWL_API_KEY \
    --api-version v2.5 \
    --use-cache

# –ò–ª–∏ –±–µ–∑ cache (–¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö)
python input/autumna/staging/phase1_load_html.py \
    --urls urls.txt \
    --api-key YOUR_FIRECRAWL_API_KEY \
    --api-version v2.5
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

- `--urls`: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å–æ —Å–ø–∏—Å–∫–æ–º URL (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `--api-key`: Firecrawl API –∫–ª—é—á (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `--api-version`: –í–µ—Ä—Å–∏—è API (`v1`, `v2`, `v2.5`). –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `v2.5`
- `--use-cache`: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å semantic index cache (v2.5+). –£—Å–∫–æ—Ä—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∏ —ç–∫–æ–Ω–æ–º–∏—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞
- `--dry-run`: –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

1. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç URLs –≤ Firecrawl API v2.5 (–±–∞—Ç—á–∞–º–∏ –ø–æ 50)
2. –ü–æ–ª—É—á–∞–µ—Ç HTML –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º –∫–∞—á–µ—Å—Ç–≤–æ–º (custom browser stack)
3. –ò–∑–≤–ª–µ–∫–∞–µ—Ç `cqc_location_id` –∏–∑ URL (–ø–∞—Ç—Ç–µ—Ä–Ω: `/1-XXXXXXXXXX`)
4. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `autumna_staging`:
   - `html_content` ‚Äî –ø–æ–ª–Ω—ã–π HTML —Ç–µ–∫—Å—Ç
   - `firecrawl_metadata` ‚Äî –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ—Ç Firecrawl (–≤–∫–ª—é—á–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ cache)
   - `scraped_at` ‚Äî –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏

### üî• Firecrawl API v2.5 –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

- üöÄ **Semantic Index**: –î–æ 40% –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–±—Å–ª—É–∂–∏–≤–∞—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∏–∑ cache
- üéØ **Custom Browser Stack**: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö
- ‚ö° **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞**: –ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ª—é–±—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
- üí∞ **–≠–∫–æ–Ω–æ–º–∏—è**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ cache —Å–Ω–∏–∂–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –í—Ä–µ–º—è –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å:

- **–í—Ä–µ–º—è —Å cache (v2.5):** 5-8 –º–∏–Ω—É—Ç –¥–ª—è 300 —Å—Ç—Ä–∞–Ω–∏—Ü (40% –∏–∑ cache)
- **–í—Ä–µ–º—è –±–µ–∑ cache (v2.5):** 10-15 –º–∏–Ω—É—Ç –¥–ª—è 300 —Å—Ç—Ä–∞–Ω–∏—Ü
- **–í—Ä–µ–º—è v1:** 15-20 –º–∏–Ω—É—Ç –¥–ª—è 300 —Å—Ç—Ä–∞–Ω–∏—Ü
- **–°—Ç–æ–∏–º–æ—Å—Ç—å:** $15 (–æ–¥–∏–Ω —Ä–∞–∑!)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:

```sql
SELECT 
    COUNT(*) as total,
    COUNT(*) FILTER (WHERE html_content IS NOT NULL) as with_html
FROM autumna_staging;
```

---

## ü§ñ –§–ê–ó–ê 2: –ü–ê–†–°–ò–ù–ì –ß–ï–†–ï–ó LLM

**–¶–µ–ª—å:** –ò–∑–≤–ª–µ—á—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ HTML —Å –ø–æ–º–æ—â—å—é ChatGPT

**–°–∫—Ä–∏–ø—Ç:** `input/autumna/staging/phase2_parse_llm.py`

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```bash
# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∑–∞–ø—É—Å–∫
python input/autumna/staging/phase2_parse_llm.py \
    --prompt-version v2.4 \
    --batch-size 25

# –ü–µ—Ä–µ–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞–ø–∏—Å–∏ —Å needs_reparse=TRUE
python input/autumna/staging/phase2_parse_llm.py \
    --prompt-version v2.5 \
    --reparse \
    --batch-size 25
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

- `--prompt-version`: –í–µ—Ä—Å–∏—è –ø—Ä–æ–º–ø—Ç–∞ (v2.4, v2.5, experimental_1, etc.)
- `--batch-size`: –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 25)
- `--reparse`: –ü–µ—Ä–µ–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞–ø–∏—Å–∏ —Å `needs_reparse=TRUE`
- `--dry-run`: –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

1. –í—ã–±–∏—Ä–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –±–µ–∑ `parsed_json` (–∏–ª–∏ —Å `needs_reparse=TRUE`)
2. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–æ–º–ø—Ç –∏ JSON Schema –∏–∑ —Ñ–∞–π–ª–æ–≤:
   - –ü—Ä–æ–º–ø—Ç: `input/autumna/AUTUMNA_PARSING_PROMPT_v2_4.md`
   - Schema: `input/autumna/response_format_v2_4.json`
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `html_content` –≤ OpenAI ChatGPT
4. –ü–æ–ª—É—á–∞–µ—Ç JSON Schema v2.4 (188 –ø–æ–ª–µ–π)
5. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `autumna_staging`:
   - `parsed_json` ‚Äî –ø–æ–ª–Ω—ã–π JSON —Ä–µ–∑—É–ª—å—Ç–∞—Ç
   - `extraction_confidence` ‚Äî 'high', 'medium', 'low'
   - `data_quality_score` ‚Äî –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ (0-100)
   - `llm_prompt_version` ‚Äî –≤–µ—Ä—Å–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞
   - `llm_model` ‚Äî –º–æ–¥–µ–ª—å OpenAI (gpt-4o-2024-08-06)

### –í—Ä–µ–º—è –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å:

- **–í—Ä–µ–º—è:** 20-30 –º–∏–Ω—É—Ç –¥–ª—è 300 —Å—Ç—Ä–∞–Ω–∏—Ü
- **–°—Ç–æ–∏–º–æ—Å—Ç—å:** $1.62 –∫–∞–∂–¥—ã–π —Ä–∞–∑ (–º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä—è—Ç—å –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ!)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:

```sql
SELECT 
    llm_prompt_version,
    COUNT(*) as total_parsed,
    AVG(data_quality_score)::INTEGER as avg_quality,
    COUNT(*) FILTER (WHERE extraction_confidence = 'high') as high_confidence
FROM autumna_staging
WHERE parsed_json IS NOT NULL
GROUP BY llm_prompt_version;
```

---

## üîÑ –§–ê–ó–ê 3: –ú–ê–ü–ü–ò–ù–ì –í CARE_HOMES

**–¶–µ–ª—å:** –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å `parsed_json` (188 –ø–æ–ª–µ–π) –≤ `care_homes` (95 –ø–æ–ª–µ–π)

**–°–∫—Ä–∏–ø—Ç:** `input/autumna/staging/phase3_map_to_care_homes.py`

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```bash
# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∑–∞–ø—É—Å–∫ (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π quality score = 60)
python input/autumna/staging/phase3_map_to_care_homes.py \
    --min-quality 60 \
    --batch-size 100

# –ë–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–π —Ñ–∏–ª—å—Ç—Ä (quality score >= 90)
python input/autumna/staging/phase3_map_to_care_homes.py \
    --min-quality 90 \
    --batch-size 100
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

- `--min-quality`: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π quality score (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 60)
- `--batch-size`: –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 100)
- `--dry-run`: –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

1. –í—ã–±–∏—Ä–∞–µ—Ç –∑–∞–ø–∏—Å–∏ —Å `parsed_json` –∏ `quality_score >= min_quality`
2. –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç JSON Schema v2.4 ‚Üí care_homes —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
   - 188 –ø–æ–ª–µ–π JSON ‚Üí 95 –ø–æ–ª–µ–π –ë–î
   - –ü–ª–æ—Å–∫–∏–µ –ø–æ–ª—è: 78
   - JSONB –ø–æ–ª—è: 17
3. –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ:
   - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è: `cqc_location_id`, `name`, `city`, `postcode`
   - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: –¥–∏–∞–ø–∞–∑–æ–Ω UK (lat: 49-61, lon: -8-2)
   - –õ–æ–≥–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏: `beds_available <= beds_total`
4. –í—Å—Ç–∞–≤–ª—è–µ—Ç –≤ `care_homes` —Å SQL —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏:
   - `safe_latitude()` / `safe_longitude()` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —Å –∑–∞–ø—è—Ç–æ–π
   - `clean_text()` ‚Äî –æ—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞
   - `normalize_cqc_rating()` ‚Äî –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–π—Ç–∏–Ω–≥–æ–≤
5. –û–±–Ω–æ–≤–ª—è–µ—Ç `autumna_staging`:
   - `processed = TRUE`
   - `care_homes_id` ‚Äî FK –Ω–∞ care_homes.id

### –í—Ä–µ–º—è –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å:

- **–í—Ä–µ–º—è:** 1-2 –º–∏–Ω—É—Ç—ã –¥–ª—è 300 –∑–∞–ø–∏—Å–µ–π
- **–°—Ç–æ–∏–º–æ—Å—Ç—å:** $0 (—Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:

```sql
SELECT 
    COUNT(*) as total_processed,
    COUNT(*) FILTER (WHERE processed = TRUE) as synced_to_care_homes
FROM autumna_staging
WHERE parsed_json IS NOT NULL;
```

---

## üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –ê–ù–ê–õ–ò–¢–ò–ö–ê

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏

```sql
SELECT * FROM v_staging_stats;
```

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –°–∫–æ–ª—å–∫–æ HTML –∑–∞–≥—Ä—É–∂–µ–Ω–æ
- –°–∫–æ–ª—å–∫–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–æ
- –°–∫–æ–ª—å–∫–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –≤ care_homes
- –°—Ä–µ–¥–Ω–∏–π quality score
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π —Å –≤—ã—Å–æ–∫–∏–º/–Ω–∏–∑–∫–∏–º –∫–∞—á–µ—Å—Ç–≤–æ–º

### –ö–∞—á–µ—Å—Ç–≤–æ –ø–æ –≤–µ—Ä—Å–∏—è–º –ø—Ä–æ–º–ø—Ç–∞

```sql
SELECT * FROM v_staging_prompt_stats;
```

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ä—Å–∏–π –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è.

### –ó–∞–ø–∏—Å–∏ –≥–æ—Ç–æ–≤—ã–µ –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞

```sql
SELECT * FROM v_staging_ready_for_mapping LIMIT 10;
```

### –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–∞–ø–∏—Å–∏

```sql
SELECT * FROM v_staging_problems LIMIT 20;
```

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–ø–∏—Å–∏ —Å –æ—à–∏–±–∫–∞–º–∏ –∏–ª–∏ –Ω–∏–∑–∫–∏–º –∫–∞—á–µ—Å—Ç–≤–æ–º.

---

## üí° –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (300 –¥–æ–º–æ–≤)

```bash
# 1. –ó–∞–≥—Ä—É–∑–∏—Ç—å HTML
python input/autumna/staging/phase1_load_html.py \
    --urls urls_birmingham_300.txt \
    --api-key $FIRECRAWL_API_KEY

# 2. –ü–∞—Ä—Å–∏–Ω–≥ LLM
python input/autumna/staging/phase2_parse_llm.py \
    --prompt-version v2.4 \
    --batch-size 25

# 3. –ú–∞–ø–ø–∏–Ω–≥ –≤ care_homes
python input/autumna/staging/phase3_map_to_care_homes.py \
    --min-quality 60 \
    --batch-size 100
```

**–°—Ç–æ–∏–º–æ—Å—Ç—å:** $16.62 ($15 Firecrawl + $1.62 OpenAI)

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –£–ª—É—á—à–∏–ª–∏ –ø—Ä–æ–º–ø—Ç - –ø–µ—Ä–µ–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏

```bash
# 1. –ü–æ–º–µ—Ç–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ –¥–ª—è –ø–µ—Ä–µ–æ–±—Ä–∞–±–æ—Ç–∫–∏
psql -d care_homes -c "
UPDATE autumna_staging
SET needs_reparse = TRUE
WHERE parsed_json IS NOT NULL;
"

# 2. –ü–µ—Ä–µ–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–æ–≤—ã–º –ø—Ä–æ–º–ø—Ç–æ–º
python input/autumna/staging/phase2_parse_llm.py \
    --prompt-version v2.5 \
    --reparse \
    --batch-size 25

# 3. –°—Ä–∞–≤–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
psql -d care_homes -c "
SELECT 
    llm_prompt_version,
    AVG(data_quality_score)::INTEGER as avg_quality,
    COUNT(*) as count
FROM autumna_staging
WHERE parsed_json IS NOT NULL
GROUP BY llm_prompt_version;
"
```

**–°—Ç–æ–∏–º–æ—Å—Ç—å:** $1.62 (—Ç–æ–ª—å–∫–æ OpenAI, HTML —É–∂–µ –µ—Å—Ç—å!)

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –¢–µ—Å—Ç–∏—Ä—É–µ–º 2 –≤–µ—Ä—Å–∏–∏ –ø—Ä–æ–º–ø—Ç–∞

```bash
# –í–µ—Ä—Å–∏—è A: v2.4
python input/autumna/staging/phase2_parse_llm.py \
    --prompt-version v2.4 \
    --batch-size 25

# –í–µ—Ä—Å–∏—è B: experimental_v1
python input/autumna/staging/phase2_parse_llm.py \
    --prompt-version experimental_v1 \
    --batch-size 25

# –°—Ä–∞–≤–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
psql -d care_homes -c "
SELECT * FROM v_staging_prompt_stats;
"
```

**–°—Ç–æ–∏–º–æ—Å—Ç—å:** $3.24 (–¥–≤–∞ —Ä–∞–∑–∞ –ø–æ $1.62)  
**–ü—Ä–∏ –ø—Ä—è–º–æ–º –ø—É—Ç–∏:** $31.62 (–Ω—É–∂–Ω–æ –±—ã–ª–æ –±—ã –∑–∞–Ω–æ–≤–æ –∫–∞—á–∞—Ç—å HTML!)

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –£–ø–∞–ª –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ 150-–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ

```bash
# –ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–Ω–æ–≤–∞ - –æ–Ω –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Å 151-–π
python input/autumna/staging/phase2_parse_llm.py \
    --prompt-version v2.4 \
    --batch-size 25
```

**–°—Ç–æ–∏–º–æ—Å—Ç—å:** $0 (–ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫)

---

## üîç –ú–ê–ü–ü–ò–ù–ì: JSON Schema v2.4 ‚Üí care_homes

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–∞–ø–ø–∏–Ω–≥–∞

```
Autumna HTML (–Ω–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
        ‚Üì
OpenAI LLM –ü–∞—Ä—Å–∏–Ω–≥
        ‚Üì
JSON Schema v2.4 (188 –ø–æ–ª–µ–π)
        ‚Üì
Python Mapper
        ‚Üì
care_homes (95 –ø–æ–ª–µ–π: 78 –ø–ª–æ—Å–∫–∏—Ö + 17 JSONB)
```

### –ö–ª—é—á–µ–≤—ã–µ –º–∞–ø–ø–∏–Ω–≥–∏

#### –ü–ª–æ—Å–∫–∏–µ –ø–æ–ª—è (78)

| –ü–æ–ª–µ care_homes | –ò—Å—Ç–æ—á–Ω–∏–∫ JSON Schema | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|----------------|---------------------|-------------|
| `cqc_location_id` | `identity.cqc_location_id` | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ |
| `name` | `identity.name` | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ |
| `city` | `location.city` | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ |
| `postcode` | `location.postcode` | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ |
| `latitude` | `location.latitude` | –ß–µ—Ä–µ–∑ `safe_latitude()` |
| `longitude` | `location.longitude` | –ß–µ—Ä–µ–∑ `safe_longitude()` |
| `has_nursing_care_license` | `licenses.has_nursing_care_license` | –ò–∑ `licenses`, –ù–ï –∏–∑ `care_services`! |
| `care_nursing` | `care_services.care_nursing` | –¢–∏–ø —É—Å–ª—É–≥–∏, –ù–ï –ª–∏—Ü–µ–Ω–∑–∏—è |
| `year_opened` | `capacity.year_opened` | –ú–æ–∂–µ—Ç –±—ã—Ç—å NULL |
| `year_registered` | `capacity.year_registered` | –ì–æ–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ CQC |

#### JSONB –ø–æ–ª—è (17)

| –ü–æ–ª–µ care_homes | –ò—Å—Ç–æ—á–Ω–∏–∫ JSON Schema | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|----------------|---------------------|-------------|
| `regulated_activities` | `regulated_activities` | –í—Å–µ 14 CQC regulated activities |
| `service_types` | `care_services.service_types_list` | –ú–∞—Å—Å–∏–≤ —Ç–∏–ø–æ–≤ —É—Å–ª—É–≥ |
| `medical_specialisms` | `medical_specialisms` | –ü–æ–ª–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ |
| `dietary_options` | `dietary_options` | –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ |
| `activities` | `activities` | –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å —Å–ø–∏—Å–∫–∞–º–∏ |
| `pricing_details` | `pricing` | –ü–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è |
| `building_info` | `building_and_facilities.building_details` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–¥–∞–Ω–∏–∏ |
| `accreditations` | `accreditations` | –ù–∞–≥—Ä–∞–¥—ã –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã |
| –ò –¥—Ä—É–≥–∏–µ... | | |

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–ª–∏—á–∏—è

#### 1. `has_nursing_care_license` vs `care_nursing`

**–†–∞–∑–ª–∏—á–∏–µ:**
- `has_nursing_care_license` = –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –ª–∏—Ü–µ–Ω–∑–∏—è CQC (–∏–∑ `licenses`)
- `care_nursing` = —Ç–∏–ø —É—Å–ª—É–≥–∏, –∫–æ—Ç–æ—Ä—É—é –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –¥–æ–º (–∏–∑ `care_services`)

**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "licenses": {
    "has_nursing_care_license": true  // –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –ª–∏—Ü–µ–Ω–∑–∏—è
  },
  "care_services": {
    "care_nursing": true  // –ü—Ä–µ–¥–ª–∞–≥–∞—é—Ç —Å–µ—Å—Ç—Ä–∏–Ω—Å–∫–∏–π —É—Ö–æ–¥
  }
}
```

#### 2. `year_opened` vs `year_registered`

**–†–∞–∑–ª–∏—á–∏–µ:**
- `year_opened` = —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –≥–æ–¥ –æ—Ç–∫—Ä—ã—Ç–∏—è –¥–æ–º–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å NULL)
- `year_registered` = –≥–æ–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ CQC

**–í–∞–∂–Ω–æ:** `year_opened` –ù–ï –º–∞–ø–ø–∏—Ç—Å—è –∏–∑ `year_registered`!

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ú–û–ú–ï–ù–¢–´

### 1. –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å –∑–∞–ø—è—Ç–æ–π (–µ–≤—Ä–æ–ø–µ–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)

**–ü—Ä–æ–±–ª–µ–º–∞:** HTML –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å –∑–∞–ø—è—Ç–æ–π (`52,533398` –≤–º–µ—Å—Ç–æ `52.533398`)

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SQL —Ñ—É–Ω–∫—Ü–∏–∏ `safe_latitude()` –∏ `safe_longitude()` –≤ phase3

**–ü—Ä–∏–º–µ—Ä:**
```sql
safe_latitude('52,533398', NULL)  -- ‚Üí 52.533398
safe_longitude('-1,88634', NULL)  -- ‚Üí -1.88634 (–ù–ï -0.188634!)
```

### 2. licenses vs care_services

**–ö—Ä–∏—Ç–∏—á–Ω–æ:** –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—É—Ç–∞—Ç—å `licenses` (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –ª–∏—Ü–µ–Ω–∑–∏–∏) –∏ `care_services` (—Ç–∏–ø—ã —É—Å–ª—É–≥)!

–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç —á–µ—Ç–∫–æ —Ä–∞–∑–¥–µ–ª—è–µ—Ç —ç—Ç–∏ –ø–æ–Ω—è—Ç–∏—è.

### 3. User Categories ‚Äî DERIVED –ø–æ–ª—è

–ü–æ–ª—è `serves_older_people`, `serves_dementia_band` –∏ –¥—Ä. **–ù–ï –∏—â—É—Ç—Å—è –≤ HTML –Ω–∞–ø—Ä—è–º—É—é**, –∞ **–¥–µ—Ä–∏–≤—è—Ç—Å—è** –∏–∑ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏, –æ–ø–∏—Å–∞–Ω–∏—è —É—Å–ª—É–≥ –∏ —Ç.–¥.)

---

## üìà –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ (300 –¥–æ–º–æ–≤):

- ‚úÖ HTML –∑–∞–≥—Ä—É–∂–µ–Ω: 300 –∑–∞–ø–∏—Å–µ–π
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω: 285-300 –∑–∞–ø–∏—Å–µ–π (95-100%)
- ‚úÖ –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ (score ‚â• 90): 255-270 –∑–∞–ø–∏—Å–µ–π (85-90%)
- ‚úÖ –°—Ä–µ–¥–Ω–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ (score 60-89): 25-30 –∑–∞–ø–∏—Å–µ–π (8-10%)
- ‚úÖ –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ (score < 60): 5-15 –∑–∞–ø–∏—Å–µ–π (2-5%)

### –ü–æ—Å–ª–µ –º–∞–ø–ø–∏–Ω–≥–∞ –≤ care_homes:

- ‚úÖ –£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: 270-285 –∑–∞–ø–∏—Å–µ–π (90-95%)
- ‚úÖ –¢—Ä–µ–±—É—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏: 15-30 –∑–∞–ø–∏—Å–µ–π (5-10%)
- ‚úÖ –û—à–∏–±–∫–∏: 0-5 –∑–∞–ø–∏—Å–µ–π (0-2%)

### –ü–æ–∫—Ä—ã—Ç–∏–µ –¥–∞–Ω–Ω—ã—Ö:

- ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è: 100% (`cqc_location_id`, `name`, `city`, `postcode`)
- ‚úÖ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ~75-80%
- ‚úÖ –¶–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ: ~60-70% (—Å–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ Autumna!)
- ‚úÖ –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ~80-90%
- ‚úÖ CQC —Ä–µ–π—Ç–∏–Ω–≥–∏: ~40-50% (–±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)

---

## üí∞ –≠–ö–û–ù–û–ú–ò–ö–ê

### –ü—Ä—è–º–æ–π –ø—É—Ç—å (–±–µ–∑ staging):

- 1-—è –∑–∞–≥—Ä—É–∑–∫–∞: $16.62
- 2-—è (—É–ª—É—á—à–∏–ª–∏ –ø—Ä–æ–º–ø—Ç): $31.62
- 3-—è: $46.62
- **5 –∏—Ç–µ—Ä–∞—Ü–∏–π: $76.62**

### Staging –ø—É—Ç—å:

- 1-—è –∑–∞–≥—Ä—É–∑–∫–∞: $16.62
- 2-—è (—É–ª—É—á—à–∏–ª–∏ –ø—Ä–æ–º–ø—Ç): $18.24 ($1.62 —Ç–æ–ª—å–∫–æ OpenAI!)
- 3-—è: $19.86
- **5 –∏—Ç–µ—Ä–∞—Ü–∏–π: $23.10**

**–≠–∫–æ–Ω–æ–º–∏—è:** $53.52 (70% –¥–µ—à–µ–≤–ª–µ!)

---

## üêõ –û–¢–õ–ê–î–ö–ê

### –ü—Ä–æ–±–ª–µ–º–∞: OpenAI API –æ—à–∏–±–∫–∏

**–°–∏–º–ø—Ç–æ–º:** `phase2_parse_llm.py` –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–∞–º–∏ API

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `OPENAI_API_KEY` –≤ `.env`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å OpenAI –∞–∫–∫–∞—É–Ω—Ç–∞
- –£–º–µ–Ω—å—à–∏—Ç—å `--batch-size` –¥–ª—è –º–µ–Ω—å—à–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏
- –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏

### –ü—Ä–æ–±–ª–µ–º–∞: SQL —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã

**–°–∏–º–ø—Ç–æ–º:** `ERROR: function safe_latitude(text) does not exist`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
psql -U postgres -d care_homes -f input/autumna/staging/02_sql_helper_functions.sql
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø–∞—Ä—Å–∏–Ω–≥–∞

**–°–∏–º–ø—Ç–æ–º:** `data_quality_score < 60` –¥–ª—è –º–Ω–æ–≥–∏—Ö –∑–∞–ø–∏—Å–µ–π

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–∞–ø–∏—Å–∏:
   ```sql
   SELECT * FROM v_staging_problems LIMIT 10;
   ```
2. –£–ª—É—á—à–∏—Ç—å –ø—Ä–æ–º–ø—Ç –≤ `AUTUMNA_PARSING_PROMPT_v2_4.md`
3. –ü–µ—Ä–µ–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–æ–≤—ã–º –ø—Ä–æ–º–ø—Ç–æ–º (—Å–º. –°—Ü–µ–Ω–∞—Ä–∏–π 2)

---

## üìû –†–ï–°–£–†–°–´

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- Staging –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: `input/autumna/STAGING_ARCHITECTURE_v2.4.md`
- –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è: `input/autumna/AUTUMNA_SCRAPING_METHODOLOGY_PM.md`
- System Prompt: `input/autumna/AUTUMNA_PARSING_PROMPT_v2_4.md`
- JSON Schema: `input/autumna/response_format_v2_4.json`

**–ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã:**
- Staging README: `input/autumna/staging/README.md`
- SQL —Å–∫—Ä–∏–ø—Ç—ã: `input/autumna/staging/01_create_staging_table.sql`
- Python —Å–∫—Ä–∏–ø—Ç—ã: `input/autumna/staging/phase*.py`

**–ß–µ–∫–ª–∏—Å—Ç—ã:**
- –î–µ—Ç–∞–ª—å–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç –º–∞–ø–ø–∏–Ω–≥–∞: `input/autumna/autumna-mapping/–î–ï–¢–ê–õ–¨–ù–´–ô –ß–ï–ö–õ–ò–°–¢ –ü–†–û–í–ï–†–ö–ò –ú–ê–ü–ü–ò–ù–ì–ê Autumna ‚Üí care_homes (1).md`
- –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–æ–º–ø—Ç–∞: `input/autumna/checklist_ System Prompt.md`

---

**–î–∞—Ç–∞:** 3 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** v2.4 FINAL  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready

