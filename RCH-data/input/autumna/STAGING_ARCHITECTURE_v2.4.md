# üèóÔ∏è STAGING –ê–†–•–ò–¢–ï–ö–¢–£–†–ê: Autumna ‚Üí care_homes v2.4
## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è bootstrap –ø—Ä–æ–µ–∫—Ç–∞

**–î–∞—Ç–∞:** 3 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** v2.4 FINAL  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø –î–õ–Ø PRODUCTION  
**–ü–æ–¥—Ö–æ–¥:** Staging (–ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)

---

## üéØ EXECUTIVE SUMMARY

### –î–≤–∞ –ø–æ–¥—Ö–æ–¥–∞ –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–∞–Ω–Ω—ã—Ö Autumna:

1. **‚ùå –ü—Ä—è–º–æ–π –ø—É—Ç—å (Direct Path)** - —Å—Ä–∞–∑—É –ø–∞—Ä—Å–∏–º –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º
   - –ü—Ä–æ—Å—Ç–æ, –Ω–æ –¥–æ—Ä–æ–≥–æ –ø—Ä–∏ –∏—Ç–µ—Ä–∞—Ü–∏—è—Ö ($15 –∑–∞ –∫–∞–∂–¥—É—é –ø–æ–ø—ã—Ç–∫—É —É–ª—É—á—à–µ–Ω–∏—è)
   - –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è: –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å –∏–¥–µ–∞–ª—å–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏

2. **‚úÖ Staging –ø–æ–¥—Ö–æ–¥ (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)** - —Å–æ—Ö—Ä–∞–Ω—è–µ–º HTML, –ø–æ—Ç–æ–º –ø–∞—Ä—Å–∏–º –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ
   - –≠–∫–æ–Ω–æ–º–∏—Ç $66.90+ –ø—Ä–∏ 5 –∏—Ç–µ—Ä–∞—Ü–∏—è—Ö —Ä–∞–∑–≤–∏—Ç–∏—è
   - –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è: bootstrap –ø—Ä–æ–µ–∫—Ç–æ–≤, –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: **‚úÖ Staging –ø–æ–¥—Ö–æ–¥**

**–ü–æ—á–µ–º—É?**
- –í—ã –Ω–∞ —Å—Ç–∞–¥–∏–∏ bootstrap –∏ –±—É–¥–µ—Ç–µ –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ —É–ª—É—á—à–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- –≠–∫–æ–Ω–æ–º–∏—è –æ–∫—É–ø–∞–µ—Ç—Å—è —É–∂–µ –Ω–∞ –≤—Ç–æ—Ä–æ–π –ø–æ–ø—ã—Ç–∫–µ —É–ª—É—á—à–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
- –î–∞–µ—Ç –±–æ–ª—å—à–µ –≥–∏–±–∫–æ—Å—Ç–∏ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ –ø—Ä–æ—Ü–µ—Å—Å–æ–º
- –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–æ–º–ø—Ç–æ–≤ –Ω–∞ –æ–¥–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö

---

## üí∞ –≠–ö–û–ù–û–ú–ò–ß–ï–°–ö–û–ï –û–ë–û–°–ù–û–í–ê–ù–ò–ï

### –°—Ü–µ–Ω–∞—Ä–∏–π: 300 –¥–æ–º–æ–≤ –≤ –ë–∏—Ä–º–∏–Ω–≥–µ–º–µ

| –ò—Ç–µ—Ä–∞—Ü–∏—è | –ü—Ä—è–º–æ–π –ø—É—Ç—å | Staging –ø—É—Ç—å | –≠–∫–æ–Ω–æ–º–∏—è |
|----------|-------------|--------------|----------|
| 1-—è –∑–∞–≥—Ä—É–∑–∫–∞ | $16.62 | $16.62 | - |
| 2-—è (—É–ª—É—á—à–∏–ª–∏ –ø—Ä–æ–º–ø—Ç) | +$15 = $31.62 | +$1.62 = $18.24 | $13.38 |
| 3-—è (–µ—â–µ —É–ª—É—á—à–µ–Ω–∏—è) | +$15 = $46.62 | +$1.62 = $19.86 | $26.76 |
| 4-—è | +$15 = $61.62 | +$1.62 = $21.48 | $40.14 |
| 5-—è | +$15 = $76.62 | +$1.62 = $23.10 | $53.52 |
| **–ò–¢–û–ì–û** | **$76.62** | **$23.10** | **$53.52** ‚úÖ |

**–≠–∫–æ–Ω–æ–º–∏—è –ø—Ä–∏ 5 –∏—Ç–µ—Ä–∞—Ü–∏—è—Ö:** $53.52 (70% –¥–µ—à–µ–≤–ª–µ!)

### –†–∞–∑–±–∏–≤–∫–∞ –∑–∞—Ç—Ä–∞—Ç:

**–ü—Ä—è–º–æ–π –ø—É—Ç—å:**
- Firecrawl: $15 √ó 5 = $75
- OpenAI: $1.62 √ó 5 = $8.10
- **–í—Å–µ–≥–æ: $83.10**

**Staging –ø—É—Ç—å:**
- Firecrawl: $15 √ó 1 = $15 (—Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π —Ä–∞–∑!)
- OpenAI: $1.62 √ó 5 = $8.10
- **–í—Å–µ–≥–æ: $23.10**

---

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê STAGING –ü–û–î–•–û–î–ê

### –û–±—â–∞—è —Å—Ö–µ–º–∞:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Firecrawl API  ‚îÇ (–û–¥–∏–Ω —Ä–∞–∑: $15)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ HTML
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  staging_raw table  ‚îÇ (–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)
‚îÇ  - html_content     ‚îÇ
‚îÇ  - parsed_json      ‚îÇ
‚îÇ  - quality_score    ‚îÇ
‚îÇ  - llm_prompt_ver   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îú‚îÄ‚Üí OpenAI LLM (–ú–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ: $1.62 –∫–∞–∂–¥—ã–π —Ä–∞–∑)
         ‚îÇ   ‚Üì
         ‚îÇ   parsed_json
         ‚îÇ   ‚Üì
         ‚îÇ   UPDATE staging_raw
         ‚îÇ
         ‚îî‚îÄ‚Üí Python Mapper (–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è)
              ‚Üì
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ  care_homes     ‚îÇ (–§–∏–Ω–∞–ª—å–Ω–∞—è –ë–î)
         ‚îÇ  (93 –ø–æ–ª—è)      ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìä –°–¢–†–£–ö–¢–£–†–ê –ë–ê–ó–´ –î–ê–ù–ù–´–•

### –¢–∞–±–ª–∏—Ü–∞: `autumna_staging` (–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)

```sql
CREATE TABLE autumna_staging (
    -- PRIMARY KEY
    id BIGSERIAL PRIMARY KEY,
    
    -- –ò–î–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø
    source_url TEXT NOT NULL UNIQUE,
    cqc_location_id TEXT,  -- –ò–∑–≤–ª–µ—á–µ–Ω–æ –∏–∑ URL –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
    scraped_at TIMESTAMPTZ NOT NULL,
    
    -- –ò–°–•–û–î–ù–´–ï –î–ê–ù–ù–´–ï (—Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑)
    html_content TEXT NOT NULL,  -- –í–ï–°–¨ HTML —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    firecrawl_metadata JSONB,    -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ—Ç Firecrawl (status, timestamp, etc.)
    
    -- –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–ê–†–°–ò–ù–ì–ê (–æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ)
    parsed_json JSONB,           -- –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç ChatGPT (JSON Schema v2.4, 188 –ø–æ–ª–µ–π)
    extraction_confidence TEXT,  -- 'high', 'medium', 'low' (–∏–∑ extraction_metadata)
    data_quality_score INTEGER, -- Quality score (0-100) –æ—Ç Python mapper
    is_dormant BOOLEAN DEFAULT FALSE,
    
    -- –í–ï–†–°–ò–û–ù–ò–†–û–í–ê–ù–ò–ï –ò –û–¢–õ–ê–î–ö–ê
    llm_model TEXT,             -- 'gpt-4o-2024-08-06', 'gpt-4-turbo', etc.
    llm_prompt_version TEXT,    -- 'v2.4', 'v2.5', 'experimental_1', etc.
    parsing_errors JSONB,       -- –û—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ (critical_fields_missing, etc.)
    mapping_errors JSONB,       -- –û—à–∏–±–∫–∏ –º–∞–ø–ø–∏–Ω–≥–∞ (validation failures)
    
    -- –§–õ–ê–ì–ò –û–ë–†–ê–ë–û–¢–ö–ò
    needs_reparse BOOLEAN DEFAULT FALSE,     -- –ù—É–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å
    needs_validation BOOLEAN DEFAULT FALSE, -- –ù—É–∂–Ω–∞ –ª–∏ —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
    processed BOOLEAN DEFAULT FALSE,         -- –û–±—Ä–∞–±–æ—Ç–∞–Ω –ª–∏ –≤ care_homes
    processed_at TIMESTAMPTZ,                -- –ö–æ–≥–¥–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω –≤ care_homes
    
    -- –°–í–Ø–ó–¨ –° –§–ò–ù–ê–õ–¨–ù–û–ô –ë–î
    care_homes_id BIGINT,                    -- FK –Ω–∞ care_homes.id (–ø–æ—Å–ª–µ –º–∞–ø–ø–∏–Ω–≥–∞)
    
    -- –í–†–ï–ú–ï–ù–ù–´–ï –ú–ï–¢–ö–ò
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);

-- –ò–ù–î–ï–ö–°–´ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
CREATE INDEX idx_staging_url ON autumna_staging(source_url);
CREATE INDEX idx_staging_cqc_id ON autumna_staging(cqc_location_id) WHERE cqc_location_id IS NOT NULL;
CREATE INDEX idx_staging_processed ON autumna_staging(processed) WHERE processed = FALSE;
CREATE INDEX idx_staging_quality ON autumna_staging(data_quality_score DESC NULLS LAST);
CREATE INDEX idx_staging_reparse ON autumna_staging(needs_reparse) WHERE needs_reparse = TRUE;
CREATE INDEX idx_staging_prompt_version ON autumna_staging(llm_prompt_version);

-- –¢–†–ò–ì–ì–ï–† –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è updated_at
CREATE OR REPLACE FUNCTION update_staging_updated_at()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_staging_updated_at
    BEFORE UPDATE ON autumna_staging
    FOR EACH ROW
    EXECUTE FUNCTION update_staging_updated_at();

-- –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò
COMMENT ON TABLE autumna_staging IS '–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ Autumna HTML —Å—Ç—Ä–∞–Ω–∏—Ü';
COMMENT ON COLUMN autumna_staging.html_content IS '–ò—Å—Ö–æ–¥–Ω—ã–π HTML —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑';
COMMENT ON COLUMN autumna_staging.parsed_json IS '–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ ChatGPT (JSON Schema v2.4) - –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ';
COMMENT ON COLUMN autumna_staging.llm_prompt_version IS '–í–µ—Ä—Å–∏—è –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ä—Å–∏–π';
COMMENT ON COLUMN autumna_staging.needs_reparse IS '–§–ª–∞–≥ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞)';
```

---

## üîÑ –¢–†–ò –§–ê–ó–´ –û–ë–†–ê–ë–û–¢–ö–ò

### –§–ê–ó–ê 1: –ó–∞–≥—Ä—É–∑–∫–∞ HTML (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –û–î–ò–ù –†–ê–ó)

**–¶–µ–ª—å:** –°–æ—Ö—Ä–∞–Ω–∏—Ç—å HTML –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –≤ `staging_raw`

**Workflow:**
```
1. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ URL (300 –¥–æ–º–æ–≤)
2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Firecrawl API
3. –î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (10-15 –º–∏–Ω—É—Ç)
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å HTML –≤ staging_raw.html_content
```

**SQL –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è HTML:**
```sql
INSERT INTO autumna_staging (
    source_url,
    cqc_location_id,
    scraped_at,
    html_content,
    firecrawl_metadata
) VALUES (
    'https://www.autumna.co.uk/care-homes/birmingham/meadow-rose/1-1234567890',
    '1-1234567890',  -- –ò–∑–≤–ª–µ—á–µ–Ω–æ –∏–∑ URL
    CURRENT_TIMESTAMP,
    '<html>...</html>',  -- –ü–æ–ª–Ω—ã–π HTML –æ—Ç Firecrawl
    '{"status": "success", "scraped_at": "2025-11-03T10:00:00Z"}'::jsonb
)
ON CONFLICT (source_url) DO UPDATE
SET 
    html_content = EXCLUDED.html_content,
    firecrawl_metadata = EXCLUDED.firecrawl_metadata,
    scraped_at = EXCLUDED.scraped_at;
```

**–í—Ä–µ–º—è:** 10-15 –º–∏–Ω—É—Ç –¥–ª—è 300 —Å—Ç—Ä–∞–Ω–∏—Ü  
**–°—Ç–æ–∏–º–æ—Å—Ç—å:** $15 (–æ–¥–∏–Ω —Ä–∞–∑!)

---

### –§–ê–ó–ê 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö LLM (–º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä—è—Ç—å —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ)

**–¶–µ–ª—å:** –ò–∑–≤–ª–µ—á—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ HTML —Å –ø–æ–º–æ—â—å—é ChatGPT

**Workflow:**
```
1. –í—ã–±—Ä–∞—Ç—å –∑–∞–ø–∏—Å–∏ –±–µ–∑ parsed_json (–∏–ª–∏ needs_reparse = TRUE)
2. –î–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏:
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å html_content –≤ ChatGPT —Å –ø—Ä–æ–º–ø—Ç–æ–º v2.4
   - –ü–æ–ª—É—á–∏—Ç—å JSON Schema v2.4 (188 –ø–æ–ª–µ–π)
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ parsed_json
   - –û–±–Ω–æ–≤–∏—Ç—å llm_prompt_version
3. –í—ã—á–∏—Å–ª–∏—Ç—å quality_score
```

**Python –∫–æ–¥ (–ø—Ä–∏–º–µ—Ä):**
```python
import openai
import json
import psycopg2

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
conn = psycopg2.connect("...")
cursor = conn.cursor()

# –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–º–ø—Ç –∏ schema
with open('AUTUMNA_PARSING_PROMPT_v2_4.md') as f:
    system_prompt = f.read()

with open('response_format_v2_4.json') as f:
    response_format = json.load(f)

# –ü–æ–ª—É—á–∏—Ç—å –∑–∞–ø–∏—Å–∏ –±–µ–∑ parsed_json
cursor.execute("""
    SELECT id, html_content, source_url, cqc_location_id
    FROM autumna_staging
    WHERE parsed_json IS NULL OR needs_reparse = TRUE
    ORDER BY created_at ASC
    LIMIT 100
""")

records = cursor.fetchall()

for record in records:
    try:
        # –ü–∞—Ä—Å–∏–Ω–≥ —Å ChatGPT
        response = openai.chat.completions.create(
            model="gpt-4o-2024-08-06",
            messages=[
                {"role": "system", "content": system_prompt},
                {"role": "user", "content": record['html_content']}
            ],
            response_format={"type": "json_schema", "json_schema": response_format['json_schema']}
        )
        
        parsed_json = json.loads(response.choices[0].message.content)
        
        # –ò–∑–≤–ª–µ—á—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
        extraction_metadata = parsed_json.get('extraction_metadata', {})
        confidence = extraction_metadata.get('extraction_confidence', 'medium')
        quality_score = extraction_metadata.get('data_quality_score')
        is_dormant = extraction_metadata.get('is_dormant', False)
        
        # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        cursor.execute("""
            UPDATE autumna_staging
            SET 
                parsed_json = %(parsed_json)s::jsonb,
                extraction_confidence = %(confidence)s,
                data_quality_score = %(quality_score)s,
                is_dormant = %(is_dormant)s,
                llm_model = 'gpt-4o-2024-08-06',
                llm_prompt_version = 'v2.4',
                parsing_errors = %(errors)s::jsonb,
                needs_reparse = FALSE,
                updated_at = CURRENT_TIMESTAMP
            WHERE id = %(id)s
        """, {
            'id': record['id'],
            'parsed_json': json.dumps(parsed_json),
            'confidence': confidence,
            'quality_score': quality_score,
            'is_dormant': is_dormant,
            'errors': json.dumps({
                'critical_fields_missing': extraction_metadata.get('critical_fields_missing', []),
                'data_quality_notes': extraction_metadata.get('data_quality_notes')
            })
        })
        
        print(f"‚úÖ Parsed: {record['source_url']} (quality: {quality_score})")
        
    except Exception as e:
        print(f"‚ùå Error parsing {record['source_url']}: {e}")
        cursor.execute("""
            UPDATE autumna_staging
            SET parsing_errors = %(error)s::jsonb
            WHERE id = %(id)s
        """, {
            'id': record['id'],
            'error': json.dumps({'error': str(e), 'timestamp': str(datetime.now())})
        })

conn.commit()
```

**–í—Ä–µ–º—è:** 20-30 –º–∏–Ω—É—Ç –¥–ª—è 300 —Å—Ç—Ä–∞–Ω–∏—Ü  
**–°—Ç–æ–∏–º–æ—Å—Ç—å:** $1.62 –∫–∞–∂–¥—ã–π —Ä–∞–∑ (–º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä—è—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ, HTML —É–∂–µ –≤ –ë–î!)

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ –∑–∞—Ö–æ—Ç–µ–ª–∏ —É–ª—É—á—à–∏—Ç—å –ø—Ä–æ–º–ø—Ç:**
1. –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ–º–ø—Ç –≤ —Ñ–∞–π–ª–µ `AUTUMNA_PARSING_PROMPT_v2_4.md`
2. –û–±–Ω–æ–≤–∏—Ç—å `llm_prompt_version` –Ω–∞ `'v2.5'` –≤ –∫–æ–¥–µ
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —ç—Ç–æ—Ç workflow —Å–Ω–æ–≤–∞ (HTML —É–∂–µ –µ—Å—Ç—å!)
4. –°—Ä–∞–≤–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã: `SELECT llm_prompt_version, AVG(data_quality_score) FROM autumna_staging GROUP BY llm_prompt_version`

---

### –§–ê–ó–ê 3: –ú–∞–ø–ø–∏–Ω–≥ –≤ —Ñ–∏–Ω–∞–ª—å–Ω—É—é –ë–î (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ)

**–¶–µ–ª—å:** –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å `parsed_json` (188 –ø–æ–ª–µ–π) –≤ `care_homes` (93 –ø–æ–ª—è)

**Workflow:**
```
1. –í—ã–±—Ä–∞—Ç—å –∑–∞–ø–∏—Å–∏ —Å parsed_json –∏ quality_score >= 60
2. –î–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏:
   - –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å JSON Schema v2.4 ‚Üí care_homes —Å—Ç—Ä—É–∫—Ç—É—Ä—É
   - –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
   - –í—ã–∑–≤–∞—Ç—å SQL —Ñ—É–Ω–∫—Ü–∏–∏ (safe_latitude, safe_longitude, etc.)
   - INSERT/UPDATE –≤ care_homes
3. –û–±–Ω–æ–≤–∏—Ç—å processed = TRUE
```

**Python –∫–æ–¥ (–ø—Ä–∏–º–µ—Ä):**
```python
# –ó–∞–≥—Ä—É–∑–∏—Ç—å mapper —Ñ—É–Ω–∫—Ü–∏—é
from autumna_mapper_v2_4 import map_autumna_to_db

# –ü–æ–ª—É—á–∏—Ç—å –∑–∞–ø–∏—Å–∏ –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞
cursor.execute("""
    SELECT 
        id,
        parsed_json,
        source_url,
        cqc_location_id,
        data_quality_score,
        extraction_confidence
    FROM autumna_staging
    WHERE parsed_json IS NOT NULL
      AND processed = FALSE
      AND data_quality_score >= 60  -- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ –∫–∞—á–µ—Å—Ç–≤–∞
    ORDER BY data_quality_score DESC
    LIMIT 100
""")

records = cursor.fetchall()

success_count = 0
failed_count = 0

for record in records:
    try:
        parsed_json = json.loads(record['parsed_json'])
        
        # –ú–∞–ø–ø–∏–Ω–≥ Autumna JSON ‚Üí care_homes —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
        db_data = map_autumna_to_db(parsed_json)
        
        # –í–∞–ª–∏–¥–∞—Ü–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª–µ–π
        if not db_data.get('cqc_location_id') or not db_data.get('name'):
            raise ValueError("Missing critical fields")
        
        # INSERT –≤ care_homes —Å SQL —Ñ—É–Ω–∫—Ü–∏—è–º–∏
        cursor.execute("""
            INSERT INTO care_homes (
                cqc_location_id,
                name,
                city,
                postcode,
                latitude,
                longitude,
                -- ... –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
            ) VALUES (
                %(cqc_location_id)s,
                clean_text(%(name)s),
                clean_text(%(city)s),
                normalize_uk_postcode(%(postcode)s),
                safe_latitude(%(latitude)s),
                safe_longitude(%(longitude)s),
                -- ... –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è —Å SQL —Ñ—É–Ω–∫—Ü–∏—è–º–∏
            )
            ON CONFLICT (cqc_location_id) DO UPDATE
            SET 
                name = EXCLUDED.name,
                updated_at = CURRENT_TIMESTAMP
            RETURNING id
        """, db_data)
        
        care_homes_id = cursor.fetchone()[0]
        
        # –û–±–Ω–æ–≤–∏—Ç—å staging –∑–∞–ø–∏—Å—å
        cursor.execute("""
            UPDATE autumna_staging
            SET 
                processed = TRUE,
                processed_at = CURRENT_TIMESTAMP,
                care_homes_id = %(care_homes_id)s
            WHERE id = %(id)s
        """, {
            'id': record['id'],
            'care_homes_id': care_homes_id
        })
        
        success_count += 1
        
    except Exception as e:
        print(f"‚ùå Error mapping {record['source_url']}: {e}")
        cursor.execute("""
            UPDATE autumna_staging
            SET 
                mapping_errors = %(error)s::jsonb,
                needs_validation = TRUE
            WHERE id = %(id)s
        """, {
            'id': record['id'],
            'error': json.dumps({'error': str(e), 'timestamp': str(datetime.now())})
        })
        failed_count += 1

conn.commit()
print(f"‚úÖ Success: {success_count}, ‚ùå Failed: {failed_count}")
```

**–í—Ä–µ–º—è:** 1-2 –º–∏–Ω—É—Ç—ã –¥–ª—è 300 –∑–∞–ø–∏—Å–µ–π  
**–°—Ç–æ–∏–º–æ—Å—Ç—å:** $0 (—Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)

---

## üîß –†–ê–ë–û–¢–ê –° N8N (No-Code Automation)

### Workflow #1: –ó–∞–≥—Ä—É–∑–∫–∞ HTML (Firecrawl ‚Üí staging_raw)

**–ë–ª–æ–∫–∏ n8n:**

1. **Manual Trigger** - –∑–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é
2. **Set** - –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –º–∞—Å—Å–∏–≤ URL (300 –¥–æ–º–æ–≤)
3. **HTTP Request** - POST –≤ Firecrawl API —Å batch URL
4. **Wait** - –∂–¥–µ–º 15 –º–∏–Ω—É—Ç (Firecrawl –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç)
5. **HTTP Request** - GET —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ Firecrawl
6. **Loop** - –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:
   - –ò–∑–≤–ª–µ—á—å `cqc_location_id` –∏–∑ URL
   - **PostgreSQL** - INSERT –≤ `autumna_staging`
7. **Slack** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏

**–ö–æ–¥ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è CQC ID:**
```javascript
// –í Code –±–ª–æ–∫–µ n8n
const url = $input.item.json.url;
const match = url.match(/\/1-(\d{10})/);
const cqcId = match ? `1-${match[1]}` : null;

return {
  json: {
    cqc_location_id: cqcId,
    url: url
  }
};
```

---

### Workflow #2: –ü–∞—Ä—Å–∏–Ω–≥ LLM (staging_raw ‚Üí parsed_json)

**–ë–ª–æ–∫–∏ n8n:**

1. **Manual Trigger** - –∑–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é (–∏–ª–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é)
2. **PostgreSQL** - SELECT –∑–∞–ø–∏—Å–∏ –±–µ–∑ `parsed_json`:
   ```sql
   SELECT id, html_content, source_url
   FROM autumna_staging
   WHERE parsed_json IS NULL OR needs_reparse = TRUE
   ORDER BY created_at ASC
   LIMIT 25
   ```
3. **Split In Batches** - –±–∞—Ç—á–∏ –ø–æ 25 –∑–∞–ø–∏—Å–µ–π
4. **Loop** - –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏:
   - **OpenAI** - Chat Completion —Å `html_content` –∏ –ø—Ä–æ–º–ø—Ç–æ–º v2.4
   - **Code** - –∏–∑–≤–ª–µ—á—å `quality_score`, `confidence` –∏–∑ –æ—Ç–≤–µ—Ç–∞
   - **PostgreSQL** - UPDATE `parsed_json`:
     ```sql
     UPDATE autumna_staging
     SET 
       parsed_json = %(parsed_json)s::jsonb,
       extraction_confidence = %(confidence)s,
       data_quality_score = %(quality_score)s,
       llm_prompt_version = 'v2.4',
       needs_reparse = FALSE
     WHERE id = %(id)s
     ```
5. **Slack** - –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ OpenAI –±–ª–æ–∫–∞:**
- Model: `gpt-4o-2024-08-06`
- System Prompt: –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ `AUTUMNA_PARSING_PROMPT_v2_4.md`
- Response Format: JSON Schema –∏–∑ `response_format_v2_4.json`

---

### Workflow #3: –ú–∞–ø–ø–∏–Ω–≥ –≤ —Ñ–∏–Ω–∞–ª—å–Ω—É—é –ë–î (staging_raw ‚Üí care_homes)

**–ë–ª–æ–∫–∏ n8n:**

1. **Manual Trigger** - –∑–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é
2. **PostgreSQL** - SELECT –∑–∞–ø–∏—Å–∏ —Å `parsed_json`:
   ```sql
   SELECT id, parsed_json, data_quality_score
   FROM autumna_staging
   WHERE parsed_json IS NOT NULL
     AND processed = FALSE
     AND data_quality_score >= 60
   ORDER BY data_quality_score DESC
   ```
3. **Loop** - –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏:
   - **Code** - –≤—ã–∑–≤–∞—Ç—å `map_autumna_to_db(parsed_json)`
   - **PostgreSQL** - INSERT –≤ `care_homes` —Å SQL —Ñ—É–Ω–∫—Ü–∏—è–º–∏
   - **PostgreSQL** - UPDATE `processed = TRUE`
4. **Slack** - —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

---

## üéØ –ü–†–ê–ö–¢–ò–ß–ï–°–ö–ò–ï –°–¶–ï–ù–ê–†–ò–ò

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –£–ª—É—á—à–∏–ª–∏ –ø—Ä–æ–º–ø—Ç - –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å

**–ü—Ä–æ–±–ª–µ–º–∞:** –û–±–Ω–æ–≤–∏–ª–∏ `AUTUMNA_PARSING_PROMPT_v2_4.md`, —Ö–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –ü–æ–º–µ—Ç–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ –¥–ª—è –ø–µ—Ä–µ–æ–±—Ä–∞–±–æ—Ç–∫–∏
UPDATE autumna_staging
SET needs_reparse = TRUE
WHERE parsed_json IS NOT NULL;
```

–ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å **Workflow #2** —Å–Ω–æ–≤–∞ (–Ω–æ —Å –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–µ–π –ø—Ä–æ–º–ø—Ç–∞ –≤ –∫–æ–¥–µ).

**–°—Ç–æ–∏–º–æ—Å—Ç—å:** $1.62 (—Ç–æ–ª—å–∫–æ ChatGPT, HTML —É–∂–µ –µ—Å—Ç—å!)

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –£–ø–∞–ª –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ 150-–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** Workflow #2 —É–ø–∞–ª –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ 150 –∑–∞–ø–∏—Å–µ–π

**–†–µ—à–µ–Ω–∏–µ:**
–ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å **Workflow #2** —Å–Ω–æ–≤–∞ - –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Å –∑–∞–ø–∏—Å–µ–π –≥–¥–µ `parsed_json IS NULL`.

**–°—Ç–æ–∏–º–æ—Å—Ç—å:** $0 (–ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫)

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –¢–µ—Å—Ç–∏—Ä—É–µ–º 2 –≤–µ—Ä—Å–∏–∏ –ø—Ä–æ–º–ø—Ç–∞

**–¶–µ–ª—å:** –°—Ä–∞–≤–Ω–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å v2.4 –∏ experimental_v1

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫: v2.4
# –û–±–Ω–æ–≤–∏—Ç—å llm_prompt_version = 'v2.4' –≤ –∫–æ–¥–µ
# –ó–∞–ø—É—Å—Ç–∏—Ç—å Workflow #2

# –í—Ç–æ—Ä–æ–π –∑–∞–ø—É—Å–∫: experimental_v1
# –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ–º–ø—Ç –Ω–∞ experimental –≤–µ—Ä—Å–∏—é
# –û–±–Ω–æ–≤–∏—Ç—å llm_prompt_version = 'experimental_v1' –≤ –∫–æ–¥–µ
# –ó–∞–ø—É—Å—Ç–∏—Ç—å Workflow #2 —Å–Ω–æ–≤–∞

# –°—Ä–∞–≤–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
SELECT 
    llm_prompt_version,
    AVG(data_quality_score) as avg_quality,
    COUNT(*) as count,
    COUNT(*) FILTER (WHERE data_quality_score >= 90) as high_quality_count
FROM autumna_staging
WHERE parsed_json IS NOT NULL
GROUP BY llm_prompt_version;
```

**–°—Ç–æ–∏–º–æ—Å—Ç—å:** $3.24 (–¥–≤–∞ —Ä–∞–∑–∞ –ø–æ $1.62)  
**–ü—Ä–∏ –ø—Ä—è–º–æ–º –ø—É—Ç–∏:** $31.62 (–Ω—É–∂–Ω–æ –±—ã–ª–æ –±—ã –∑–∞–Ω–æ–≤–æ –∫–∞—á–∞—Ç—å HTML!)

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (–≤–æ–ª–Ω–∞–º–∏)

**–¶–µ–ª—å:** –ó–∞–≥—Ä—É–∑–∏—Ç—å 50 –¥–æ–º–æ–≤, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ, –ø–æ—Ç–æ–º –µ—â–µ 50

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 50 –∑–∞–ø–∏—Å–µ–π
SELECT id, html_content
FROM autumna_staging
WHERE parsed_json IS NULL
ORDER BY created_at ASC
LIMIT 50;
```

–ó–∞–ø—É—Å—Ç–∏—Ç—å Workflow #2 —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–∏—Ö 50 –∑–∞–ø–∏—Å–µ–π. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ. –ï—Å–ª–∏ —Ö–æ—Ä–æ—à–æ - –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ 50.

---

## üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –ê–ù–ê–õ–ò–¢–ò–ö–ê

### SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

**–°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
```sql
SELECT 
    COUNT(*) as total_records,
    COUNT(*) FILTER (WHERE html_content IS NOT NULL) as html_loaded,
    COUNT(*) FILTER (WHERE parsed_json IS NOT NULL) as parsed,
    COUNT(*) FILTER (WHERE processed = TRUE) as synced_to_production,
    COUNT(*) FILTER (WHERE needs_reparse = TRUE) as needs_reparse,
    COUNT(*) FILTER (WHERE needs_validation = TRUE) as needs_validation
FROM autumna_staging;
```

**–ö–∞—á–µ—Å—Ç–≤–æ –ø–æ –≤–µ—Ä—Å–∏—è–º –ø—Ä–æ–º–ø—Ç–∞:**
```sql
SELECT 
    llm_prompt_version,
    COUNT(*) as total_parsed,
    AVG(data_quality_score)::INTEGER as avg_quality,
    MIN(data_quality_score) as min_quality,
    MAX(data_quality_score) as max_quality,
    COUNT(*) FILTER (WHERE data_quality_score >= 90) as high_quality,
    COUNT(*) FILTER (WHERE data_quality_score < 60) as low_quality,
    COUNT(*) FILTER (WHERE extraction_confidence = 'high') as high_confidence
FROM autumna_staging
WHERE parsed_json IS NOT NULL
GROUP BY llm_prompt_version
ORDER BY avg_quality DESC;
```

**–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–∞–ø–∏—Å–∏:**
```sql
SELECT 
    source_url,
    cqc_location_id,
    data_quality_score,
    extraction_confidence,
    parsing_errors,
    mapping_errors
FROM autumna_staging
WHERE 
    (data_quality_score < 60 OR data_quality_score IS NULL)
    OR needs_validation = TRUE
    OR parsing_errors IS NOT NULL
ORDER BY data_quality_score ASC NULLS LAST;
```

**–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –≤—Ä–µ–º–µ–Ω–∏:**
```sql
SELECT 
    DATE_TRUNC('day', scraped_at) as date,
    COUNT(*) as scraped_count,
    COUNT(*) FILTER (WHERE parsed_json IS NOT NULL) as parsed_count,
    COUNT(*) FILTER (WHERE processed = TRUE) as synced_count,
    AVG(EXTRACT(EPOCH FROM (updated_at - scraped_at))) / 60 as avg_minutes_to_parse
FROM autumna_staging
GROUP BY DATE_TRUNC('day', scraped_at)
ORDER BY date DESC;
```

---

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–Ø

### 1. –•—Ä–∞–Ω–µ–Ω–∏–µ HTML

**–†–∞–∑–º–µ—Ä:** ~100-500 KB –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É  
**–î–ª—è 300 –¥–æ–º–æ–≤:** ~30-150 MB

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** 
- –•—Ä–∞–Ω–∏—Ç—å HTML –º–∏–Ω–∏–º—É–º 30 –¥–Ω–µ–π –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –ü–æ—Å–ª–µ 30 –¥–Ω–µ–π –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞:
  ```sql
  DELETE FROM autumna_staging
  WHERE processed = TRUE
    AND processed_at < CURRENT_TIMESTAMP - INTERVAL '30 days';
  ```

### 2. –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤

**–í–∞–∂–Ω–æ:** –í—Å–µ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è—Ç—å `llm_prompt_version` –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø—Ä–æ–º–ø—Ç–∞!

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –°—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ä—Å–∏–π
- –û—Ç–∫–∞—Ç—ã–≤–∞—Ç—å—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–∏–º –≤–µ—Ä—Å–∏—è–º
- –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é —É–ª—É—á—à–µ–Ω–∏–π

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è:**
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ `parsing_errors`
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –º–∞–ø–ø–∏–Ω–≥–∞ ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ `mapping_errors`
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `needs_validation = TRUE` –¥–ª—è —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

**–ù–µ —É–¥–∞–ª—è—Ç—å –∑–∞–ø–∏—Å–∏ —Å –æ—à–∏–±–∫–∞–º–∏!** –û–Ω–∏ –Ω—É–∂–Ω—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞.

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –í–ù–ï–î–†–ï–ù–ò–Ø

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å staging —Ç–∞–±–ª–∏—Ü—É
- [ ] –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL —Å–æ–∑–¥–∞–Ω–∏—è `autumna_staging`
- [ ] –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä—ã

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Workflow #1 (–ó–∞–≥—Ä—É–∑–∫–∞ HTML)
- [ ] –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ URL (300 –¥–æ–º–æ–≤)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Firecrawl API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å n8n workflow –∏–ª–∏ Python —Å–∫—Ä–∏–ø—Ç
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ 5-10 URL

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Workflow #2 (LLM –ü–∞—Ä—Å–∏–Ω–≥)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å OpenAI API –∫–ª—é—á
- [ ] –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–º–ø—Ç v2.4 –∏ JSON Schema
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å n8n workflow –∏–ª–∏ Python —Å–∫—Ä–∏–ø—Ç
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ 10-20 –∑–∞–ø–∏—Å—è—Ö

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Workflow #3 (–ú–∞–ø–ø–∏–Ω–≥)
- [ ] –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å Python mapper —Ñ—É–Ω–∫—Ü–∏—é
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SQL —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –ë–î
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å n8n workflow –∏–ª–∏ Python —Å–∫—Ä–∏–ø—Ç
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ 10-20 –∑–∞–ø–∏—Å—è—Ö

### –®–∞–≥ 5: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã (Slack/Email) –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- [ ] –°–æ–∑–¥–∞—Ç—å –¥–∞—à–±–æ—Ä–¥ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏

---

## üìà –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ (300 –¥–æ–º–æ–≤):

- ‚úÖ HTML –∑–∞–≥—Ä—É–∂–µ–Ω: 300 –∑–∞–ø–∏—Å–µ–π
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω: 285-300 –∑–∞–ø–∏—Å–µ–π (95-100%)
- ‚úÖ –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ (score ‚â• 90): 255-270 –∑–∞–ø–∏—Å–µ–π (85-90%)
- ‚úÖ –°—Ä–µ–¥–Ω–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ (score 60-89): 25-30 –∑–∞–ø–∏—Å–µ–π (8-10%)
- ‚úÖ –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ (score < 60): 5-15 –∑–∞–ø–∏—Å–µ–π (2-5%)

### –ü–æ—Å–ª–µ –º–∞–ø–ø–∏–Ω–≥–∞ –≤ care_homes:

- ‚úÖ –£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: 270-285 –∑–∞–ø–∏—Å–µ–π (90-95%)
- ‚úÖ –¢—Ä–µ–±—É—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏: 15-30 –∑–∞–ø–∏—Å–µ–π (5-10%)
- ‚úÖ –û—à–∏–±–∫–∏: 0-5 –∑–∞–ø–∏—Å–µ–π (0-2%)

---

## üéØ –†–ï–ó–Æ–ú–ï

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ–¥—Ö–æ–¥:** ‚úÖ **Staging (–ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)**

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –≠–∫–æ–Ω–æ–º–∏—è $53.52+ –ø—Ä–∏ 5 –∏—Ç–µ—Ä–∞—Ü–∏—è—Ö —Ä–∞–∑–≤–∏—Ç–∏—è
2. –ì–∏–±–∫–æ—Å—Ç—å: –ª–µ–≥–∫–æ –º–µ–Ω—è—Ç—å –ø—Ä–æ–º–ø—Ç—ã –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
3. –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å: –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
4. –ò—Å—Ç–æ—Ä–∏—è: –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ä—Å–∏–π –ø—Ä–æ–º–ø—Ç–æ–≤

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```
Firecrawl ($15 –æ–¥–∏–Ω —Ä–∞–∑) 
  ‚Üí staging_raw.html_content 
  ‚Üí ChatGPT ($1.62 –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ) 
  ‚Üí staging_raw.parsed_json 
  ‚Üí Python Mapper 
  ‚Üí care_homes (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è –ë–î)
```

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**
- n8n (no-code –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è) –∏–ª–∏ Python —Å–∫—Ä–∏–ø—Ç—ã
- Firecrawl API (–∑–∞–≥—Ä—É–∑–∫–∞ HTML)
- OpenAI ChatGPT API (–ø–∞—Ä—Å–∏–Ω–≥)
- PostgreSQL (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)

**–°—Ä–æ–∫–∏:**
- –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞: 2-3 –¥–Ω—è
- –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞: 30-45 –º–∏–Ω—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏: 20-30 –º–∏–Ω—É—Ç (–±–µ–∑ Firecrawl!)

---

**–î–∞—Ç–∞:** 3 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** v2.4 FINAL  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø –î–õ–Ø PRODUCTION

