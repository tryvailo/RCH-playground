# üìò –ò–ù–°–¢–†–£–ö–¶–ò–Ø: –ú–∏–≥—Ä–∞—Ü–∏—è CQC –≤ Supabase

**–§–∞–π–ª—ã –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏:**
1. `step1_schema_create.sql` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã –ë–î
2. `step2_run_migration_SUPABASE.sql` - –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è Supabase)

---

## üöÄ –ü–û–®–ê–ì–û–í–ê–Ø –ò–ù–°–¢–†–£–ö–¶–ò–Ø

### –®–ê–ì 1: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã –ë–î

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Supabase Dashboard** ‚Üí **SQL Editor**
2. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `step1_schema_create.sql`
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤ SQL Editor
4. –ù–∞–∂–º–∏—Ç–µ **Run** (–∏–ª–∏ `Cmd+Enter`)
5. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (—Å–æ–∑–¥–∞—Å—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞ `care_homes` —Å 93 –ø–æ–ª—è–º–∏)

‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –í—ã–ø–æ–ª–Ω–∏—Ç–µ `SELECT COUNT(*) FROM care_homes;` - –¥–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å 0

---

### –®–ê–ì 2: –ó–∞–≥—Ä—É–∑–∫–∞ CSV –¥–∞–Ω–Ω—ã—Ö

–£ –≤–∞—Å –µ—Å—Ç—å **3 –≤–∞—Ä–∏–∞–Ω—Ç–∞** –∑–∞–≥—Ä—É–∑–∫–∏ CSV:

#### **–í–ê–†–ò–ê–ù–¢ –ê: –ß–µ—Ä–µ–∑ Supabase Table Editor (–°–ê–ú–´–ô –ü–†–û–°–¢–û–ô)** ‚≠ê –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø

1. –í Supabase Dashboard ‚Üí **Table Editor**
2. –ù–∞–∂–º–∏—Ç–µ **New Table**
3. –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã: `temp_cqc_raw`
4. **–ù–ï —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –∫–æ–ª–æ–Ω–∫–∏ –≤—Ä—É—á–Ω—É—é!** –ù–∞–∂–º–∏—Ç–µ **Import data** ‚Üí **Import CSV**
5. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à CSV —Ñ–∞–π–ª `CQC-DataSet_rows.csv`
6. Supabase –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –∫–æ–ª–æ–Ω–∫–∏ –∏–∑ CSV –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
7. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –∏–º–ø–æ—Ä—Ç

‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –í—ã–ø–æ–ª–Ω–∏—Ç–µ `SELECT COUNT(*) FROM temp_cqc_raw;` - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å > 0

**–ó–∞—Ç–µ–º:** –í —Ñ–∞–π–ª–µ `step2_run_migration_SUPABASE.sql` **–ù–ï –ó–ê–ú–ï–ù–Ø–ô–¢–ï** `temp_cqc_raw` - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞–∫ –µ—Å—Ç—å!

---

#### **–í–ê–†–ò–ê–ù–¢ –ë: –ß–µ—Ä–µ–∑ Supabase Storage**

1. –í Supabase Dashboard ‚Üí **Storage**
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π bucket (–Ω–∞–ø—Ä–∏–º–µ—Ä, `csv-imports`)
3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª `CQC-DataSet_rows.csv`
4. –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å–µ–∫—Ü–∏—é "–í–ê–†–ò–ê–ù–¢ 1" –≤ `step2_run_migration_SUPABASE.sql`
5. –ó–∞–º–µ–Ω–∏—Ç–µ –ø—É—Ç—å –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –ø—É—Ç—å –≤ Storage

‚ö†Ô∏è **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –¢—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ—É–Ω–∫—Ü–∏–π —á—Ç–µ–Ω–∏—è –∏–∑ Storage

---

#### **–í–ê–†–ò–ê–ù–¢ –í: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ç–∞–±–ª–∏—Ü—É**

–ï—Å–ª–∏ CSV —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω –≤ —Ç–∞–±–ª–∏—Ü—É —Å –¥—Ä—É–≥–∏–º –∏–º–µ–Ω–µ–º:

1. –ù–∞–π–¥–∏—Ç–µ –∏–º—è –≤–∞—à–µ–π —Ç–∞–±–ª–∏—Ü—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `cqc_csv_data`)
2. –í `step2_run_migration_SUPABASE.sql` –∑–∞–º–µ–Ω–∏—Ç–µ –≤—Å–µ `temp_cqc_raw` –Ω–∞ –∏–º—è –≤–∞—à–µ–π —Ç–∞–±–ª–∏—Ü—ã
3. –£–¥–∞–ª–∏—Ç–µ —Å–µ–∫—Ü–∏—é "–ß–ê–°–¢–¨ 1: –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã"

---

### –®–ê–ì 3: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `step2_run_migration_SUPABASE.sql` –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
2. –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ **–í–ê–†–ò–ê–ù–¢ –ê** (Table Editor) - —Ñ–∞–π–ª –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∫–∞–∫ –µ—Å—Ç—å!
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤ **SQL Editor** Supabase
4. –ù–∞–∂–º–∏—Ç–µ **Run** (–∏–ª–∏ `Cmd+Enter`)
5. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (–º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 1-2 –º–∏–Ω—É—Ç—ã)

‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –í—ã–ø–æ–ª–Ω–∏—Ç–µ `SELECT COUNT(*) FROM care_homes;` - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ~271 –∑–∞–ø–∏—Å–µ–π

---

## üîç –í–ê–õ–ò–î–ê–¶–ò–Ø –ü–û–°–õ–ï –ú–ò–ì–†–ê–¶–ò–ò

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π
SELECT COUNT(*) FROM care_homes;
-- –û–∂–∏–¥–∞–µ—Ç—Å—è: ~271

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏—Ü–µ–Ω–∑–∏–π (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ~198 —Å nursing license)
SELECT 
    COUNT(*) as total,
    COUNT(*) FILTER (WHERE has_nursing_care_license = TRUE) as nursing_license,
    ROUND(100.0 * COUNT(*) FILTER (WHERE has_nursing_care_license = TRUE) / COUNT(*), 1) as pct
FROM care_homes;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç (–≤—Å–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ UK –¥–∏–∞–ø–∞–∑–æ–Ω–µ)
SELECT COUNT(*) 
FROM care_homes 
WHERE latitude NOT BETWEEN 49 AND 61 
   OR longitude NOT BETWEEN -8 AND 2;
-- –û–∂–∏–¥–∞–µ—Ç—Å—è: 0

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π v2.2
SELECT 
    COUNT(*) FILTER (WHERE serves_dementia_band = TRUE) as dementia,
    COUNT(*) FILTER (WHERE serves_children = TRUE) as children,
    COUNT(*) FILTER (WHERE serves_learning_disabilities = TRUE) as learning_dis
FROM care_homes;
```

---

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

1. **–ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** –°–Ω–∞—á–∞–ª–∞ `step1_schema_create.sql`, –∑–∞—Ç–µ–º `step2_run_migration_SUPABASE.sql`

2. **–ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –Ω–µ –ø—É—Å—Ç–∞:** –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç `TRUNCATE` –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π

3. **–ï—Å–ª–∏ –æ—à–∏–±–∫–∞:** –°–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (`BEGIN`/`COMMIT`), –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏ –æ—à–∏–±–∫–µ –≤—Å–µ –æ—Ç–∫–∞—Ç–∏—Ç—Å—è

4. **–§—É–Ω–∫—Ü–∏–∏:** –í—Å–µ 10 helper —Ñ—É–Ω–∫—Ü–∏–π —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ `step2_run_migration_SUPABASE.sql`

---

## üìù –§–ê–ô–õ–´

- ‚úÖ `step1_schema_create.sql` - —Å—Ö–µ–º–∞ –ë–î (93 –ø–æ–ª—è, 53 –∏–Ω–¥–µ–∫—Å–∞, 3 views)
- ‚úÖ `step2_run_migration_SUPABASE.sql` - –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è Supabase)

---

## üÜò –ü–†–û–ë–õ–ï–ú–´?

**–ü—Ä–æ–±–ª–µ–º–∞:** "column does not exist"
- **–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ `step1_schema_create.sql` –ø–µ—Ä–≤—ã–º

**–ü—Ä–æ–±–ª–µ–º–∞:** "temp_cqc_raw does not exist"
- **–†–µ—à–µ–Ω–∏–µ:** –ó–∞–≥—Ä—É–∑–∏—Ç–µ CSV —á–µ—Ä–µ–∑ Table Editor (–í–ê–†–ò–ê–ù–¢ –ê)

**–ü—Ä–æ–±–ª–µ–º–∞:** "duplicate key value violates unique constraint"
- **–†–µ—à–µ–Ω–∏–µ:** –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã, –Ω–æ –µ—Å–ª–∏ –æ—à–∏–±–∫–∞ - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ CSV –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã `location_id`

---

**–ì–æ—Ç–æ–≤–æ!** –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–±–æ–∏—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ –≤–∞—à–∞ –ë–î –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏ CQC. üéâ

